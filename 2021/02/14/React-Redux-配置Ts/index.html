<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="React-Redux总结-配置Ts"><meta name="keywords" content="React"><meta name="author" content="ChengWei"><meta name="copyright" content="ChengWei"><title>React-Redux总结-配置Ts | Chengcw'博客</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.1"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://v1.hitokoto.cn/?encode=js&amp;charset=utf-8&amp;select=.footer_custom_text" defer></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '5.4.2'
} </script><meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="Chengcw'博客" type="application/atom+xml">
</head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86-%E7%BB%93%E5%90%88React%E5%AE%9E%E8%B7%B5"><span class="toc-number">1.</span> <span class="toc-text">第二部分 结合React实践</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="toc-number">1.1.</span> <span class="toc-text">一、环境配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E5%88%9D%E5%A7%8B%E5%8C%96%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1 初始化项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96"><span class="toc-number">1.1.2.</span> <span class="toc-text">1.2 安装依赖</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-1-%E7%B1%BB%E5%9E%8B%E5%AE%9A%E4%B9%89%E6%96%87%E4%BB%B6"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">1.2.1 类型定义文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-2-%E7%9B%B8%E5%85%B3%E4%BE%9D%E8%B5%96%E5%8C%85"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">1.2.2 相关依赖包</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-Typescript-config%E9%85%8D%E7%BD%AE"><span class="toc-number">1.1.3.</span> <span class="toc-text">1.3 Typescript config配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-webpack%E9%85%8D%E7%BD%AE"><span class="toc-number">1.1.4.</span> <span class="toc-text">1.4 webpack配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81React%E7%BB%84%E4%BB%B6"><span class="toc-number">1.2.</span> <span class="toc-text">二、React组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E5%86%99%E4%B8%80%E4%B8%AA%E8%AE%A1%E6%95%B0%E5%99%A8%E7%BB%84%E4%BB%B6"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.1 写一个计数器组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E7%BB%93%E5%90%88Redux%E4%BD%BF%E7%94%A8"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.2 结合Redux使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">2.2.1 基础使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-2-%E5%90%88%E5%B9%B6reducers"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">2.2.2 合并reducers</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E8%B7%AF%E7%94%B1"><span class="toc-number">1.2.3.</span> <span class="toc-text">2.3 路由</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">2.3.1 基本用法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-2-%E5%90%8C%E6%AD%A5%E8%B7%AF%E7%94%B1%E5%88%B0redux"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">2.3.2 同步路由到redux</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://wx2.sinaimg.cn/thumb150/008soxMJly1h0v1m20khej30u00u0td0.jpg"></div><div class="author-info__name text-center">ChengWei</div><div class="author-info__description text-center"></div><div class="follow-button"><a target="_blank" rel="noopener" href="https://github.com/USERNAME">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">150</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">27</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">24</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fpic1.win4000.com%2Fwallpaper%2F6%2F53cca8e7873e6.jpg&amp;refer=http%3A%2F%2Fpic1.win4000.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1664449271&amp;t=4f4642aaba02226ad62910f50b366e4b)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Chengcw'博客</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">首页</a><a class="site-page" href="/archives">文章</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">React-Redux总结-配置Ts</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-02-14</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E6%A1%86%E6%9E%B6/">框架</a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="第二部分-结合React实践"><a href="#第二部分-结合React实践" class="headerlink" title="第二部分 结合React实践"></a>第二部分 结合React实践</h1><h2 id="一、环境配置"><a href="#一、环境配置" class="headerlink" title="一、环境配置"></a>一、环境配置</h2><h3 id="1-1-初始化项目"><a href="#1-1-初始化项目" class="headerlink" title="1.1 初始化项目"></a>1.1 初始化项目</h3><ul>
<li>生成一个目录<code>ts_react_demo</code>，输入<code>npm init -y</code>初始化项目</li>
<li>然后在项目里我们需要一个<code>.gitignore</code>来忽略指定目录不传到<code>git</code>上</li>
<li>进入<code>.gitignore</code>输入我们需要忽略的目录，一般是<code>node_modules</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// .gitignore</span><br><span class="line">node_modules</span><br></pre></td></tr></table></figure>

<h3 id="1-2-安装依赖"><a href="#1-2-安装依赖" class="headerlink" title="1.2 安装依赖"></a>1.2 安装依赖</h3><blockquote>
<p>接下来我们准备下载相应的依赖包，这里需要了解一个概念，就是类型定义文件</p>
</blockquote>
<h4 id="1-2-1-类型定义文件"><a href="#1-2-1-类型定义文件" class="headerlink" title="1.2.1 类型定义文件"></a>1.2.1 类型定义文件</h4><blockquote>
<p>因为目前主流的第三方库都是以<code>javascript</code>编写的，如果用<code>typescript</code>开发，会导致在编译的时候会出现很多找不到类型的提示，那么如果让这些库也能在<code>ts</code>中使用呢？</p>
</blockquote>
<ul>
<li>类型定义文件(<code>*.d.ts</code>)就是能够让编辑器或者插件来检测到第三方库中<code>js</code>的静态类型，这个文件是以<code>.d.ts</code>结尾- 比如说<code>react</code>的类型定义文件：<a target="_blank" rel="noopener" href="https://github.com/DefinitelyTyped/DefinitelyTyped/tree/master/types/react">https://github.com/DefinitelyTyped/DefinitelyTyped/tree/master/types/react</a></li>
<li>在<code>typescript2.0</code>中，是使用<code>@type</code>来进行类型定义，当我们使用<code>@type</code>进行类型定义，<code>typescript</code>会默认查看<code>./node_modules/@types</code>文件夹，可以通过这样来安装这个库的定义库<code>npm install @types/react --save</code></li>
</ul>
<h4 id="1-2-2-相关依赖包"><a href="#1-2-2-相关依赖包" class="headerlink" title="1.2.2 相关依赖包"></a>1.2.2 相关依赖包</h4><p><strong>React相关</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">- react // react的核心文件</span><br><span class="line">- @types/react // 声明文件</span><br><span class="line">- react-dom // react dom的操作包</span><br><span class="line">- @types/react-dom </span><br><span class="line">- react-router-dom // react路由包</span><br><span class="line">- @types/react-router-dom</span><br><span class="line">- react-redux</span><br><span class="line">- @types/react-redux</span><br><span class="line">- redux-thunk  // 中间件</span><br><span class="line">- @types/redux-logger</span><br><span class="line">- redux-logger // 中间件</span><br><span class="line">- connected-react-router</span><br><span class="line">## 执行安装依赖包</span><br><span class="line"></span><br><span class="line">npm i react react-dom @types/react @types/react-dom react-router-dom @types/react-router-dom react-redux @types/react-redux redux-thunk redux-logger @types/redux-logger connected-react-router -S</span><br></pre></td></tr></table></figure>

<p><strong>webpack相关</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- webpack // webpack的核心包</span><br><span class="line">- webpack-cli // webapck的工具包</span><br><span class="line">- webpack-dev-server // webpack的开发服务</span><br><span class="line">- html-webpack-plugin // webpack的插件，可以生成index.html文件</span><br><span class="line">npm i webpack webpack-cli webpack-dev-server html-webpack-plugin -D</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里的<code>-D</code>相当于<code>--save-dev</code>的缩写，下载开发环境的依赖包</p>
</blockquote>
<p><strong>typescript相关</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- typescript // ts的核心包</span><br><span class="line">- ts-loader // 把ts编译成指定语法比如es5 es6等的工具，有了它，基本不需要babel了，因为它会把我们的代码编译成es5</span><br><span class="line">- source-map-loader // 用于开发环境中调试ts代码</span><br><span class="line">npm i typescript ts-loader source-map-loader -D</span><br></pre></td></tr></table></figure>

<ul>
<li>从上面可以看出，基本都是模块和声明文件都是一对对出现的，有一些不是一对对出现，就是因为都集成到一起去了</li>
<li>声明文件可以在<code>node_modules/@types/xx/xx</code>中找到</li>
</ul>
<h3 id="1-3-Typescript-config配置"><a href="#1-3-Typescript-config配置" class="headerlink" title="1.3 Typescript config配置"></a>1.3 Typescript config配置</h3><blockquote>
<p>首先我们要生成一个<code>tsconfig.json</code>来告诉<code>ts-loader</code>怎样去编译这个<code>ts</code>代码</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tsc --init</span><br></pre></td></tr></table></figure>

<blockquote>
<p>会在项目中生成了一个<code>tsconfig.json</code>文件，接下来进入这个文件，来修改相关配置</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// tsconfig.json</span><br><span class="line">&#123;</span><br><span class="line">  // 编译选项</span><br><span class="line">  &quot;compilerOptions&quot;: &#123;</span><br><span class="line">    &quot;target&quot;: &quot;es5&quot;, // 编译成es5语法</span><br><span class="line">    &quot;module&quot;: &quot;commonjs&quot;, // 模块的类型</span><br><span class="line">    &quot;outDir&quot;: &quot;./dist&quot;, // 编译后的文件目录</span><br><span class="line">    &quot;sourceMap&quot;: true, // 生成sourceMap方便我们在开发过程中调试</span><br><span class="line">    &quot;noImplicitAny&quot;: true, // 每个变量都要标明类型</span><br><span class="line">    &quot;jsx&quot;: &quot;react&quot;, // jsx的版本,使用这个就不需要额外使用babel了，会编译成React.createElement</span><br><span class="line">  &#125;,</span><br><span class="line">  // 为了加快整个编译过程，我们指定相应的路径</span><br><span class="line">  &quot;include&quot;: [</span><br><span class="line">    &quot;./src/**/*&quot;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-4-webpack配置"><a href="#1-4-webpack配置" class="headerlink" title="1.4 webpack配置"></a>1.4 webpack配置</h3><blockquote>
<p>在<code>./src/</code>下创建一个<code>index.html</code>文件，并且添加``标签</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">  &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;</span><br><span class="line">  &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;div id=&#x27;app&#x27;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在<code>./</code>下创建一个<code>webpack</code>配置文件<code>webpack.config.js</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">// ./webpack.config.js</span><br><span class="line">// 引入webpack</span><br><span class="line">const webpack = require(&quot;webpack&quot;);</span><br><span class="line">// 引入webpack插件 生成index.html文件</span><br><span class="line">const HtmlWebpackPlugin = require(&quot;html-webpack-plugin&quot;);</span><br><span class="line">const path = require(&quot;path&quot;)</span><br><span class="line"></span><br><span class="line">// 把模块导出</span><br><span class="line">module.exports = &#123;</span><br><span class="line">  // 以前是jsx，因为我们用typescript写，所以这里后缀是tsx</span><br><span class="line">  entry:&quot;./src/index.tsx&quot;,</span><br><span class="line">  // 指定模式为开发模式</span><br><span class="line">  mode:&quot;development&quot;,</span><br><span class="line">  // 输出配置</span><br><span class="line">  output:&#123;</span><br><span class="line">    // 输出目录为当前目录下的dist目录</span><br><span class="line">    path:path.resolve(__dirname,&#x27;dist&#x27;),</span><br><span class="line">    // 输出文件名</span><br><span class="line">    filename:&quot;index.js&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  // 为了方便调试，还要配置一下调试工具</span><br><span class="line">  devtool:&quot;source-map&quot;,</span><br><span class="line">  // 解析路径，查找模块的时候使用</span><br><span class="line">  resolve:&#123;</span><br><span class="line">    // 一般写模块不会写后缀，在这里配置好相应的后缀，那么当我们不写后缀时，会按照这个后缀优先查找</span><br><span class="line">    extensions:[&quot;.ts&quot;,&#x27;.tsx&#x27;,&#x27;.js&#x27;,&#x27;.json&#x27;]</span><br><span class="line">  &#125;,</span><br><span class="line">  // 解析处理模块的转化</span><br><span class="line">  module:&#123;</span><br><span class="line">    // 遵循的规则</span><br><span class="line">    rules:[</span><br><span class="line">      &#123;</span><br><span class="line">        // 如果这个模块是.ts或者.tsx，则会使用ts-loader把代码转成es5</span><br><span class="line">        test:/\.tsx?$/,</span><br><span class="line">        loader:&quot;ts-loader&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        // 使用sourcemap调试</span><br><span class="line">        // enforce:pre表示这个loader要在别的loader执行前执行</span><br><span class="line">        enforce:&quot;pre&quot;,</span><br><span class="line">        test:/\.js$/,</span><br><span class="line">        loader:&quot;source-map-loader&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  // 插件的配置</span><br><span class="line">  plugins:[</span><br><span class="line">    // 这个插件是生成index.html</span><br><span class="line">    new HtmlWebpackPlugin(&#123;</span><br><span class="line">      // 以哪个文件为模板，模板路径</span><br><span class="line">      template:&quot;./src/index.html&quot;,</span><br><span class="line">      // 编译后的文件名</span><br><span class="line">      filename:&quot;index.html&quot;</span><br><span class="line">    &#125;),</span><br><span class="line">    new webpack.HotModuleReplacementPlugin()</span><br><span class="line">  ],</span><br><span class="line">  // 开发环境服务配置</span><br><span class="line">  devServer:&#123;</span><br><span class="line">    // 启动热更新,当模块、组件有变化，不会刷新整个页面，而是局部刷新</span><br><span class="line">    // 需要和插件webpack.HotModuleReplacementPlugin配合使用</span><br><span class="line">    hot:true, </span><br><span class="line">    // 静态资源目录</span><br><span class="line">    contentBase:path.resolve(__dirname,&#x27;dist&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>那么我们怎么运行这个<code>webpack.config.js</code>呢？这就需要我们在<code>package.json</code>配置一下脚本</p>
</blockquote>
<ul>
<li>在<code>package.json</code>里的<code>script</code>，添加<code>build</code>和<code>dev</code>的配置</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;ts_react_demo&quot;,</span><br><span class="line">  &quot;version&quot;: &quot;1.0.0&quot;,</span><br><span class="line">  &quot;description&quot;: &quot;&quot;,</span><br><span class="line">  &quot;main&quot;: &quot;index.js&quot;,</span><br><span class="line">  &quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;build&quot;: &quot;webpack&quot;,</span><br><span class="line">    &quot;dev&quot;:&quot;webpack-dev-server&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;keywords&quot;: [],</span><br><span class="line">  &quot;author&quot;: &quot;&quot;,</span><br><span class="line">  &quot;license&quot;: &quot;ISC&quot;,</span><br><span class="line">  &quot;dependencies&quot;: &#123;</span><br><span class="line">    &quot;@types/react&quot;: &quot;^16.7.13&quot;,</span><br><span class="line">    &quot;@types/react-dom&quot;: &quot;^16.0.11&quot;,</span><br><span class="line">    &quot;@types/react-redux&quot;: &quot;^6.0.10&quot;,</span><br><span class="line">    &quot;@types/react-router-dom&quot;: &quot;^4.3.1&quot;,</span><br><span class="line">    &quot;connected-react-router&quot;: &quot;^5.0.1&quot;,</span><br><span class="line">    &quot;react&quot;: &quot;^16.6.3&quot;,</span><br><span class="line">    &quot;react-dom&quot;: &quot;^16.6.3&quot;,</span><br><span class="line">    &quot;react-redux&quot;: &quot;^6.0.0&quot;,</span><br><span class="line">    &quot;react-router-dom&quot;: &quot;^4.3.1&quot;,</span><br><span class="line">    &quot;redux-logger&quot;: &quot;^3.0.6&quot;,</span><br><span class="line">    &quot;redux-thunk&quot;: &quot;^2.3.0&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;devDependencies&quot;: &#123;</span><br><span class="line">    &quot;html-webpack-plugin&quot;: &quot;^3.2.0&quot;,</span><br><span class="line">    &quot;source-map-loader&quot;: &quot;^0.2.4&quot;,</span><br><span class="line">    &quot;ts-loader&quot;: &quot;^5.3.1&quot;,</span><br><span class="line">    &quot;typescript&quot;: &quot;^3.2.1&quot;,</span><br><span class="line">    &quot;webpack&quot;: &quot;^4.27.1&quot;,</span><br><span class="line">    &quot;webpack-cli&quot;: &quot;^3.1.2&quot;,</span><br><span class="line">    &quot;webpack-dev-server&quot;: &quot;^3.1.10&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>因为入口文件是<code>index.tsx</code>，那么我们在<code>./src/</code>下创建一个<code>index.tsx</code>，并且在里面写入一段代码，看看<code>webpack</code>是否能够正常编译</li>
<li>因为我们在<code>webpack.config.js</code>中<code>entry</code>设置的入口文件是<code>index.tsx</code>，并且在<code>module</code>中的<code>rules</code>会识别到<code>.tsx</code>格式的文件，然后执行相应的<code>ts-loader</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// ./src/index.tsx</span><br><span class="line">console.log(&quot;hello poetries&quot;)</span><br></pre></td></tr></table></figure>

<ul>
<li>接下来我们<code>npm run build</code>一下，看看能不能正常编译</li>
<li>编译成功，我们可以看看<code>./dist/</code>下生成了<code>index.html index.js index.js.map</code>三个文件</li>
<li>那么我们在开发过程中，不会每次都<code>npm run build</code>来看修改的结果，那么我们平时开发过程中可以使用<code>npm run dev</code>。这样就启动成功了一个<code>http://localhost:8080/</code>的服务了。</li>
<li>接下来我们看看热更新是否配置正常，在<code>./src/index.tsx</code>中新增一个<code>console.log(&#39;hello poetries&#39;)</code>，我们发现浏览器的控制台会自动打印出这一个输出，说明配置正常了</li>
</ul>
<h2 id="二、React组件"><a href="#二、React组件" class="headerlink" title="二、React组件"></a>二、React组件</h2><h3 id="2-1-写一个计数器组件"><a href="#2-1-写一个计数器组件" class="headerlink" title="2.1 写一个计数器组件"></a>2.1 写一个计数器组件</h3><blockquote>
<p>首先我们在<code>./src/</code>下创建一个文件夹<code>components</code>，然后在<code>./src/components/</code>下创建文件<code>Counter.tsx</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">// ./src/components/Counter.tsx</span><br><span class="line">// import React from &quot;react&quot;; // 之前的写法</span><br><span class="line">// 在ts中引入的写法</span><br><span class="line">import * as React from &quot;react&quot;;</span><br><span class="line"></span><br><span class="line">export default class CounterComponent extends React.Component&#123;</span><br><span class="line">  // 状态state</span><br><span class="line">  state = &#123;</span><br><span class="line">    number:0</span><br><span class="line">  &#125;</span><br><span class="line">  render()&#123;</span><br><span class="line">    return(</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;p&gt;&#123;this.state.number&#125;&lt;/p&gt;</span><br><span class="line">        &lt;button onClick=&#123;()=&gt;this.setState(&#123;number:this.state.number + 1&#125;)&#125;&gt;+&lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>我们发现，其实除了引入<code>import * as React from &quot;react&quot;</code>以外，其余的和之前的写法没什么不同。</p>
</blockquote>
<ul>
<li>接下来我们到<code>./src/index.tsx</code>中把这个组件导进来</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// ./src/index.tsx</span><br><span class="line">import * as React from &quot;react&quot;;</span><br><span class="line">import * as ReactDom from &quot;react-dom&quot;;</span><br><span class="line">import CounterComponent from &quot;./components/Counter&quot;;</span><br><span class="line">// 把我们的CounterComponent组件渲染到id为app的标签内</span><br><span class="line">ReactDom.render(&lt;CounterComponent /&gt;,document.getElementById(&quot;app&quot;))</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这样我们就把这个组件引进来了，接下来我们看下是否能够成功跑起来</p>
</blockquote>
<p><img src="https://upload-images.jianshu.io/upload_images/1480597-86ad083c5149a72e.png" alt="image.png"></p>
<blockquote>
<p>到目前为止，感觉用<code>ts</code>写<code>react</code>还是跟以前差不多，没什么区别，要记住，<code>ts</code>最大的特点就是类型检查，可以检验属性的状态类型</p>
</blockquote>
<p>假设我们需要在<code>./src/index.tsx</code>中给``传一个属性<code>name</code>，而<code>CounterComponent</code>组件需要对这个传入的<code>name</code>进行类型校验，比如说只允许传字符串</p>
<ul>
<li><code>./src/index.tsx</code>中修改一下</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ReactDom.render(&lt;CounterComponent name=&quot;poetries&quot; /&gt;,document.getElementById(&quot;app&quot;))</span><br></pre></td></tr></table></figure>

<blockquote>
<p>然后需要在<code>./src/components/Counter.tsx</code>中写一个接口来对这个<code>name</code>进行类型校验</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">// import React from &quot;react&quot;; // 之前的写法</span><br><span class="line">// 在ts中引入的写法</span><br><span class="line">import * as React from &quot;react&quot;;</span><br><span class="line"></span><br><span class="line">// 写一个接口对name进行类型校验</span><br><span class="line">// 如果我们不写校验的话，在外部传name进来会报错的</span><br><span class="line">interface IProps&#123;</span><br><span class="line">    name:string,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 我们还可以用接口约束state的状态</span><br><span class="line">interface IState&#123;</span><br><span class="line">    number: number</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 把接口约束的规则写在这里</span><br><span class="line">// 如果传入的name不符合类型会报错</span><br><span class="line">// 如果state的number属性不符合类型也会报错</span><br><span class="line">export default class CounterComponent extends React.Component&lt;IProps,IState&gt;&#123;</span><br><span class="line">  // 状态state</span><br><span class="line">  state = &#123;</span><br><span class="line">    number:0</span><br><span class="line">  &#125;</span><br><span class="line">  render()&#123;</span><br><span class="line">    return(</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">        &lt;p&gt;&#123;this.state.number&#125;&lt;/p&gt;</span><br><span class="line">        &lt;p&gt;&#123;this.props.name&#125;&lt;/p&gt;</span><br><span class="line">        &lt;button onClick=&#123;()=&gt;this.setState(&#123;number:this.state.number + 1&#125;)&#125;&gt;+&lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-结合Redux使用"><a href="#2-2-结合Redux使用" class="headerlink" title="2.2 结合Redux使用"></a>2.2 结合Redux使用</h3><h4 id="2-2-1-基础使用"><a href="#2-2-1-基础使用" class="headerlink" title="2.2.1 基础使用"></a>2.2.1 基础使用</h4><ul>
<li>上面<code>state</code>中的<code>number</code>就不放在组件里了，我们放到<code>redux</code>中，接下来我们使用<code>redux</code></li>
<li>首先在<code>./src/</code>创建<code>store</code>目录，然后在<code>./src/store/</code>创建一个文件<code>index.tsx</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// .src/store/index.tsx</span><br><span class="line">import &#123; createStore &#125; from &quot;redux&quot;;</span><br><span class="line"></span><br><span class="line">// 引入reducers</span><br><span class="line">import reducers from &quot;./reducers&quot;;</span><br><span class="line"></span><br><span class="line">// 接着创建仓库</span><br><span class="line">let store = createStore(reducers);</span><br><span class="line"></span><br><span class="line">// 导出store仓库</span><br><span class="line">export default store;</span><br></pre></td></tr></table></figure>

<ul>
<li>然后我们需要创建一个<code>reducers</code>，在<code>./src/store/</code>创建一个目录<code>reducers</code>，该目录下再创建一个文件<code>index.tsx</code>。</li>
<li>但是我们还需要对<code>reducers</code>中的函数参数进行类型校验，而且这个类型校验很多地方需要复用，那么我们需要把这个类型校验单独抽离出一个文件。</li>
<li>那么我们需要在<code>./src/</code>下创建一个<code>types</code>目录，该目录下创建一个文件<code>index.tsx</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// ./src/types/index.tsx</span><br><span class="line">// 导出一个接口</span><br><span class="line">export interface Store&#123;</span><br><span class="line">  // 我们需要约束的属性和类型</span><br><span class="line">  number:number</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>回到<code>./src/store/reducers/index.tsx</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// 导入类型校验的接口</span><br><span class="line">// 用来约束state的</span><br><span class="line">import &#123; Store &#125; from &quot;../../types/index&quot;</span><br><span class="line">// 我们需要给number赋予默认值</span><br><span class="line">let initState:Store = &#123; number:0 &#125;</span><br><span class="line">// 把接口写在state:Store</span><br><span class="line">export default function (state:Store=initState,action) &#123;</span><br><span class="line">  // 拿到老的状态state和新的状态action</span><br><span class="line">  // action是一个动作行为，而这个动作行为，在计数器中是具备 加 或 减 两个功能</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>上面这段代码暂时先这样，因为需要用到<code>action</code>，我们现在去配置一下<code>action</code>相关的，首先我们在<code>./src/store</code>下创建一个<code>actions</code>目录，并且在该目录下创建文件<code>counter.tsx</code></li>
<li>因为配置<code>./src/store/actions/counter.tsx</code>会用到动作类型，而这个动作类型是属于常量，为了更加规范我们的代码，我们在<code>./src/store/</code>下创建一个<code>action-types.tsx</code>，里面写相应常量</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// ./src/store/action-types.tsx</span><br><span class="line">export const ADD = &quot;ADD&quot;;</span><br><span class="line">export const SUBTRACT = &quot;SUBTRACT&quot;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>回到<code>./src/store/actions/counter.tsx</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// ./src/store/actions/counter.tsx</span><br><span class="line">import * as types from &quot;../action-types&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">  add()&#123;</span><br><span class="line">    // 需要返回一个action对象</span><br><span class="line">    // type为动作的类型</span><br><span class="line">    return &#123; type: types.ADD&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  subtract()&#123;</span><br><span class="line">    // 需要返回一个action对象</span><br><span class="line">    // type为动作的类型</span><br><span class="line">    return &#123; type: types.SUBTRACT&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>我们可以想一下，上面<code>return &#123; type:types.ADD &#125;</code>实际上是返回一个<code>action</code>对象，将来使用的时候，是会传到<code>./src/store/reducers/index.tsx</code>的<code>action</code>中，那么我们怎么定义这个<code>action</code>的结构呢？</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">// ./src/store/actions/counter.tsx</span><br><span class="line">import * as types from &quot;../action-types&quot;;</span><br><span class="line"></span><br><span class="line">// 定义两个接口，分别约束add和subtract的type类型</span><br><span class="line">export interface Add&#123;</span><br><span class="line">  type:typeof types.ADD</span><br><span class="line">&#125;</span><br><span class="line">export interface Subtract&#123;</span><br><span class="line">  type:typeof types.SUBTRACT</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 再导出一个type</span><br><span class="line">// type是用来给类型起别名的</span><br><span class="line">// 这个actions里是一个对象，会有很多函数，每个函数都会返回一个action</span><br><span class="line">// 而 ./store/reducers/index.tsx中的action会是下面某一个函数的返回值</span><br><span class="line"></span><br><span class="line">export type Action = Add | Subtract</span><br><span class="line"></span><br><span class="line">// 把上面定义好的接口作用于下面</span><br><span class="line">// 约束返回值的类型</span><br><span class="line">export default &#123;</span><br><span class="line">  add():Add&#123;</span><br><span class="line">    // 需要返回一个action对象</span><br><span class="line">    // type为动作的类型</span><br><span class="line">    return &#123; type: types.ADD&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  subtract():Subtract&#123;</span><br><span class="line">    // 需要返回一个action对象</span><br><span class="line">    // type为动作的类型</span><br><span class="line">    return &#123; type: types.SUBTRACT&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>接着我们回到<code>./store/reducers/index.tsx</code></p>
</blockquote>
<p>经过上面一系列的配置，我们可以给<code>action</code>使用相应的接口约束了并且根据不同的<code>action</code>动作行为来进行不同的处理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">// ./store/reducers/index.tsx</span><br><span class="line">// 导入类型校验的接口</span><br><span class="line">// 用来约束state的</span><br><span class="line">import &#123; Store &#125; from &quot;../../types/index&quot;</span><br><span class="line"></span><br><span class="line">// 导入约束action的接口</span><br><span class="line">import &#123; Action &#125; from &quot;../actions/counter&quot;</span><br><span class="line"></span><br><span class="line">// 引入action动作行为的常量</span><br><span class="line">import * as types from &quot;../action-types&quot;</span><br><span class="line"></span><br><span class="line">// 我们需要给number赋予默认值</span><br><span class="line">let initState:Store = &#123; number:0 &#125;</span><br><span class="line"></span><br><span class="line">// 把接口写在state:Store</span><br><span class="line">export default function (state:Store=initState,action:Action) &#123;</span><br><span class="line">  // 拿到老的状态state和新的状态action</span><br><span class="line">  // action是一个动作行为，而这个动作行为，在计数器中是具备 加 或 减 两个功能</span><br><span class="line">  // 判断action的行为类型</span><br><span class="line">  switch (action.type) &#123;</span><br><span class="line">    case types.ADD:</span><br><span class="line">        // 当action动作行为是ADD的时候，给number加1</span><br><span class="line">        return &#123; number:state.number + 1 &#125;</span><br><span class="line">      break;</span><br><span class="line">    case types.SUBTRACT:</span><br><span class="line">        // 当action动作行为是SUBTRACT的时候，给number减1</span><br><span class="line">        return &#123; number:state.number - 1 &#125;</span><br><span class="line">      break;</span><br><span class="line">    default:</span><br><span class="line">        // 当没有匹配到则返回原本的state</span><br><span class="line">        return state</span><br><span class="line">      break;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>接下来，我们怎么样把组件和仓库建立起关系呢</p>
</blockquote>
<p>首先进入<code>./src/index.tsx</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">// ./src/index.tsx</span><br><span class="line">import * as React from &quot;react&quot;;</span><br><span class="line">import * as ReactDom from &quot;react-dom&quot;;</span><br><span class="line"></span><br><span class="line">// 引入redux这个库的Provider组件</span><br><span class="line">import &#123; Provider &#125; from &quot;react-redux&quot;;</span><br><span class="line"></span><br><span class="line">// 引入仓库</span><br><span class="line">import store from &#x27;./store&#x27;</span><br><span class="line"></span><br><span class="line">import CounterComponent from &quot;./components/Counter&quot;;</span><br><span class="line"></span><br><span class="line">// 用Provider包裹CounterComponent组件</span><br><span class="line">// 并且把store传给Provider</span><br><span class="line">// 这样Provider可以向它的子组件提供store</span><br><span class="line">ReactDom.render((</span><br><span class="line">  &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">    &lt;CounterComponent name=&quot;poetries&quot;/&gt;</span><br><span class="line">  &lt;/Provider&gt;</span><br><span class="line">),document.getElementById(&quot;app&quot;))</span><br></pre></td></tr></table></figure>

<blockquote>
<p>我们到组件内部建立连接，<code>./src/components/Counter.tsx</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">// import React from &quot;react&quot;; // 之前的写法</span><br><span class="line">// 在ts中引入的写法</span><br><span class="line">import * as React from &quot;react&quot;;</span><br><span class="line"></span><br><span class="line">// 引入connect，让组件和仓库建立连接</span><br><span class="line">import &#123; connect &#125; from &quot;react-redux&quot;;</span><br><span class="line"></span><br><span class="line">// 引入actions，用于传给connect</span><br><span class="line">import actions from &quot;../store/actions/counter&quot;;</span><br><span class="line"></span><br><span class="line">// 引入接口约束</span><br><span class="line">import &#123; Store &#125; from &quot;../types&quot;;</span><br><span class="line"></span><br><span class="line">// 接口约束</span><br><span class="line">interface IProps&#123;</span><br><span class="line">  number:number,</span><br><span class="line"></span><br><span class="line">  name:string, //如果我们不写校验的话，在外部传name进来会报错的</span><br><span class="line"></span><br><span class="line">  // add是一个函数</span><br><span class="line">  add:any,</span><br><span class="line"></span><br><span class="line">  // subtract是一个函数</span><br><span class="line">  subtract:any</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 我们还可以用接口约束state的状态</span><br><span class="line">interface IState&#123;</span><br><span class="line">    number: number</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 把接口约束的规则写在这里</span><br><span class="line">// 如果传入的name不符合类型会报错</span><br><span class="line">// 如果state的number属性不符合类型也会报错</span><br><span class="line">class CounterComponent extends React.Component&lt;IProps,IState&gt;&#123;</span><br><span class="line">  // 状态state</span><br><span class="line">  state = &#123;</span><br><span class="line">    number:0</span><br><span class="line">  &#125;</span><br><span class="line">  render()&#123;</span><br><span class="line">    // 利用解构赋值取出</span><br><span class="line">    // 这里比如和IProps保持一致，不对应则会报错，因为接口约束了必须这样</span><br><span class="line">    let &#123; number,add,subtract &#125; = this.props</span><br><span class="line"></span><br><span class="line">    return(</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;h1&gt;&#123;this.props.name&#125;&lt;/h1&gt;</span><br><span class="line">            &lt;button onClick=&#123;add&#125;&gt;+&lt;/button&gt;&lt;br /&gt;</span><br><span class="line">            &lt;button onClick=&#123;subtract&#125;&gt;-&lt;/button&gt;  </span><br><span class="line">            &lt;p&gt;&#123;number&#125;&lt;/p&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 这个connect需要执行两次，第二次需要我们把这个组件CounterComponent传进去</span><br><span class="line">// connect第一次执行，需要两个参数，</span><br><span class="line"></span><br><span class="line">// 需要传给connect的函数</span><br><span class="line">let mapStateToProps = function (state:Store) &#123;</span><br><span class="line">    return state</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">export default connect(</span><br><span class="line">    mapStateToProps,</span><br><span class="line">    actions</span><br><span class="line">)(CounterComponent);</span><br></pre></td></tr></table></figure>

<p>这时候看到成功执行了</p>
<p><img src="https://upload-images.jianshu.io/upload_images/1480597-32fc82d43dadb063.png" alt="image.png"></p>
<ul>
<li>其实搞来搞去，跟原来的写法差不多，主要就是<code>ts</code>会进行类型检查。</li>
<li>如果对<code>number</code>进行异步修改，该怎么处理？这就需要我们用到<code>redux-thunk</code></li>
</ul>
<blockquote>
<p>接着我们回到<code>./src/store/index.tsx</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// 需要使用到thunk，所以引入中间件applyMiddleware</span><br><span class="line">import &#123; createStore, applyMiddleware &#125; from &quot;redux&quot;;</span><br><span class="line"></span><br><span class="line">// 引入reducers</span><br><span class="line">import reducers from &quot;./reducers&quot;;</span><br><span class="line"></span><br><span class="line">// 引入redux-thunk，处理异步</span><br><span class="line">// 现在主流处理异步的是saga和thunk</span><br><span class="line">import thunk from &quot;redux-thunk&quot;;</span><br><span class="line"></span><br><span class="line">// 引入日志</span><br><span class="line">import logger from &quot;redux-logger&quot;;</span><br><span class="line"></span><br><span class="line">// 接着创建仓库和中间件</span><br><span class="line">let store = createStore(reducers, applyMiddleware(thunk,logger));</span><br><span class="line"></span><br><span class="line">// 导出store仓库</span><br><span class="line">export default store;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>接着我们回来<code>./src/store/actions</code>，新增一个异步的动作行为</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">// ./src/store/actions/counter.tsx</span><br><span class="line">import * as types from &quot;../action-types&quot;;</span><br><span class="line"></span><br><span class="line">// 定义两个接口，分别约束add和subtract的type类型</span><br><span class="line">export interface Add&#123;</span><br><span class="line">  type:typeof types.ADD</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export interface Subtract&#123;</span><br><span class="line">  type:typeof types.SUBTRACT</span><br><span class="line">&#125;</span><br><span class="line">// 再导出一个type</span><br><span class="line">// type是用来给类型起别名的</span><br><span class="line">// 这个actions里是一个对象，会有很多函数，每个函数都会返回一个action</span><br><span class="line">// 而 ./store/reducers/index.tsx中的action会是下面某一个函数的返回值</span><br><span class="line"></span><br><span class="line">export type Action = Add | Subtract</span><br><span class="line"></span><br><span class="line">// 把上面定义好的接口作用于下面</span><br><span class="line">// 约束返回值的类型</span><br><span class="line">export default &#123;</span><br><span class="line">  add():Add&#123;</span><br><span class="line">    // 需要返回一个action对象</span><br><span class="line">    // type为动作的类型</span><br><span class="line">    return &#123; type: types.ADD&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  subtract():Subtract&#123;</span><br><span class="line">    // 需要返回一个action对象</span><br><span class="line">    // type为动作的类型</span><br><span class="line">    return &#123; type: types.SUBTRACT&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  // 一秒后才执行这个行为</span><br><span class="line">  // ++</span><br><span class="line">  addAsync():any&#123;</span><br><span class="line">    return function (dispatch:any,getState:any) &#123;</span><br><span class="line">      setTimeout(function()&#123;</span><br><span class="line">        // 当1秒过后，会执行dispatch，派发出去，然后改变仓库的状态</span><br><span class="line">        dispatch(&#123;type:types.ADD&#125;)</span><br><span class="line">      &#125;, 1000);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>到<code>./src/components/Counter.tsx</code>组件内，使用这个异步</p>
</blockquote>
<h4 id="2-2-2-合并reducers"><a href="#2-2-2-合并reducers" class="headerlink" title="2.2.2 合并reducers"></a>2.2.2 合并reducers</h4><blockquote>
<p>假如我们的项目里面，有两个计数器，而且它俩是完全没有关系的，状态也是完全独立的，这个时候就需要用到合并<code>reducers</code>了</p>
</blockquote>
<ul>
<li>首先我们新增<code>action</code>的动作行为类型，在<code>./src/store/action-types.tsx</code></li>
<li>然后修改接口文件，<code>./src/types/index.tsx</code></li>
<li>然后把<code>./src/store/actions/counter.tsx</code>文件拷贝在当前目录并且修改名称为<code>counter2.tsx</code></li>
<li>然后把<code>./src/store/reduces/index.tsx</code>拷贝并且改名为<code>counter.tsx</code>和<code>counter2.tsx</code></li>
</ul>
<blockquote>
<p>我们多个<code>reducer</code>是通过<code>combineReducers</code>方法，进行合并的，因为我们一个项目当中肯定是存在非常多个<code>reducer</code>，所以统一在这里处理。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// ./src/store/reducers/index.tsc</span><br><span class="line"></span><br><span class="line">// 引入合并方法</span><br><span class="line">import &#123; combineReducers &#125; from &quot;redux&quot;;</span><br><span class="line"></span><br><span class="line">// 引入需要合并的reducer</span><br><span class="line">import counter from &quot;./counter&quot;;</span><br><span class="line"></span><br><span class="line">// 引入需要合并的reducer</span><br><span class="line">import counter2 from &quot;./counter2&quot;;</span><br><span class="line"></span><br><span class="line">// 合并</span><br><span class="line">let reducers = combineReducers(&#123;</span><br><span class="line">  counter,</span><br><span class="line">  counter2,</span><br><span class="line">&#125;);</span><br><span class="line">export default reducers;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>最后修改组件，进入<code>./src/components/</code>,其中</p>
</blockquote>
<p>到目前为止，我们完成了<code>reducers</code>的合并了，那么我们看看效果如何，首先我们给<code>./src/index.tsc</code>添加<code>Counter2</code>组件，这样的目的是与<code>Counter</code>组件完全独立，互不影响，但是又能够最终合并到<code>readucers</code></p>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/548.png" alt="img"></p>
<h3 id="2-3-路由"><a href="#2-3-路由" class="headerlink" title="2.3 路由"></a>2.3 路由</h3><h4 id="2-3-1-基本用法"><a href="#2-3-1-基本用法" class="headerlink" title="2.3.1 基本用法"></a>2.3.1 基本用法</h4><blockquote>
<p>首先进入<code>./src/index.tsx</code>导入我们的路由所需要的依赖包</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">// ./src/index.tsx</span><br><span class="line">import * as React from &quot;react&quot;;</span><br><span class="line">import * as ReactDom from &quot;react-dom&quot;;</span><br><span class="line"></span><br><span class="line">// 引入redux这个库的Provider组件</span><br><span class="line">import &#123; Provider &#125; from &quot;react-redux&quot;;</span><br><span class="line"></span><br><span class="line">// 引入路由</span><br><span class="line">// 路由的容器:HashRouter as Router</span><br><span class="line">// 路由的规格:Route</span><br><span class="line">// Link组件</span><br><span class="line">import &#123; BrowserRouter as Router,Route,Link &#125; from &quot;react-router-dom&quot;</span><br><span class="line"></span><br><span class="line">// 引入仓库</span><br><span class="line">import store from &#x27;./store&#x27;</span><br><span class="line"></span><br><span class="line">import CounterComponent from &quot;./components/Counter&quot;;</span><br><span class="line">import CounterComponent2 from &quot;./components/Counter2&quot;;</span><br><span class="line">import Counter from &quot;./components/Counter&quot;;</span><br><span class="line"></span><br><span class="line">function Home() &#123;</span><br><span class="line">    return &lt;div&gt;home&lt;/div&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 用Provider包裹CounterComponent组件</span><br><span class="line">// 并且把store传给Provider</span><br><span class="line">// 这样Provider可以向它的子组件提供store</span><br><span class="line">ReactDom.render((</span><br><span class="line">  &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">    &#123;/* 路由组件 */&#125;</span><br><span class="line">    &lt;Router&gt;</span><br><span class="line">      &#123;/*  放两个路由规则需要在外层套个React.Fragment */&#125;</span><br><span class="line">        &lt;React.Fragment&gt;</span><br><span class="line">            &#123;/* 增加导航 */&#125;</span><br><span class="line">            &lt;ul&gt;</span><br><span class="line">            &lt;li&gt;&lt;Link to=&quot;/&quot;&gt;Home&lt;/Link&gt;&lt;/li&gt;</span><br><span class="line">            &lt;li&gt;&lt;Link to=&quot;/counter&quot;&gt;Counter&lt;/Link&gt;&lt;/li&gt;</span><br><span class="line">            &lt;li&gt;&lt;Link to=&quot;/counter2&quot;&gt;Counter2&lt;/Link&gt;&lt;/li&gt;</span><br><span class="line">            &lt;/ul&gt;</span><br><span class="line">            &#123;/* 当路径为 / 时是home组件 */&#125;</span><br><span class="line">            &#123;/* 为了避免home组件一直渲染，我们可以添加属性exact */&#125;</span><br><span class="line">            &lt;Route exact path=&quot;/&quot; component=&#123;Home&#125;/&gt;</span><br><span class="line">            &lt;Route path=&quot;/counter&quot; component=&#123;CounterComponent&#125;/&gt;</span><br><span class="line">            &lt;Route path=&quot;/counter2&quot; component=&#123;CounterComponent2&#125; /&gt;</span><br><span class="line">        &lt;/React.Fragment&gt;</span><br><span class="line">        &lt;/Router&gt;</span><br><span class="line">  &lt;/Provider&gt;</span><br><span class="line">),document.getElementById(&quot;app&quot;))</span><br></pre></td></tr></table></figure>

<p><img src="https://poetries1.gitee.io/img-repo/2019/10/549.png" alt="img"></p>
<blockquote>
<p>但是有个很大的问题，就是我们直接访问<code>http://localhost:8080/counter</code>会找不到路由</p>
</blockquote>
<ul>
<li>因为我们的是单页面应用，不管路由怎么变更，实际上都是访问<code>index.html</code>这个文件，所以当我们访问根路径的时候，能够正常访问，因为<code>index.html</code>文件就放在这个目录下，但是当我们通过非根路径的路由访问，则出错了，是因为我们在相应的路径没有这个文件，所以出错了</li>
<li>从这一点也可以衍生出一个实战经验，我们平时项目部署上线的时候，会出现这个问题，一般我们都是用<code>nginx</code>来把访问的路径都是指向<code>index.html</code>文件，这样就能够正常访问了。</li>
<li>那么针对目前我们这个情况，我们可以通过修改<code>webpack</code>配置，让路由不管怎么访问，都是指向我们制定的<code>index.html</code>文件。</li>
</ul>
<blockquote>
<p>进入<code>./webpack.config.js</code>，在<code>devServer</code>的配置对象下新增一些配置</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// ./webpack.config.js</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">  // 开发环境服务配置</span><br><span class="line">  devServer:&#123;</span><br><span class="line">    // 启动热更新,当模块、组件有变化，不会刷新整个页面，而是局部刷新</span><br><span class="line">    // 需要和插件webpack.HotModuleReplacementPlugin配合使用</span><br><span class="line">    hot:true, </span><br><span class="line">    // 静态资源目录</span><br><span class="line">    contentBase:path.resolve(__dirname,&#x27;dist&#x27;),</span><br><span class="line">    // 不管访问什么路径，都重定向到index.html</span><br><span class="line">    historyApiFallback:&#123;</span><br><span class="line">      index:&quot;./index.html&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<blockquote>
<p>修改<code>webpack</code>配置需要重启服务，然后重启服务，看看浏览器能否正常访问<code>http://localhost:8080/counter</code></p>
</blockquote>
<h4 id="2-3-2-同步路由到redux"><a href="#2-3-2-同步路由到redux" class="headerlink" title="2.3.2 同步路由到redux"></a>2.3.2 同步路由到redux</h4><blockquote>
<p>路由的路径，如何同步到仓库当中。以前是用一个叫<code>react-router-redux</code>的库，把路由和<code>redux</code>结合到一起的，<code>react-router-redux</code>挺好用的，但是这个库不再维护了，被废弃了，所以现在推荐使用<code>connected-react-router</code>这个库，可以把路由状态映射到仓库当中</p>
</blockquote>
<blockquote>
<p>首先我们在<code>./src</code>下创建文件<code>history.tsx</code></p>
</blockquote>
<p>假设我有一个需求，就是我不通过<code>Link</code>跳转页面，而是通过编程式导航，触发一个动作，然后这个动作会派发出去，而且把路由信息放到<code>redux</code>中，供我以后查看。</p>
<blockquote>
<p>我们进入<code>./src/store/reducers/index.tsx</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">// 引入合并方法</span><br><span class="line">import &#123; combineReducers &#125; from &quot;redux&quot;;</span><br><span class="line"></span><br><span class="line">// 引入需要合并的reducer</span><br><span class="line">import counter from &quot;./counter&quot;;</span><br><span class="line"></span><br><span class="line">// 引入需要合并的reducer</span><br><span class="line">import counter2 from &quot;./counter2&quot;;</span><br><span class="line"></span><br><span class="line">// 引入connectRouter</span><br><span class="line">import &#123; connectRouter &#125; from &quot;connected-react-router&quot;;</span><br><span class="line">import history from &quot;../../history&quot;;</span><br><span class="line"></span><br><span class="line">// 合并</span><br><span class="line">let reducers = combineReducers(&#123;</span><br><span class="line">  counter,</span><br><span class="line">  counter2,</span><br><span class="line">  // 把history传到connectRouter函数中</span><br><span class="line">  router: connectRouter(history)</span><br><span class="line">&#125;);</span><br><span class="line">export default reducers;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>我们进入<code>./src/store/index.tsx</code>来添加中间件</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">// 需要使用到thunk，所以引入中间件applyMiddleware</span><br><span class="line">import &#123; createStore, applyMiddleware &#125; from &quot;redux&quot;;</span><br><span class="line"></span><br><span class="line">// 引入reducers</span><br><span class="line">import reducers from &quot;./reducers&quot;;</span><br><span class="line"></span><br><span class="line">// 引入redux-thunk，处理异步</span><br><span class="line">// 现在主流处理异步的是saga和thunk</span><br><span class="line">import thunk from &quot;redux-thunk&quot;;</span><br><span class="line"></span><br><span class="line">// 引入日志</span><br><span class="line">import logger from &quot;redux-logger&quot;;</span><br><span class="line"></span><br><span class="line">// 引入中间件</span><br><span class="line">import &#123; routerMiddleware &#125; from &quot;connected-react-router&quot;;</span><br><span class="line">import history from &quot;../history&quot;;</span><br><span class="line"></span><br><span class="line">// 接着创建仓库和中间件</span><br><span class="line">let store = createStore(reducers, applyMiddleware(routerMiddleware(history),thunk,logger));</span><br><span class="line"></span><br><span class="line">// 导出store仓库</span><br><span class="line">export default store;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>我们进入<code>./src/store/actions/counter.tsx</code>加个<code>goto</code>方法用来跳转</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">// ./src/store/actions/counter.tsx</span><br><span class="line">import * as types from &quot;../action-types&quot;;</span><br><span class="line"></span><br><span class="line">// 引入push方法</span><br><span class="line">import &#123; push &#125; from &quot;connected-react-router&quot;;</span><br><span class="line"></span><br><span class="line">// 定义两个接口，分别约束add和subtract的type类型</span><br><span class="line">export interface Add&#123;</span><br><span class="line">  type:typeof types.ADD</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export interface Subtract&#123;</span><br><span class="line">  type:typeof types.SUBTRACT</span><br><span class="line">&#125;</span><br><span class="line">// 再导出一个type</span><br><span class="line">// type是用来给类型起别名的</span><br><span class="line">// 这个actions里是一个对象，会有很多函数，每个函数都会返回一个action</span><br><span class="line">// 而 ./store/reducers/index.tsx中的action会是下面某一个函数的返回值</span><br><span class="line"></span><br><span class="line">export type Action = Add | Subtract</span><br><span class="line"></span><br><span class="line">// 把上面定义好的接口作用于下面</span><br><span class="line">// 约束返回值的类型</span><br><span class="line">export default &#123;</span><br><span class="line">  add():Add&#123;</span><br><span class="line">    // 需要返回一个action对象</span><br><span class="line">    // type为动作的类型</span><br><span class="line">    return &#123; type: types.ADD&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  subtract():Subtract&#123;</span><br><span class="line">    // 需要返回一个action对象</span><br><span class="line">    // type为动作的类型</span><br><span class="line">    return &#123; type: types.SUBTRACT&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  // 一秒后才执行这个行为</span><br><span class="line">  addAsync():any&#123;</span><br><span class="line">    return function (dispatch:any,getState:any) &#123;</span><br><span class="line">      setTimeout(function()&#123;</span><br><span class="line">        // 当1秒过后，会执行dispatch，派发出去，然后改变仓库的状态</span><br><span class="line">        dispatch(&#123;type:types.ADD&#125;)</span><br><span class="line">      &#125;, 1000);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  goto(path:string)&#123;</span><br><span class="line">    // 派发一个动作</span><br><span class="line">    // 这个push是connected-react-router里的一个方法</span><br><span class="line">    // 返回一个跳转路径的action</span><br><span class="line">    return push(path)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>我们进入<code>./src/components/Counter.tsx</code>中加个按钮，当我点击按钮的时候，会向仓库派发<code>action</code>，仓库的<code>action</code>里有中间件，会把我们这个请求拦截到，然后跳转</p>
</blockquote>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">ChengWei</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://example.com/2021/02/14/React-Redux-配置Ts/">http://example.com/2021/02/14/React-Redux-配置Ts/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/React/">React</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2021/02/26/React-render%E7%9A%84%E5%8E%9F%E7%90%86/"><i class="fa fa-chevron-left">  </i><span>React-render</span></a></div><div class="next-post pull-right"><a href="/2021/02/03/React-Jsx%E8%BD%AC%E6%8D%A2%E6%88%90%E7%9C%9F%E5%AE%9EDOM%E8%BF%87%E7%A8%8B/"><span>React-Jsx转换成真实DOM过程</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fpic1.win4000.com%2Fwallpaper%2F6%2F53cca8e7873e6.jpg&amp;refer=http%3A%2F%2Fpic1.win4000.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1664449271&amp;t=4f4642aaba02226ad62910f50b366e4b)"><div class="layout" id="footer"><div class="copyright">&copy;2018 - 2022 By ChengWei</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">hitokoto</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/lib/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.1"></script><script src="/js/fancybox.js?version=1.9.1"></script><script src="/js/sidebar.js?version=1.9.1"></script><script src="/js/copy.js?version=1.9.1"></script><script src="/js/fireworks.js?version=1.9.1"></script><script src="/js/transition.js?version=1.9.1"></script><script src="/js/scroll.js?version=1.9.1"></script><script src="/js/head.js?version=1.9.1"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>