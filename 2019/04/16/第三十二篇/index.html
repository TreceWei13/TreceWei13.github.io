<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="async和await 原来这么简单"><meta name="keywords" content="js"><meta name="author" content="ChengWei"><meta name="copyright" content="ChengWei"><title>async和await 原来这么简单 | Chengcw'博客</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.1"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://v1.hitokoto.cn/?encode=js&amp;charset=utf-8&amp;select=.footer_custom_text" defer></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '5.4.2'
} </script><meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="Chengcw'博客" type="application/atom+xml">
</head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://wx2.sinaimg.cn/thumb150/008soxMJly1h0v1m20khej30u00u0td0.jpg"></div><div class="author-info__name text-center">ChengWei</div><div class="author-info__description text-center"></div><div class="follow-button"><a target="_blank" rel="noopener" href="https://github.com/USERNAME">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">41</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">15</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">12</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://ts1.cn.mm.bing.net/th/id/R-C.af6f75e39afef25fe0a57e0d3056bd5b?rik=89dax9livGUPug&amp;riu=http%3a%2f%2fn.sinaimg.cn%2fsinacn10109%2f320%2fw1200h720%2f20190209%2fa360-hsqyiwu5104217.jpg&amp;ehk=a3MK%2frKIn7q16f%2fY4UwfLfeHh%2fHngXcB3WE5cpbIoC0%3d&amp;risl=&amp;pid=ImgRaw&amp;r=0)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Chengcw'博客</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">首页</a><a class="site-page" href="/archives">文章</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">async和await 原来这么简单</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-04-16</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/js/">js</a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p>回调函数<br>如果说这些异步之间不会相互依赖或者不会因为顺序不确定收到影响是么有关系的，但是如果我们一些逻辑需要依赖某个异步的返回值那么这个时候我们就需要保证执行顺序，这时候我们就需到了回调函数，举个例子：fun2需要fun1异步执行后的结果，fun3又依赖于 fun2 异步执行结束后的结果，所以我们通过回调函数来保证执行顺序。</p>
<img src="https://img-blog.csdnimg.cn/739b5c3370d74e1cbb2ed27647f52d9c.png" class="">
<p>Promise<br>我们能够看出上面的代码中，多级嵌套的回调函数，弊端很多：不直观，强耦合，回调的不确定性，不利于维护与复用，我们上面仅仅是非常简单的一个场景，那如果我们有很复杂的需求的话非常多的回调嵌套就容易产生回调地狱。为了解决这个问题，Promise 出现了，它将这种回调函数的嵌套改为链式调用。并用then保证执行顺序。Promise还能保证每次返回的都是一个新的Promise对象，所以代码一定被异步执行。</p>
<img src="https://img-blog.csdnimg.cn/990ba16e00304d448d44c130cb6a39a8.png" class="">
<img src="https://img-blog.csdnimg.cn/74356ba00f6b44249345d26cd0355528.png" class="">
<p>我们发现上面的代码可读性就明显略胜一筹，通过这样一个链式的结构让我们清晰的看出谁依赖谁，对我们的后期代码维护更加友好，但这也仅仅是我们的一个小小的案例，如果是复杂的业务的话我们一直链式其实可读性也会随之增多也变得费劲。</p>
<p>async、await<br>Promise 是为了避免回调地狱的，但是 Promise 还是不够简明，语义化，随着业务逻辑的增加可能会有超级多 then 于是有了async和await，先从字面意思来理解： async 是“异步”的简写，而 await 可以认为是 async wait 的简写，所以应该很好理解 async 用于申明一个 function 是异步的，而 await 用于等待一个异步方法执行完成。async 和 await 是es7提供的语法，是 es7最重要特性之一，相比于es6的promise ，具有更高的代码可读性，因此也被称为promise 的语法糖。它把异步执行的代码写得像同步代码那样直观。</p>
<p>async<br>快速创建一个异步函数，我们的 async 包裹后的函数就自动转化成一个异步的 Promise 下面我们来证实一下</p>
<img src="https://img-blog.csdnimg.cn/5e9921f404f0445c829b014fb7be1ae2.png" class="">
<img src="https://img-blog.csdnimg.cn/97b8887de5f246729f8d5a88051acd5d.png" class="">
<p>按照我们的理解，其实上面的log应该打印的是我们的 return 出来的几何心凉对吧，但是他打印出来的是一个 Promise 等同于下面的代码，当然这种只是我们的函数中仅仅是返回一个结果，但如果我们涉及到业务或者负责内容的时候还是需要我们去书写 promise 的，这点也比较鸡肋。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">fun1</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> p = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">rv</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">rv</span>(<span class="string">&#x27;几何心凉&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">            &#125;)</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> p</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">fun1</span>())</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>await<br>await 并不是将异步代码转化成同步，他只是改变了调用方式，让我们从调用的代码层面看着相似于同步，从而增加代码的可读性；而且 await 也不是在任何地方都可以用的，它只能使用在 async 和模块中使用，首先让我们来看一下在 async 中的使用；</p>
<img src="https://img-blog.csdnimg.cn/5c319f0883724b668bb7122b81fcaf25.png" class="">
<img src="https://img-blog.csdnimg.cn/9cee7f3e06b84361b450826c2ede5e33.png" class="">
<p>说明： 调用异步函数时，在函数前直接使用await对函数进行调用，一旦遇到await就会立即返回一个pending状态的Promise对象，暂时返回执行代码的控制权，使得函数外的代码得以继续执行，这是保证非阻塞的部分。他会等待 Promise 函数返回结果，可以通过变量来接收这个结果；既然是等待了那不就是说明阻塞了么？其实并不是我们可以看到图中的 fun4 前面加上了 async 就说明我们的 fun4 是异步的了，异步代码就不会阻塞后面的代码执行，而我们的 await 是在异步函数中去控制了依赖项的执行顺序。</p>
<p>当然在我们的 Promise 中我们出现了报错我们是通过 catch 然后去处理的，在我们的 await 中我们又该如何处理呢？当然我们可以通过我们同步的办法 try-catch 来处理异常<br>小结<br>我们的代码中会通过异步的方式来防止代码阻塞，当我们多个异步之间有相互的执行结果依赖的时候我们就需要锁定他们的执行顺序，早起的回调函数为我们解决了不确定顺序的问题，但是由于大批量的使用回调函数，造成代码的可读性、维护性非常低，后面出现了我们的 Promise 通过 then 进行链式结构，提高了可读性，但是随着业务的复杂度增加我们的链式可读性也会随之降低，所以es7出现了 async、await 改变了调用的方式，让调用呈现出来的代码相似于同步，进而提升代码可读性，async： 通过 async 声明的函数，它的返回值会自动包装为 Promise，它声明的异步函数中可以通过 await 去调用其他的异步函数，await： 让我们通过同步的方式去调用异步函数，让我们的代码可读性更高，await 的使用位置有两个，一个是我们 async 声明的异步函数中，一个是我们的 js 模块的最外层作用域中；</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">ChengWei</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://example.com/2019/04/16/第三十二篇/">http://example.com/2019/04/16/第三十二篇/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/js/">js</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2019/04/25/%E7%AC%AC%E4%B8%89%E5%8D%81%E4%B8%89%E7%AF%87/"><i class="fa fa-chevron-left">  </i><span>JS中什么是回调函数？</span></a></div><div class="next-post pull-right"><a href="/2019/04/09/%E7%AC%AC%E4%B8%89%E5%8D%81%E4%B8%80%E7%AF%87/"><span>ES6中 Promise 概念、基本用法和封装ajax（json数据使用）</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(https://ts1.cn.mm.bing.net/th/id/R-C.af6f75e39afef25fe0a57e0d3056bd5b?rik=89dax9livGUPug&amp;riu=http%3a%2f%2fn.sinaimg.cn%2fsinacn10109%2f320%2fw1200h720%2f20190209%2fa360-hsqyiwu5104217.jpg&amp;ehk=a3MK%2frKIn7q16f%2fY4UwfLfeHh%2fHngXcB3WE5cpbIoC0%3d&amp;risl=&amp;pid=ImgRaw&amp;r=0)"><div class="layout" id="footer"><div class="copyright">&copy;2018 - 2022 By ChengWei</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">hitokoto</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/lib/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.1"></script><script src="/js/fancybox.js?version=1.9.1"></script><script src="/js/sidebar.js?version=1.9.1"></script><script src="/js/copy.js?version=1.9.1"></script><script src="/js/fireworks.js?version=1.9.1"></script><script src="/js/transition.js?version=1.9.1"></script><script src="/js/scroll.js?version=1.9.1"></script><script src="/js/head.js?version=1.9.1"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>