<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content=""><meta name="keywords" content=""><meta name="author" content="ChengWei"><meta name="copyright" content="ChengWei"><title>Chengcw'博客</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.1"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://v1.hitokoto.cn/?encode=js&amp;charset=utf-8&amp;select=.footer_custom_text" defer></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '5.4.2'
} </script><meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="Chengcw'博客" type="application/atom+xml">
</head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="false"><div class="author-info"><div class="author-info__avatar text-center"><img src="https://wx2.sinaimg.cn/thumb150/008soxMJly1h0v1m20khej30u00u0td0.jpg"></div><div class="author-info__name text-center">ChengWei</div><div class="author-info__description text-center"></div><div class="follow-button"><a target="_blank" rel="noopener" href="https://github.com/USERNAME">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">150</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">27</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">24</span></a></div></div></div><nav id="nav" style="background-image: url(https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fpic1.win4000.com%2Fwallpaper%2F6%2F53cca8e7873e6.jpg&amp;refer=http%3A%2F%2Fpic1.win4000.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1664449271&amp;t=4f4642aaba02226ad62910f50b366e4b)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Chengcw'博客</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">首页</a><a class="site-page" href="/archives">文章</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a></span><span class="pull-right"></span></div><div id="site-info"><div id="site-title">Chengcw'博客</div><div id="site-sub-title"></div><div id="site-social-icons"><a class="social-icon" href="https://github.com/Molunerfinn" target="_blank" rel="noreferrer noopener nofollow"><i class="fa-github fa"></i></a><a class="social-icon" href="http://weibo.com/mybluedreams" target="_blank" rel="noreferrer noopener nofollow"><i class="fa-weibo fa"></i></a><a class="social-icon" href="https://Molunerfinn/atom.xml" target="_blank" rel="noreferrer noopener nofollow"><i class="fa-rss fa"></i></a></div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2021/05/24/await%20%E5%9C%A8%20forEach%20%E4%B8%AD%E4%B8%8D%E7%94%9F%E6%95%88%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/">await 在 forEach 中不生效解决方案</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-05-24</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E5%89%8D%E7%AB%AF/%E9%97%AE%E9%A2%98/">问题</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/async-await/">async/await</a></span><div class="content"><h2 id="一、场景"><a href="#一、场景" class="headerlink" title="一、场景"></a>一、场景</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">function test() &#123;</span><br><span class="line">	let arr = [3, 2, 1]</span><br><span class="line">	arr.forEach(async item =&gt; &#123;</span><br><span class="line">		const res = await fetch(item)</span><br><span class="line">		console.log(res)</span><br><span class="line">	&#125;)</span><br><span class="line">	console.log(&#x27;end&#x27;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function fetch(x) &#123;</span><br><span class="line">	return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">		setTimeout(() =&gt; &#123;</span><br><span class="line">			resolve(x)</span><br><span class="line">		&#125;, 500 * x)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test()</span><br></pre></td></tr></table></figure>

<p>期望的打印顺序是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">2</span><br><span class="line">1</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>结果打印顺序居然是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">end</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td></tr></table></figure>

<p><strong>原因</strong></p>
<blockquote>
<p>那就是 <code>forEach</code> 只支持同步代码。<code>forEach</code> 并不会去处理异步的情况</p>
</blockquote>
<h2 id="二、解决办法"><a href="#二、解决办法" class="headerlink" title="二、解决办法"></a>二、解决办法</h2><h3 id="2-1-第一种是使用-Promise-all-的方式"><a href="#2-1-第一种是使用-Promise-all-的方式" class="headerlink" title="2.1 第一种是使用 Promise.all 的方式"></a>2.1 第一种是使用 Promise.all 的方式</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">async function test() &#123;</span><br><span class="line">	let arr = [3, 2, 1]</span><br><span class="line">	await Promise.all(</span><br><span class="line">		arr.map(async item =&gt; &#123;</span><br><span class="line">			const res = await fetch(item)</span><br><span class="line">			console.log(res)</span><br><span class="line">		&#125;)</span><br><span class="line">	)</span><br><span class="line">	console.log(&#x27;end&#x27;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这样可以生效的原因是 <code>async</code> 函数肯定会返回一个 <code>Promise</code> 对象，调用 <code>map</code> 以后返回值就是一个存放了 <code>Promise</code> 的数组了，这样我们把数组传入 <code>Promise.all</code> 中就可以解决问题了。但是这种方式其实并不能达成我们要的效果，如果你希望内部的 <code>fetch</code> 是顺序完成的，可以选择第二种方式</p>
</blockquote>
<h3 id="2-2-另一种方法是使用-for…of"><a href="#2-2-另一种方法是使用-for…of" class="headerlink" title="2.2 另一种方法是使用 for…of"></a>2.2 另一种方法是使用 for…of</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">async function test() &#123;</span><br><span class="line">	let arr = [3, 2, 1]</span><br><span class="line">	for (const item of arr) &#123;</span><br><span class="line">		const res = await fetch(item)</span><br><span class="line">		console.log(res)</span><br><span class="line">	&#125;</span><br><span class="line">	console.log(&#x27;end&#x27;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>这种方式相比 <code>Promise.all</code> 要简洁的多，并且也可以实现开头我想要的输出顺序。</li>
<li>但是这时候你是否又多了一个疑问？为啥 <code>for...of</code> 内部就能让 <code>await</code> 生效呢。</li>
<li>因为 <code>for...of</code> 内部处理的机制和 f<code>orEach</code> 不同，<code>forEach</code> 是直接调用回调函数，<code>for...of</code> 是通过迭代器的方式去遍历。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">async function test() &#123;</span><br><span class="line">	let arr = [3, 2, 1]</span><br><span class="line">	const iterator = arr[Symbol.iterator]()</span><br><span class="line">	let res = iterator.next()</span><br><span class="line">	while (!res.done) &#123;</span><br><span class="line">		const value = res.value</span><br><span class="line">		const res1 = await fetch(value)</span><br><span class="line">		console.log(res1)</span><br><span class="line">		res = iterator.next()</span><br><span class="line">	&#125;</span><br><span class="line">	console.log(&#x27;end&#x27;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上代码等价于 <code>for...of</code>，可以看成 <code>for...of</code> 是以上代码的语法糖</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/04/17/Redux-%E4%B8%AD%E9%97%B4%E4%BB%B6/">Redux 中间件</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-04-17</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E6%A1%86%E6%9E%B6/">框架</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Redux/">Redux</a></span><div class="content"><h2 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h2><ul>
<li>在<code>redux</code>里，<code>middleware</code>是发送<code>action</code>和<code>action</code>到达<code>reducer</code>之间的第三方扩展，也就是中间层。也可以这样说，<code>middleware</code>是架在<code>action</code>和<code>store</code>之间的一座桥梁</li>
<li>在<code>redux</code>里，<code>action</code>仅仅是携带了数据的普通<code>js</code>对象</li>
</ul>
<blockquote>
<p><code>Reducer</code> 拆分可以使组件获取其最小属性(<code>state</code>)，而不需要整个<code>Store</code>。中间件则可以在<code>Action Creator</code> 返回最终可供 <code>dispatch</code> 调用的 <code>action</code> 之前处理各种事情，如异步<code>API</code>调用、日志记录等，是扩展 <code>Redux</code> 功能的一种推荐方式</p>
</blockquote>
<ul>
<li><code>Redux</code> 提供了 <code>applyMiddleware(...middlewares)</code> 来将中间件应用到 <code>createStore</code>。<code>applyMiddleware</code>会返回一个函数，该函数接收原来的 <code>creatStore</code> 作为参数，返回一个应用了 <code>middlewares</code> 的增强后的 <code>creatStore</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">export default function applyMiddleware(...middlewares) &#123;</span><br><span class="line">  return (createStore) =&gt; (reducer, preloadedState, enhancer) =&gt; &#123;</span><br><span class="line">    //接收createStore参数</span><br><span class="line">    var store = createStore(reducer, preloadedState, enhancer)</span><br><span class="line">    var dispatch = store.dispatch</span><br><span class="line">    var chain = []</span><br><span class="line"></span><br><span class="line">    //传递给中间件的参数</span><br><span class="line">    var middlewareAPI = &#123;</span><br><span class="line">      getState: store.getState,</span><br><span class="line">      dispatch: (action) =&gt; dispatch(action)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //注册中间件调用链</span><br><span class="line">    chain = middlewares.map(middleware =&gt; middleware(middlewareAPI))</span><br><span class="line">    dispatch = compose(...chain)(store.dispatch)</span><br><span class="line"></span><br><span class="line">    //返回经middlewares增强后的createStore</span><br><span class="line">    return &#123;</span><br><span class="line">      ...store,</span><br><span class="line">      dispatch</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>未应用中间价之前，创建 <code>store</code> 的方式如下</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import &#123;createStore&#125; from &#x27;redux&#x27;;</span><br><span class="line">import reducers from &#x27;./reducers/index&#x27;;</span><br><span class="line"></span><br><span class="line">export let store = createStore(reducers);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>应用中间价之后，创建 <code>store</code>的方式如下</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import &#123;createStore，applyMiddleware&#125; from &#x27;redux&#x27;;</span><br><span class="line">import reducers from &#x27;./reducers/index&#x27;;</span><br><span class="line"></span><br><span class="line">let createStoreWithMiddleware = applyMiddleware(...middleware)(createStore);</span><br><span class="line">export let store = createStoreWithMiddleware(reducers);</span><br></pre></td></tr></table></figure>

<h2 id="二、为什么要引入middleware"><a href="#二、为什么要引入middleware" class="headerlink" title="二、为什么要引入middleware"></a>二、为什么要引入middleware</h2><ul>
<li><code>action creator</code>返回的值是这个<code>action</code>类型的对象。然后通过<code>store.dispatch()</code>进行分发</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">action ---&gt; dispatcher ---&gt; reducers</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果遇到异步情况，比如点击一个按钮，希望2秒之后更新视图，显示消息“Hi”。我们可能这么写<code>ActionCreator</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var asyncSayActionCreator = function (message) &#123;</span><br><span class="line">    setTimeout(function () &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            type: &#x27;SAY&#x27;,</span><br><span class="line">            message</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, 2000)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这会报错，因为这个<code>asyncSayActionCreator</code>返回的不是一个<code>action</code>，而是一个<code>function</code>。这个返回值无法被<code>reducer</code>识别</p>
</blockquote>
<ul>
<li>也就是说，正常来说，<code>action</code>返回的是一个对象，而不是一个函数。如果返回函数，会出现错误</li>
<li>　而异步操作呢，需要<code>action</code>的返回值是一个函数。那么咋办呢，所以需要引入中间件<code>middleware</code>,它在中间起到了桥梁的作用，让<code>action</code>的返回值可以是一个函数，从而传到<code>reducer</code>那里。也就是说，中间件是用在<code>action</code>发起之后，<code>reducer</code>接收到之前的这个时间段</li>
<li>也可以这么说，<code>Middleware</code> 主要是负责改变<code>Store</code>中的<code>dispatch</code>方法，从而能处理不同类型的 <code>action</code> 输入，得到最终的 <code>Javascript Plain Object</code> 形式的 <code>action</code> 对象</li>
</ul>
<blockquote>
<p>因此，上面那个<code>ActionCreator</code>就可以改写为这样：因为<code>action</code>的返回值是一个函数</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var asyncSayActionCreator = function (message) &#123;</span><br><span class="line">    return function (dispatch) &#123;</span><br><span class="line">        setTimeout(function () &#123;</span><br><span class="line">            dispatch(&#123;</span><br><span class="line">                type: &#x27;SAY&#x27;,</span><br><span class="line">                message</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;, 2000)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://poetries1.gitee.io/img-repo/2019/10/466.png" alt="img"></p>
<ul>
<li>上图表达的是 <code>redux</code> 中一个简单的同步数据流动的场景，点击<code>button</code> 后，在回调中 <code>dispatch</code> 一个 <code>action</code>，<code>reducer</code> 收到<code>action</code> 后，更新 <code>state</code> 并通知 <code>view</code> 重新渲染</li>
</ul>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/467.png" alt="img"></p>
<ul>
<li><p>上面这张图展示了应用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">middleware</span><br></pre></td></tr></table></figure>

<p>后</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redux</span><br></pre></td></tr></table></figure>

<p>处理事件的逻辑，每一个</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">middleware</span><br></pre></td></tr></table></figure>

<p>处理一个相对独立的业务需求，通过串联不同的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">middleware</span><br></pre></td></tr></table></figure>

<p>，实现变化多样的的功能。那么问题来了：</p>
<ul>
<li><code>middleware</code> 怎么写？</li>
<li><code>redux</code>是如何让 <code>middlewares</code> 串联并跑起来的？</li>
</ul>
</li>
</ul>
<h2 id="三、中间件是如何工作的"><a href="#三、中间件是如何工作的" class="headerlink" title="三、中间件是如何工作的"></a>三、中间件是如何工作的</h2><blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Middleware`的中间件有很多，不过我的这个案例只引用了其中的一个，那就是`redux-thunk</span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li><code>redux-thunk</code>源码如下</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">export default function thunkMiddleware(&#123; dispatch, getState &#125;) &#123;</span><br><span class="line">  return next =&gt; action =&gt;</span><br><span class="line">    typeof action === &#x27;function&#x27; ?</span><br><span class="line">      action(dispatch, getState) :</span><br><span class="line">      next(action);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>意思是如果<code>action</code>是一个函数，执行这个<code>action</code>函数，如果不是函数，执行<code>next</code>函数</p>
</blockquote>
<h2 id="四、自定义中间件"><a href="#四、自定义中间件" class="headerlink" title="四、自定义中间件"></a>四、自定义中间件</h2><blockquote>
<p>中间件的签名如下</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(&#123; getState, dispatch &#125;) =&gt; next =&gt; action</span><br></pre></td></tr></table></figure>

<blockquote>
<p>根据<code>applyMiddleware</code> 源码，每个中间件接收 <code>getState &amp; dispatch</code>作为参数，并返回一个函数，该函数会被传入下一个中间件的 dispatch 方法，并返回一个接收 <code>action</code> 的新函数</p>
</blockquote>
<ul>
<li>应用多个中间件时，中间件调用链中任何一个缺少 <code>next(action)</code> 的调用，都会导致<code>action</code> 执行失败</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function callTraceMiddleware (&#123;dispatch,getState&#125;)&#123;</span><br><span class="line">    return next=&gt; action =&gt;&#123;</span><br><span class="line">        console.trace();</span><br><span class="line">        return next(action);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>然后在调用中间件部分添加中间件</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const createStoreWithMiddleware = applyMiddleware(</span><br><span class="line">  thunkMiddleware,</span><br><span class="line">  loggerMiddleware,</span><br><span class="line">  callTraceMiddleware</span><br><span class="line">)(createStore);</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>redux</code>的<code>middleware</code>是对<code>action</code>进行扩展处理，这样丰富了应用需求</p>
</blockquote>
<h2 id="五、常用的中间件"><a href="#五、常用的中间件" class="headerlink" title="五、常用的中间件"></a>五、常用的中间件</h2><p>有很多优秀的<code>redux</code>中间件，如：</p>
<ul>
<li>redux-thunk：用于异步操作</li>
<li>redux-logger：用于日志记录</li>
</ul>
<p>上述的中间件都需要通过<code>applyMiddlewares</code>进行注册，作用是将所有的中间件组成一个数组，依次执行</p>
<p>然后作为第二个参数传入到<code>createStore</code>中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(</span><br><span class="line">  reducer,</span><br><span class="line">  <span class="title function_">applyMiddleware</span>(thunk, logger)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="redux-thunk"><a href="#redux-thunk" class="headerlink" title="redux-thunk"></a>redux-thunk</h3><p><code>redux-thunk</code>是官网推荐的异步处理中间件</p>
<p>默认情况下的<code>dispatch(action)</code>，<code>action</code>需要是一个<code>JavaScript</code>的对象</p>
<p><code>redux-thunk</code>中间件会判断你当前传进来的数据类型，如果是一个函数，将会给函数传入参数值（dispatch，getState）</p>
<ul>
<li>dispatch函数用于我们之后再次派发action</li>
<li>getState函数考虑到我们之后的一些操作需要依赖原来的状态，用于让我们可以获取之前的一些状态</li>
</ul>
<p>所以<code>dispatch</code>可以写成下述函数的形式：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">getHomeMultidataAction</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">dispatch</span>) =&gt;</span> &#123;</span><br><span class="line">    axios.<span class="title function_">get</span>(<span class="string">&quot;http://xxx.xx.xx.xx/test&quot;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> data = res.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">      <span class="title function_">dispatch</span>(<span class="title function_">changeBannersAction</span>(data.<span class="property">banner</span>.<span class="property">list</span>));</span><br><span class="line">      <span class="title function_">dispatch</span>(<span class="title function_">changeRecommendsAction</span>(data.<span class="property">recommend</span>.<span class="property">list</span>));</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="redux-logger"><a href="#redux-logger" class="headerlink" title="redux-logger"></a>redux-logger</h3><p>如果想要实现一个日志功能，则可以使用现成的<code>redux-logger</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; applyMiddleware, createStore &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> createLogger <span class="keyword">from</span> <span class="string">&#x27;redux-logger&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> logger = <span class="title function_">createLogger</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(</span><br><span class="line">  reducer,</span><br><span class="line">  <span class="title function_">applyMiddleware</span>(logger)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>这样我们就能简单通过中间件函数实现日志记录的信息</p>
<h2 id="六、实现原理"><a href="#六、实现原理" class="headerlink" title="六、实现原理"></a>六、实现原理</h2><p>首先看看<code>applyMiddlewares</code>的源码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">applyMiddleware</span>(<span class="params">...middlewares</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">createStore</span>) =&gt;</span> <span class="function">(<span class="params">reducer, preloadedState, enhancer</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> store = <span class="title function_">createStore</span>(reducer, preloadedState, enhancer);</span><br><span class="line">    <span class="keyword">var</span> dispatch = store.<span class="property">dispatch</span>;</span><br><span class="line">    <span class="keyword">var</span> chain = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> middlewareAPI = &#123;</span><br><span class="line">      <span class="attr">getState</span>: store.<span class="property">getState</span>,</span><br><span class="line">      <span class="attr">dispatch</span>: <span class="function">(<span class="params">action</span>) =&gt;</span> <span class="title function_">dispatch</span>(action)</span><br><span class="line">    &#125;;</span><br><span class="line">    chain = middlewares.<span class="title function_">map</span>(<span class="function"><span class="params">middleware</span> =&gt;</span> <span class="title function_">middleware</span>(middlewareAPI));</span><br><span class="line">    dispatch = <span class="title function_">compose</span>(...chain)(store.<span class="property">dispatch</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;...store, dispatch&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所有中间件被放进了一个数组<code>chain</code>，然后嵌套执行，最后执行<code>store.dispatch</code>。可以看到，中间件内部（<code>middlewareAPI</code>）可以拿到<code>getState</code>和<code>dispatch</code>这两个方法</p>
<p>在上面的学习中，我们了解到了<code>redux-thunk</code>的基本使用</p>
<p>内部会将<code>dispatch</code>进行一个判断，然后执行对应操作，原理如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">patchThunk</span>(<span class="params">store</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> next = store.<span class="property">dispatch</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">dispatchAndThunk</span>(<span class="params">action</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> action === <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">            <span class="title function_">action</span>(store.<span class="property">dispatch</span>, store.<span class="property">getState</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_">next</span>(action);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    store.<span class="property">dispatch</span> = dispatchAndThunk;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>实现一个日志输出的原理也非常简单，如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> next = store.<span class="property">dispatch</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">dispatchAndLog</span>(<span class="params">action</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;dispatching:&quot;</span>, <span class="title function_">addAction</span>(<span class="number">10</span>));</span><br><span class="line">  <span class="title function_">next</span>(<span class="title function_">addAction</span>(<span class="number">5</span>));</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;新的state:&quot;</span>, store.<span class="title function_">getState</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">store.<span class="property">dispatch</span> = dispatchAndLog;</span><br></pre></td></tr></table></figure></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/04/13/React-%E4%BA%8B%E4%BB%B6%E7%BB%91%E5%AE%9A%E6%96%B9%E5%BC%8F/">React-事件绑定方式</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-04-13</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E6%A1%86%E6%9E%B6/">框架</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/React/">React</a></span><div class="content"><h2 id="一、是什么"><a href="#一、是什么" class="headerlink" title="一、是什么"></a>一、是什么</h2><p>在<code>react</code>应用中，事件名都是用小驼峰格式进行书写，例如<code>onclick</code>要改写成<code>onClick</code></p>
<p>最简单的事件绑定如下：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ShowAlert</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">showAlert</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Hi&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.showAlert&#125;</span>&gt;</span>show<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从上面可以看到，事件绑定的方法需要使用<code>&#123;&#125;</code>包住</p>
<p>上述的代码看似没有问题，但是当将处理函数输出代码换成<code>console.log(this)</code>的时候，点击按钮，则会发现控制台输出<code>undefined</code></p>
<h2 id="二、如何绑定"><a href="#二、如何绑定" class="headerlink" title="二、如何绑定"></a>二、如何绑定</h2><p>为了解决上面正确输出<code>this</code>的问题，常见的绑定方式有如下：</p>
<ul>
<li>render方法中使用bind</li>
<li>render方法中使用箭头函数</li>
<li>constructor中bind</li>
<li>定义阶段使用箭头函数绑定</li>
</ul>
<h3 id="render方法中使用bind"><a href="#render方法中使用bind" class="headerlink" title="render方法中使用bind"></a>render方法中使用bind</h3><p>如果使用一个类组件，在其中给某个组件/元素一个<code>onClick</code>属性，它现在并会自定绑定其<code>this</code>到当前组件，解决这个问题的方法是在事件函数后使用<code>.bind(this)</code>将<code>this</code>绑定到当前组件中</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">handleClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;this &gt; &#x27;</span>, <span class="variable language_">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleClick.bind(this)&#125;</span>&gt;</span>test<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这种方式在组件每次<code>render</code>渲染的时候，都会重新进行<code>bind</code>的操作，影响性能</p>
<h3 id="render方法中使用箭头函数"><a href="#render方法中使用箭头函数" class="headerlink" title="render方法中使用箭头函数"></a>render方法中使用箭头函数</h3><p>通过<code>ES6</code>的上下文来将<code>this</code>的指向绑定给当前组件，同样再每一次<code>render</code>的时候都会生成新的方法，影响性能</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">handleClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;this &gt; &#x27;</span>, <span class="variable language_">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">onClick</span>=<span class="string">&#123;e</span> =&gt;</span> this.handleClick(e)&#125;&gt;test<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="constructor中bind"><a href="#constructor中bind" class="headerlink" title="constructor中bind"></a>constructor中bind</h2><p>在<code>constructor</code>中预先<code>bind</code>当前组件，可以避免在<code>render</code>操作中重复绑定</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">handleClick</span> = <span class="variable language_">this</span>.<span class="property">handleClick</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">handleClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;this &gt; &#x27;</span>, <span class="variable language_">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleClick&#125;</span>&gt;</span>test<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="定义阶段使用箭头函数绑定"><a href="#定义阶段使用箭头函数绑定" class="headerlink" title="定义阶段使用箭头函数绑定"></a>定义阶段使用箭头函数绑定</h3><p>跟上述方式三一样，能够避免在<code>render</code>操作中重复绑定，实现也非常的简单，如下：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line">  &#125;</span><br><span class="line">  handleClick = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;this &gt; &#x27;</span>, <span class="variable language_">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleClick&#125;</span>&gt;</span>test<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="三、区别"><a href="#三、区别" class="headerlink" title="三、区别"></a>三、区别</h2><p>上述四种方法的方式，区别主要如下：</p>
<ul>
<li>编写方面：方式一、方式二写法简单，方式三的编写过于冗杂</li>
<li>性能方面：方式一和方式二在每次组件render的时候都会生成新的方法实例，性能问题欠缺。若该函数作为属性值传给子组件的时候，都会导致额外的渲染。而方式三、方式四只会生成一个方法实例</li>
</ul>
<p>综合上述，方式四是最优的事件绑定方式</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/04/05/React-%E7%90%86%E8%A7%A3+%E7%89%B9%E6%80%A7/">React-理解+特性</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-04-05</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E6%A1%86%E6%9E%B6/">框架</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/React/">React</a></span><div class="content"><h2 id="一、是什么"><a href="#一、是什么" class="headerlink" title="一、是什么"></a>一、是什么</h2><p>React，用于构建用户界面的 JavaScript 库，只提供了 UI 层面的解决方案</p>
<p>遵循组件设计模式、声明式编程范式和函数式编程概念，以使前端应用程序更高效</p>
<p>使用虚拟 <code>DOM</code> 来有效地操作 <code>DOM</code>，遵循从高阶组件到低阶组件的单向数据流</p>
<p>帮助我们将界面成了各个独立的小块，每一个块就是组件，这些组件之间可以组合、嵌套，构成整体页面</p>
<p><code>react</code> 类组件使用一个名为 <code>render()</code> 的方法或者函数组件<code>return</code>，接收输入的数据并返回需要展示的内容</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">HelloMessage</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Hello &#123;this.props.name&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">HelloMessage</span> <span class="attr">name</span>=<span class="string">&quot;Taylor&quot;</span> /&gt;</span></span>,</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;hello-example&quot;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>上述这种类似 <code>XML</code> 形式就是 <code>JSX</code>，最终会被 <code>babel</code> 编译为合法的 <code>JS</code> 语句调用</p>
<p>被传入的数据可在组件中通过 <code>this.props</code> 在 <code>render()</code> 访问</p>
<h2 id="二、特性"><a href="#二、特性" class="headerlink" title="二、特性"></a>二、特性</h2><p><code>React</code> 特性有很多，如：</p>
<ul>
<li>JSX 语法</li>
<li>单向数据绑定</li>
<li>虚拟 DOM</li>
<li>声明式编程</li>
<li>Component</li>
</ul>
<p>着重介绍下声明式编程及 Component</p>
<h3 id="声明式编程"><a href="#声明式编程" class="headerlink" title="声明式编程"></a>声明式编程</h3><p>声明式编程是一种编程范式，它关注的是你要做什么，而不是如何做</p>
<p>它表达逻辑而不显式地定义步骤。这意味着我们需要根据逻辑的计算来声明要显示的组件</p>
<p>如实现一个标记的地图：</p>
<p>通过命令式创建地图、创建标记、以及在地图上添加的标记的步骤如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建地图</span></span><br><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>.<span class="title function_">map</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;map&quot;</span>), &#123;</span><br><span class="line">  <span class="attr">zoom</span>: <span class="number">4</span>,</span><br><span class="line">  <span class="attr">center</span>: &#123; lat, lng &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建标记</span></span><br><span class="line"><span class="keyword">const</span> marker = <span class="keyword">new</span> <span class="title class_">Map</span>.<span class="title function_">marker</span>(&#123;</span><br><span class="line">  <span class="attr">position</span>: &#123; lat, lng &#125;,</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&quot;Hello Marker&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 地图上添加标记</span></span><br><span class="line">marker.<span class="title function_">setMap</span>(map);</span><br></pre></td></tr></table></figure>

<p>而用 <code>React</code> 实现上述功能则如下：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">Map</span> zoom=&#123;<span class="number">4</span>&#125; center=&#123;(lat, lng)&#125;&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Marker</span> <span class="attr">position</span>=<span class="string">&#123;(lat,</span> <span class="attr">lng</span>)&#125; <span class="attr">title</span>=<span class="string">&#123;</span>&quot;<span class="attr">Hello</span> <span class="attr">Marker</span>&quot;&#125; /&gt;</span></span></span><br><span class="line">&lt;/<span class="title class_">Map</span>&gt;</span><br></pre></td></tr></table></figure>

<p>声明式编程方式使得 <code>React</code> 组件很容易使用，最终的代码简单易于维护</p>
<h3 id="Component"><a href="#Component" class="headerlink" title="Component"></a>Component</h3><p>在 <code>React</code> 中，一切皆为组件。通常将应用程序的整个逻辑分解为小的单个部分。 我们将每个单独的部分称为组件</p>
<p>组件可以是一个函数或者是一个类，接受数据输入，处理它并返回在 <code>UI</code> 中呈现的 <code>React</code> 元素</p>
<p>函数式组件如下：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">Header</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Jumbotron</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">backgroundColor:</span> &quot;<span class="attr">orange</span>&quot; &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>TODO App<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Jumbotron</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>类组件（有状态组件）如下：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Dashboard</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;dashboard&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ToDoForm</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ToDolist</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一个组件该有的特点如下：</p>
<ul>
<li>可组合：每个组件易于和其它组件一起使用，或者嵌套在另一个组件内部</li>
<li>可重用：每个组件都是具有独立功能的，它可以被使用在多个 UI 场景</li>
<li>可维护：每个小的组件仅仅包含自身的逻辑，更容易被理解和维护</li>
</ul>
<h2 id="三、优势"><a href="#三、优势" class="headerlink" title="三、优势"></a>三、优势</h2><p>通过上面的初步了解，可以感受到 <code>React</code> 存在的优势：</p>
<ul>
<li>高效灵活</li>
<li>声明式的设计，简单使用</li>
<li>组件式开发，提高代码复用率</li>
<li>单向响应的数据流会比双向绑定的更安全，速度更快</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/03/29/React-%E8%BF%87%E6%B8%A1%E5%8A%A8%E7%94%BB/">React-过渡动画</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-03-29</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/React/">React</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/React/">React</a></span><div class="content"><h2 id="一、是什么"><a href="#一、是什么" class="headerlink" title="一、是什么"></a>一、是什么</h2><p>在日常开发中，页面切换时的转场动画是比较基础的一个场景</p>
<p>当一个组件在显示与消失过程中存在过渡动画，可以很好的增加用户的体验</p>
<p>在<code>react</code>中实现过渡动画效果会有很多种选择，如<code>react-transition-group</code>，<code>react-motion</code>，<code>Animated</code>，以及原生的<code>CSS</code>都能完成切换动画</p>
<h2 id="二、如何实现"><a href="#二、如何实现" class="headerlink" title="二、如何实现"></a>二、如何实现</h2><p>在<code>react</code>中，<code>react-transition-group</code>是一种很好的解决方案，其为元素添加<code>enter</code>，<code>enter-active</code>，<code>exit</code>，<code>exit-active</code>这一系列勾子</p>
<p>可以帮助我们方便的实现组件的入场和离场动画</p>
<p>其主要提供了三个主要的组件：</p>
<ul>
<li>CSSTransition：在前端开发中，结合 CSS 来完成过渡动画效果</li>
<li>SwitchTransition：两个组件显示和隐藏切换时，使用该组件</li>
<li>TransitionGroup：将多个动画组件包裹在其中，一般用于列表中元素的动画</li>
</ul>
<h3 id="CSSTransition"><a href="#CSSTransition" class="headerlink" title="CSSTransition"></a>CSSTransition</h3><p>其实现动画的原理在于，当<code>CSSTransition</code>的<code>in</code>属性置为<code>true</code>时，<code>CSSTransition</code>首先会给其子组件加上<code>xxx-enter</code>、<code>xxx-enter-active</code>的<code>class</code>执行动画</p>
<p>当动画执行结束后，会移除两个<code>class</code>，并且添加<code>-enter-done</code>的<code>class</code></p>
<p>所以可以利用这一点，通过<code>css</code>的<code>transition</code>属性，让元素在两个状态之间平滑过渡，从而得到相应的动画效果</p>
<p>当<code>in</code>属性置为<code>false</code>时，<code>CSSTransition</code>会给子组件加上<code>xxx-exit</code>和<code>xxx-exit-active</code>的<code>class</code>，然后开始执行动画，当动画结束后，移除两个<code>class</code>，然后添加<code>-enter-done</code>的<code>class</code></p>
<p>如下例子：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">App2</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.PureComponent</span> &#123;</span><br><span class="line"></span><br><span class="line">  state = &#123;<span class="attr">show</span>: <span class="literal">true</span>&#125;;</span><br><span class="line"></span><br><span class="line">  onToggle = <span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;<span class="attr">show</span>: !<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">show</span>&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;show&#125; = <span class="variable language_">this</span>.<span class="property">state</span>;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;</span>&#x27;<span class="attr">container</span>&#x27;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;</span>&#x27;<span class="attr">square-wrapper</span>&#x27;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">CSSTransition</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">in</span>=<span class="string">&#123;show&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">timeout</span>=<span class="string">&#123;500&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">classNames</span>=<span class="string">&#123;</span>&#x27;<span class="attr">fade</span>&#x27;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">unmountOnExit</span>=<span class="string">&#123;true&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          &gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;</span>&#x27;<span class="attr">square</span>&#x27;&#125; /&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">CSSTransition</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.onToggle&#125;</span>&gt;</span>toggle<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对应<code>css</code>样式如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.fade-enter</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translateX</span>(<span class="number">100%</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.fade-enter-active</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translateX</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="attribute">transition</span>: all <span class="number">500ms</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.fade-exit</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translateX</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.fade-exit-active</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translateX</span>(-<span class="number">100%</span>);</span><br><span class="line">  <span class="attribute">transition</span>: all <span class="number">500ms</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="SwitchTransition"><a href="#SwitchTransition" class="headerlink" title="SwitchTransition"></a>SwitchTransition</h3><p><code>SwitchTransition</code>可以完成两个组件之间切换的炫酷动画</p>
<p>比如有一个按钮需要在<code>on</code>和<code>off</code>之间切换，我们希望看到<code>on</code>先从左侧退出，<code>off</code>再从右侧进入</p>
<p><code>SwitchTransition</code>中主要有一个属性<code>mode</code>，对应两个值：</p>
<ul>
<li>in-out：表示新组件先进入，旧组件再移除；</li>
<li>out-in：表示就组件先移除，新组建再进入</li>
</ul>
<p><code>SwitchTransition</code>组件里面要有<code>CSSTransition</code>，不能直接包裹你想要切换的组件</p>
<p>里面的<code>CSSTransition</code>组件不再像以前那样接受<code>in</code>属性来判断元素是何种状态，取而代之的是<code>key</code>属性</p>
<p>下面给出一个按钮入场和出场的示例，如下：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">SwitchTransition</span>, <span class="title class_">CSSTransition</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-transition-group&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">SwitchAnimation</span> <span class="keyword">extends</span> <span class="title class_ inherited__">PureComponent</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">      <span class="attr">isOn</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;isOn&#125; = <span class="variable language_">this</span>.<span class="property">state</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">SwitchTransition</span> <span class="attr">mode</span>=<span class="string">&quot;out-in&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">CSSTransition</span> <span class="attr">classNames</span>=<span class="string">&quot;btn&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                       <span class="attr">timeout</span>=<span class="string">&#123;500&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                       <span class="attr">key</span>=<span class="string">&#123;isOn</span> ? &quot;<span class="attr">on</span>&quot; <span class="attr">:</span> &quot;<span class="attr">off</span>&quot;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.btnClick.bind(this)&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;isOn ? &quot;on&quot;: &quot;off&quot;&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">CSSTransition</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">SwitchTransition</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">btnClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;<span class="attr">isOn</span>: !<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">isOn</span>&#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>css</code>文件对应如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.btn-enter</span> &#123;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">100%</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.btn-enter-active</span> &#123;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">transition</span>: all <span class="number">500ms</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.btn-exit</span> &#123;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.btn-exit-active</span> &#123;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">100%</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">transition</span>: all <span class="number">500ms</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="TransitionGroup"><a href="#TransitionGroup" class="headerlink" title="TransitionGroup"></a>TransitionGroup</h3><p>当有一组动画的时候，就可将这些<code>CSSTransition</code>放入到一个<code>TransitionGroup</code>中来完成动画</p>
<p>同样<code>CSSTransition</code>里面没有<code>in</code>属性，用到了<code>key</code>属性</p>
<p><code>TransitionGroup</code>在感知<code>children</code>发生变化的时候，先保存移除的节点，当动画结束后才真正移除</p>
<p>其处理方式如下：</p>
<ul>
<li>插入的节点，先渲染dom，然后再做动画</li>
<li>删除的节点，先做动画，然后再删除dom</li>
</ul>
<p>如下：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">PureComponent</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">CSSTransition</span>, <span class="title class_">TransitionGroup</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-transition-group&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">GroupAnimation</span> <span class="keyword">extends</span> <span class="title class_ inherited__">PureComponent</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">      <span class="attr">friends</span>: []</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">TransitionGroup</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;</span></span><br><span class="line"><span class="language-xml">            this.state.friends.map((item, index) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">              return (</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">CSSTransition</span> <span class="attr">classNames</span>=<span class="string">&quot;friend&quot;</span> <span class="attr">timeout</span>=<span class="string">&#123;300&#125;</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;item&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">CSSTransition</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              )</span></span><br><span class="line"><span class="language-xml">            &#125;)</span></span><br><span class="line"><span class="language-xml">          &#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">TransitionGroup</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;e</span> =&gt;</span> this.addFriend()&#125;&gt;+friend<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">addFriend</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      <span class="attr">friends</span>: [...<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">friends</span>, <span class="string">&quot;coderwhy&quot;</span>]</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对应<code>css</code>如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.friend-enter</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">100%</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.friend-enter-active</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">    <span class="attribute">transition</span>: all <span class="number">500ms</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.friend-exit</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.friend-exit-active</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">100%</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">transition</span>: all <span class="number">500ms</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/03/15/React-SSR%E4%BC%98%E5%8C%96Next%E6%9E%84%E5%BB%BA2/">React-SSR优化Next构建2</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-03-15</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E6%A1%86%E6%9E%B6/">框架</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/React/">React</a></span><div class="content"><h2 id="一、Next-js是什么"><a href="#一、Next-js是什么" class="headerlink" title="一、Next.js是什么"></a>一、Next.js是什么</h2><blockquote>
<p><code>Next.js</code>是一个基于<code>React</code>的一个服务端渲染简约框架。它使用<code>React</code>语法，可以很好的实现代码的模块化，有利于代码的开发和维护</p>
</blockquote>
<h3 id="1-1-Next-js带来了很多好的特性"><a href="#1-1-Next-js带来了很多好的特性" class="headerlink" title="1.1 Next.js带来了很多好的特性"></a>1.1 Next.js带来了很多好的特性</h3><ul>
<li>默认服务端渲染模式，以文件系统为基础的客户端路由</li>
<li>代码自动分隔使页面加载更快</li>
<li>以页面为基础的简洁的客户端路由</li>
<li>以<code>webpack</code>的热替换为基础的开发环境</li>
<li>使用<code>React</code>的<code>JSX</code>和<code>ES6</code>的<code>module</code>，模块化和维护更方便</li>
<li>可以运行在<code>Express</code>和其他<code>Node.js</code>的<code>HTTP</code> 服务器上</li>
<li>可以定制化专属的<code>babel</code>和<code>webpack</code>配置</li>
</ul>
<h2 id="二、构建一个基本的Next项目"><a href="#二、构建一个基本的Next项目" class="headerlink" title="二、构建一个基本的Next项目"></a>二、构建一个基本的Next项目</h2><h3 id="2-1-创建项目"><a href="#2-1-创建项目" class="headerlink" title="2.1 创建项目"></a>2.1 创建项目</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// 在本地创建一个项目跟目录</span><br><span class="line">$ mkdir hello-next </span><br><span class="line"></span><br><span class="line">// 切换到项目根目录</span><br><span class="line">$ cd hello-next</span><br><span class="line"></span><br><span class="line">// 用npm初始化项目</span><br><span class="line">$ npm init -y</span><br><span class="line"></span><br><span class="line">// 将react和next安装到本地依赖</span><br><span class="line">$ npm install --save react react-dom next</span><br><span class="line"></span><br><span class="line">// 创建文件夹 pages</span><br><span class="line">$ mkdir pages</span><br></pre></td></tr></table></figure>

<blockquote>
<p>创建完文件夹之后，打开<code>hello-next</code>文件下的<code>package.json</code>文件，在 <code>scripts</code>下添加一个<code>script</code>，如下</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;dev&quot;: &quot;next&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">$ npm run dev</span><br></pre></td></tr></table></figure>

<h3 id="2-2-创建页面"><a href="#2-2-创建页面" class="headerlink" title="2.2 创建页面"></a>2.2 创建页面</h3><blockquote>
<p><code>Next.js</code>是从服务器生成页面，再返回给前端展示。<code>Next.js</code>默认从 <code>pages</code> 目录下取页面进行渲染返回给前端展示，并默认取 <code>pages/index.js</code> 作为系统的首页进行展示。注意，<code>pages</code> 是默认存放页面的目录，路由的根路径也是<code>pages</code>目录</p>
</blockquote>
<ul>
<li>在 <code>pages/index.js</code> 中创建一个<code>React</code>函数式组件</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const Index = () =&gt; (</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;p&gt;Hello Next.js&lt;/p&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">export default Index</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>Next.js</code>默认使用<code>Webpack</code>构建项目，<code>webpack</code>的热部署功能一样能提升开发效率。创建完 <code>pages/index.js</code> 后，再访问 <code>http://localhost:3000</code> 即可看到设置好的页面</p>
</blockquote>
<ul>
<li>在 <code>pages</code> 目录下创建文件 <code>pages/about.js</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export default () =&gt; (</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;p&gt;This is the about page&lt;/p&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>创建完之后，可以通过 <code>http://localhost:3000/about</code> 访问该页面。至此，所有的页面的路由都是通过后端服务器来控制的，要想实现客户端路由，需要借助<code>Next.js</code>的<code>Link API</code>。</p>
</blockquote>
<p><strong>Link API</strong></p>
<blockquote>
<p>从 <code>next/link</code>中可以引用到 <code>Link</code> 组件。在<code>pages/index.js</code>文件中引用<code>Link</code>，修改如</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// This is the Link API</span><br><span class="line">import Link from &#x27;next/link&#x27;</span><br><span class="line"></span><br><span class="line">const Index = () =&gt; (</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;Link href=&quot;/about&quot;&gt;</span><br><span class="line">      &lt;a&gt;About Page&lt;/a&gt;</span><br><span class="line">    &lt;/Link&gt;</span><br><span class="line">    &lt;p&gt;Hello Next.js&lt;/p&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">export default Index</span><br></pre></td></tr></table></figure>

<ol>
<li><code>Link</code>组件是通过<code>location.history</code>的浏览器API保存历史路由，所以，你可以通过浏览器左上角的前进和后退按钮来切换历史路由。而在开发过程中，你不需要再单独写客户端路由的配置</li>
<li><code>Link</code>组件是<code>React</code>的高阶组件的实现，不能对它进行样式的设置，它只是起到路由的跳转功能，但是它的复用性强，只要包含一个能触发<code>onClick</code>事件的组件即可</li>
</ol>
<h3 id="2-3-组件复用"><a href="#2-3-组件复用" class="headerlink" title="2.3 组件复用"></a>2.3 组件复用</h3><blockquote>
<p><code>Next.js</code>是以多页面为中心，只要将页面文件放在<code>pages</code>目录下，就可以在浏览器上以文件名为路由名来访问到</p>
</blockquote>
<ul>
<li>组件的设置跟React一样，通过<code>export</code>导出，通过<code>import</code>导入。一般，只要不想让用户通过页面直接访问的组件，都不放在<code>pages</code>目录下。对除了<code>pages</code>目录，组件放在哪个目录下没有要求，开发者可以自定义设置</li>
</ul>
<blockquote>
<p>下面再 <code>components</code> 目录下，创建一个公用组件 <code>Header</code>，用于各个文件的头部导航，通过导航可以在页面见切换</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">import Link from &#x27;next/link&#x27;</span><br><span class="line"></span><br><span class="line">const linkStyle = &#123;</span><br><span class="line">  marginRight: 15</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const Header = () =&gt; (</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;Link href=&quot;/&quot;&gt;</span><br><span class="line">      &lt;a style=&#123;linkStyle&#125;&gt;Home&lt;/a&gt;</span><br><span class="line">    &lt;/Link&gt;</span><br><span class="line">    &lt;Link href=&quot;/about&quot;&gt;</span><br><span class="line">      &lt;a style=&#123;linkStyle&#125;&gt;About&lt;/a&gt;</span><br><span class="line">    &lt;/Link&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">export default Header</span><br></pre></td></tr></table></figure>

<p>在 <code>pages/index.js</code> 中引入<code>Header</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import Header from &#x27;../components/Header&#x27;</span><br><span class="line"></span><br><span class="line">export default () =&gt; (</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;Header /&gt;</span><br><span class="line">    &lt;p&gt;Hello Next.js&lt;/p&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>进一步封装<code>Header</code>组件，创建一个自动包含<code>Header</code>和<code>Content</code>的组件 <code>components/MyLayout.js</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import Header from &#x27;./Header&#x27;</span><br><span class="line"></span><br><span class="line">const layoutStyle = &#123;</span><br><span class="line">  margin: 20,</span><br><span class="line">  padding: 20,</span><br><span class="line">  border: &#x27;1px solid #DDD&#x27;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const Layout = (props) =&gt; (</span><br><span class="line">  &lt;div style=&#123;layoutStyle&#125;&gt;</span><br><span class="line">    &lt;Header /&gt;</span><br><span class="line">    &#123;props.children&#125;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">export default Layout</span><br></pre></td></tr></table></figure>

<h3 id="2-4-创建动态页面"><a href="#2-4-创建动态页面" class="headerlink" title="2.4 创建动态页面"></a>2.4 创建动态页面</h3><blockquote>
<p>使用<code>Next.js</code>创建动态页面，与使用<code>React</code>或<code>Vue</code>创建一个<code>SPA</code>页面大体相同，唯一的区别就是页面的渲染主体不同，前者是<code>Nodejs</code>服务器获取到后端数据渲染完页面后再返回给前端展示，后者是前端先获取页面主体架构，再通过<code>ajax</code>的方式请求后端的数据，在前端渲染展示</p>
</blockquote>
<p>以一个简易的博客页面为例，创建博客列表页，修改 <code>pages/index.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">import Layout from &#x27;../components/MyLayout.js&#x27;</span><br><span class="line"></span><br><span class="line">import Link from &#x27;next/link&#x27;</span><br><span class="line"></span><br><span class="line">const PostLink = (props) =&gt; (</span><br><span class="line">  &lt;li&gt;</span><br><span class="line">    &lt;Link href=&#123;`/post?title=$&#123;props.title&#125;`&#125;&gt;</span><br><span class="line">      &lt;a&gt;&#123;props.title&#125;&lt;/a&gt;</span><br><span class="line">    &lt;/Link&gt;</span><br><span class="line">  &lt;/li&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">export default () =&gt; (</span><br><span class="line">  &lt;Layout&gt;</span><br><span class="line">    &lt;h1&gt;My Blog&lt;/h1&gt;</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &lt;PostLink title=&quot;Hello Next.js&quot;/&gt;</span><br><span class="line">      &lt;PostLink title=&quot;Learn Next.js is awesome&quot;/&gt;</span><br><span class="line">      &lt;PostLink title=&quot;Deploy apps with Zeit&quot;/&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  &lt;/Layout&gt;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>有了列表页，需要再写一个博客的详情页，从上面的代码中也可看到，我们需要创建一个 <code>pages/post.js</code>文件</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import Layout from &#x27;../components/MyLayout.js&#x27;</span><br><span class="line"></span><br><span class="line">export default (props) =&gt; (</span><br><span class="line">  &lt;Layout&gt;</span><br><span class="line">    &lt;h1&gt;&#123;props.url.query.title&#125;&lt;/h1&gt;</span><br><span class="line">    &lt;p&gt;This is the blog post content.&lt;/p&gt;</span><br><span class="line">  &lt;/Layout&gt;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="2-5-用路由遮盖（Route-Masking）的干净的URL"><a href="#2-5-用路由遮盖（Route-Masking）的干净的URL" class="headerlink" title="2.5 用路由遮盖（Route Masking）的干净的URL"></a>2.5 用路由遮盖（Route Masking）的干净的URL</h3><blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Next.js`上提供了一个独特的特性：路由遮盖（Route Masking）。它可以使得在浏览器上显示的是路由`A`，而`App`内部真正的路由是`B`。这个特性可以让我们来设置一些比较简洁的路由显示在页面，而系统背后是使用一个带参数的路由。比如上面的例子中，地址栏中显示的是 `http://localhost:3000/post?title=Hello%20Next.js` ，这个地址含有一个`title`参数，看着很不整洁。下面我们就用`Next.js`来改造路由，使用路由遮盖来创建一个更加简洁的路由地址。比如我们将该地址改造成 `http://localhost:3000/p/hello-nextjs</span><br></pre></td></tr></table></figure>
</blockquote>
<p>首先我们要修改 <code>pages/index.js</code> 下的<code>PostLink</code>组件，会使用到 <code>next/link</code> 组件的 <code>as</code> 属性，并给组件添加一个属性 <code>id</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">import Layout from &#x27;../components/MyLayout.js&#x27;</span><br><span class="line"></span><br><span class="line">import Link from &#x27;next/link&#x27;</span><br><span class="line"></span><br><span class="line">const PostLink = (props) =&gt; (</span><br><span class="line">  &lt;li&gt;</span><br><span class="line">    &lt;Link as=&#123;`/p/$&#123;props.id&#125;`&#125; </span><br><span class="line">      href=&#123;`/post?title=$&#123;props.title&#125;`&#125;&gt;</span><br><span class="line">      &lt;a&gt;&#123;props.title&#125;&lt;/a&gt;</span><br><span class="line">    &lt;/Link&gt;</span><br><span class="line">  &lt;/li&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">export default () =&gt; (</span><br><span class="line">  &lt;Layout&gt;</span><br><span class="line">    &lt;h1&gt;My Blog&lt;/h1&gt;</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &lt;PostLink id=&quot;hello-nextjs&quot; </span><br><span class="line">        title=&quot;Hello Next.js&quot;/&gt;</span><br><span class="line">      &lt;PostLink id=&quot;learn-nextjs&quot; </span><br><span class="line">        title=&quot;Learn Next.js is awesome&quot;/&gt;</span><br><span class="line">      &lt;PostLink id=&quot;deploy-nextjs&quot; </span><br><span class="line">        title=&quot;Deploy apps with Zeit&quot;/&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  &lt;/Layout&gt;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ol>
<li>当在 <code>Link</code> 组件上使用 <code>as</code> 属性时，浏览器上显示的是 <code>as</code> 属性的值，走的是客户端路由，而服务器真正映射的是 <code>href</code> 属性的值，走的是服务端路由</li>
<li>这样就会有一个问题，如果在前端路由间切换不会有问题，可以正常显示，但是在页面 <code>http://localhost:3000/p/hello-nextjs</code> 时刷新页面，会显示 <code>404</code>页面。这是因为路由遮盖默认只在客户端路由中有效，要想在服务端也支持路由遮盖，需要在服务端单独设置路由解析的方法</li>
</ol>
<h3 id="2-6-服务端支持路由遮盖"><a href="#2-6-服务端支持路由遮盖" class="headerlink" title="2.6 服务端支持路由遮盖"></a>2.6 服务端支持路由遮盖</h3><blockquote>
<p>上面说到，服务器默认不支持路由遮盖，要让服务器支持它，需要单独对路由进行设置。下面以 <code>Express</code>（你也可以使用Koa等其他Nodejs的Web服务器框架）创建后端服务器讲解如何设置服务器来支持路由遮盖</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save express</span><br></pre></td></tr></table></figure>

<p>在项目目录下创建 <code>server.js</code> ，添加内容如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">const express = require(&#x27;express&#x27;)</span><br><span class="line">const next = require(&#x27;next&#x27;)</span><br><span class="line">const dev = process.env.NODE_ENV !== &#x27;production&#x27;</span><br><span class="line">const app = next(&#123; dev &#125;)</span><br><span class="line">const handle = app.getRequestHandler()</span><br><span class="line"></span><br><span class="line">app.prepare().then(() =&gt; &#123;</span><br><span class="line">  const server = express()</span><br><span class="line"></span><br><span class="line">  server.get(&#x27;/p/:id&#x27;, (req, res) =&gt; &#123;</span><br><span class="line">    const actualPage = &#x27;/post&#x27;</span><br><span class="line">    const queryParams = &#123; </span><br><span class="line">        title: req.params.id </span><br><span class="line">    &#125; </span><br><span class="line">    app.render(req, res, actualPage, queryParams)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  server.get(&#x27;*&#x27;, (req, res) =&gt; &#123;</span><br><span class="line">    return handle(req, res)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  server.listen(3000, (err) =&gt; &#123;</span><br><span class="line">    if (err) throw err</span><br><span class="line">    console.log(&#x27;&gt; Ready on http://localhost:3000&#x27;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;).catch((ex) =&gt; &#123;</span><br><span class="line">  console.error(ex.stack)</span><br><span class="line">  process.exit(1)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>并更新 <code>package.json</code> 文件中的 <code>scripts</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;dev&quot;: &quot;node server.js&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这时候，服务器已经可以支持路由遮盖了，在显示遮盖路由的页面，刷新页面也可以正常显示内容。具体的实现是在服务器中对 <code>/p/*</code> 开头的路由进行重写，然后重定向到 <code>/post</code> 开头的路由上，最后将内容返回给前端。具体代码是这一段：</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">server.get(&#x27;/p/:id&#x27;, (req, res) =&gt; &#123;</span><br><span class="line">  const actualPage = &#x27;/post&#x27;</span><br><span class="line">  const queryParams = &#123; </span><br><span class="line">      title: req.params.id </span><br><span class="line">  &#125; </span><br><span class="line">  app.render(req, res, actualPage, queryParams)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="2-7-请求接口，获取数据"><a href="#2-7-请求接口，获取数据" class="headerlink" title="2.7 请求接口，获取数据"></a>2.7 请求接口，获取数据</h3><blockquote>
<p><code>Next.js</code> 在 <code>React</code>的基础上为组件添加了一个新的特性： <code>getInitialProps</code>（有点像是<code>getInitialState</code>），它用于获取并处理组件的属性，返回组件的默认属性。我们可以在改方法中请求数据，获取页面需要的数据并渲染返回给前端页面</p>
</blockquote>
<p>引入一个支持在客户端和服务器端发送 <code>fetch</code> 请求的插件 <code>isomorphic-unfetch</code>，当然你也可以使用 <code>axios</code> 等其他工具</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save isomorphic-unfetch</span><br></pre></td></tr></table></figure>

<p>然后修改 <code>pages/index.js</code> 里的内容，换成下面这样：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">import Layout from &#x27;../components/MyLayout.js&#x27;</span><br><span class="line">import Link from &#x27;next/link&#x27;</span><br><span class="line">import fetch from &#x27;isomorphic-unfetch&#x27;</span><br><span class="line"></span><br><span class="line">const Index = (props) =&gt; (</span><br><span class="line">  &lt;Layout&gt;</span><br><span class="line">    &lt;h1&gt;Batman TV Shows&lt;/h1&gt;</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &#123;props.shows.map((&#123;show&#125;) =&gt; (</span><br><span class="line">        &lt;li key=&#123;show.id&#125;&gt;</span><br><span class="line">          &lt;Link as=&#123;`/p/$&#123;show.id&#125;`&#125; </span><br><span class="line">            href=&#123;`/post?id=$&#123;show.id&#125;`&#125;&gt;</span><br><span class="line">            &lt;a&gt;&#123;show.name&#125;&lt;/a&gt;</span><br><span class="line">          &lt;/Link&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">      ))&#125;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  &lt;/Layout&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">Index.getInitialProps = async function() &#123;</span><br><span class="line">  const res = await fetch(&#x27;https://api.tvmaze.com/search/shows?q=batman&#x27;)</span><br><span class="line">  const data = await res.json()</span><br><span class="line"></span><br><span class="line">  console.log(`Show data fetched. Count: $&#123;data.length&#125;`)</span><br><span class="line"></span><br><span class="line">  return &#123;</span><br><span class="line">    shows: data</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default Index</span><br></pre></td></tr></table></figure>

<blockquote>
<p>上述代码中，在 <code>getInitialProps</code> 中使用了 <code>async</code> 和 <code>await</code> 来处理异步请求，并将取到的数据当做一个属性赋给页面，页面拿到这个属性的值后会用于页面的初始化渲染</p>
</blockquote>
<h3 id="2-8-样式化组件"><a href="#2-8-样式化组件" class="headerlink" title="2.8 样式化组件"></a>2.8 样式化组件</h3><blockquote>
<p><code>Next.js</code> 提供了一个 <code>css-in-js</code> 的特性，它允许你在组件内部写一些样式，你只需要在组件内使用 `` 标签来写 <code>css</code> 即可。举个例子，比如我们在 <code>pages/index.js</code>里添加样式</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">import Layout from &#x27;../components/MyLayout.js&#x27;</span><br><span class="line"></span><br><span class="line">import Link from &#x27;next/link&#x27;</span><br><span class="line"></span><br><span class="line">function getPosts () &#123;</span><br><span class="line">  return [</span><br><span class="line">    &#123; </span><br><span class="line">      id: &#x27;hello-nextjs&#x27;, </span><br><span class="line">      title: &#x27;Hello Next.js&#x27;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123; </span><br><span class="line">      id: &#x27;learn-nextjs&#x27;, </span><br><span class="line">      title: &#x27;Learn Next.js is awesome&#x27;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123; </span><br><span class="line">      id: &#x27;deploy-nextjs&#x27;, </span><br><span class="line">      title: &#x27;Deploy apps with ZEIT&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default () =&gt; (</span><br><span class="line">  &lt;Layout&gt;</span><br><span class="line">    &lt;h1&gt;My Blog&lt;/h1&gt;</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &#123;getPosts().map((post) =&gt; (</span><br><span class="line">        &lt;li key=&#123;post.id&#125;&gt;</span><br><span class="line">          &lt;Link as=&#123;`/p/$&#123;post.id&#125;`&#125; </span><br><span class="line">            href=&#123;`/post?title=$&#123;post.title&#125;`&#125;&gt;</span><br><span class="line">            &lt;a&gt;&#123;post.title&#125;&lt;/a&gt;</span><br><span class="line">          &lt;/Link&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">      ))&#125;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">    &lt;style jsx&gt;&#123;`</span><br><span class="line">      h1, a &#123;</span><br><span class="line">        font-family: &quot;Arial&quot;;</span><br><span class="line">      &#125;</span><br><span class="line">      ul &#123;</span><br><span class="line">        padding: 0;</span><br><span class="line">      &#125;</span><br><span class="line">      li &#123;</span><br><span class="line">        list-style: none;</span><br><span class="line">        margin: 5px 0;</span><br><span class="line">      &#125;</span><br><span class="line">      a &#123;</span><br><span class="line">        text-decoration: none;</span><br><span class="line">        color: blue;</span><br><span class="line">      &#125;</span><br><span class="line">      a:hover &#123;</span><br><span class="line">        opacity: 0.6;</span><br><span class="line">      &#125;</span><br><span class="line">    `&#125;&lt;/style&gt;</span><br><span class="line">  &lt;/Layout&gt;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在上述代码中，我们没有直接使用<code> 标签来书写样式代码，而是写在一个模板字符串`（&#123;</code>}）<code>里面。</code>Next.js<code>使用</code>babel<code>插件来解析</code>styled-jsx` ，它支持样式命名空间，未来还将支持变量赋值。</p>
</blockquote>
<p><strong>需要注意的是</strong>：<code>styled-jsx</code> 的样式不会应用到子组件，如果想要该样式适用于子组件，可以在<code>styled-jsx</code> 标签添加属性 <code>global：。</code></p>
<h3 id="2-9-怎么部署一个next-js项目"><a href="#2-9-怎么部署一个next-js项目" class="headerlink" title="2.9 怎么部署一个next.js项目"></a>2.9 怎么部署一个next.js项目</h3><blockquote>
<p><code>Next.js</code> 项目的部署，需要一个 <code>Node.js</code>的服务器，可以选择 <code>Express</code>, <code>Koa</code>或其他 <code>Nodejs</code> 的Web服务器。本文中以 <code>Express</code> 为例来部署 <code>Next</code> 项目。</p>
</blockquote>
<p>服务器的入口文件就使用上文中提到的 <code>server.js</code>，在 <code>server.js</code> 里添加了针对部署环境的选择，代码如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const dev = process.env.NODE_ENV !== &#x27;production&#x27;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>为了区分部署环境，我们需要在 <code>package.json</code> 中修改 <code>script</code> 属性如下</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">  &quot;build&quot;: &quot;next build&quot;,</span><br><span class="line">  &quot;start&quot;: &quot;NODE_ENV=production node server.js -&quot;,</span><br><span class="line">  &quot;dev&quot;: &quot;NODE_ENV=dev node server.js&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>其中，<code>build</code> 命令是用于打包项目，<code>start</code> 命令是用于生产环境部署，dev 命令是用于本地开发。</p>
</blockquote>
<p>执行如下命令即可将<code>Next</code>项目 部署到服务器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm run build</span><br><span class="line">$ npm run start</span><br></pre></td></tr></table></figure>

<h3 id="2-10-完整代码示例"><a href="#2-10-完整代码示例" class="headerlink" title="2.10 完整代码示例"></a>2.10 完整代码示例</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/poetries/react-next">https://github.com/poetries/react-next</a></p>
</blockquote>
<h2 id="三、更多须知"><a href="#三、更多须知" class="headerlink" title="三、更多须知"></a>三、更多须知</h2><h3 id="3-1-创建-static-文件夹，存放静态资源"><a href="#3-1-创建-static-文件夹，存放静态资源" class="headerlink" title="3.1 创建 /static 文件夹，存放静态资源"></a>3.1 创建 <code>/static</code> 文件夹，存放静态资源</h3><blockquote>
<p>静态资源文件夹文件会映射到 <code>/static/</code> 路由下，直接通过 <code>http://localhost:3000/static/test.png</code> 访问</p>
</blockquote>
<h3 id="3-2-使用内置组件-定制每个页面的-head-部分"><a href="#3-2-使用内置组件-定制每个页面的-head-部分" class="headerlink" title="3.2 使用内置组件 `` 定制每个页面的 head 部分"></a>3.2 使用内置组件 `` 定制每个页面的 <code>head</code> 部分</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import Head from &#x27;next/head&#x27;; // 引入内置组件</span><br><span class="line"></span><br><span class="line">export default () =&gt; (</span><br><span class="line">   &lt;div&gt;</span><br><span class="line">      &lt;Head&gt;</span><br><span class="line">         &lt;title&gt;index page&lt;/title&gt;</span><br><span class="line">         &lt;meta name=&quot;viewport&quot; content=&quot;initial-scale=1.0, width=device-width&quot;/&gt;</span><br><span class="line">      &lt;/Head&gt;</span><br><span class="line">      &lt;div&gt;this is index page&lt;/div&gt;</span><br><span class="line">   &lt;/div&gt;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="3-3-使用内置组件-进行路由跳转"><a href="#3-3-使用内置组件-进行路由跳转" class="headerlink" title="3.3 使用内置组件 `` 进行路由跳转"></a>3.3 使用内置组件 `` 进行路由跳转</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import Link from &#x27;next/link&#x27;;</span><br><span class="line"></span><br><span class="line">export default () =&gt; (</span><br><span class="line">   &lt;div&gt;</span><br><span class="line">      &lt;p&gt;this is home index page&lt;/p&gt;</span><br><span class="line">      &lt;Link href=&quot;/about&quot;&gt;</span><br><span class="line">         &lt;a&gt; to about page&lt;/a&gt;</span><br><span class="line">      &lt;/Link&gt;</span><br><span class="line">   &lt;/div&gt;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>更多 Link 使用方式</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123;Component&#125; from &#x27;react&#x27;;</span><br><span class="line">import Link from &#x27;next/link&#x27;;</span><br><span class="line"></span><br><span class="line">export default class About extends Component &#123;</span><br><span class="line">   constructor(props) &#123;</span><br><span class="line">      super(props);</span><br><span class="line">   &#125;</span><br><span class="line">   render() &#123;</span><br><span class="line">      // href 值可以是一个对象</span><br><span class="line">      const href = &#123;</span><br><span class="line">         pathname: &#x27;/home&#x27;,</span><br><span class="line">         query: &#123;name: &#x27;test&#x27;&#125;</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">           &lt;p&gt;this is about page &lt;/p&gt;</span><br><span class="line">           &lt;img src=&quot;/static/test.png&quot; alt=&quot;test&quot;/&gt;</span><br><span class="line">           &#123;/* replace 覆盖历史跳转 */&#125;</span><br><span class="line">           &lt;Link href=&#123;href&#125; replace&gt;</span><br><span class="line">            &lt;a&gt;click to home index page&lt;/a&gt;</span><br><span class="line">           &lt;/Link&gt;</span><br><span class="line">        &lt;/div&gt; </span><br><span class="line">      );</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-4-使用内置-router-方法，手动触发路由跳转"><a href="#3-4-使用内置-router-方法，手动触发路由跳转" class="headerlink" title="3.4 使用内置 router 方法，手动触发路由跳转"></a>3.4 使用内置 <code>router</code> 方法，手动触发路由跳转</h3><blockquote>
<p><code>next/router</code> 提供一套方法和属性，帮助确认当前页面路由参数，和手动触发路由跳转</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import router from &#x27;next/router&#x27;;</span><br><span class="line">/*</span><br><span class="line">    router.pathname  ==&gt; /home</span><br><span class="line">    router.query ==&gt; &#123;&#125;</span><br><span class="line">    router.route - 当前路由</span><br><span class="line">    asPath - 显示在浏览器地址栏的实际的路由</span><br><span class="line">    push(url, as=url) - 跳转页面的方法</span><br><span class="line">    replace(url, as=url) - 跳转页面</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>

<blockquote>
<p>更好的方式使用路由 – <code>router</code> 的 <code>withRouter</code> 方法</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import Link from &#x27;next/link&#x27;;</span><br><span class="line">import &#123;withRouter&#125; from &#x27;next/router&#x27;;</span><br><span class="line"></span><br><span class="line">const Home = (props) =&gt; &#123;</span><br><span class="line">    // 这里的 props 会得到 &#123;router, url&#125; 两个属性</span><br><span class="line">    // router: &#123;push: ƒ, replace: ƒ, reload: ƒ, back: ƒ, prefetch: ƒ, …&#125;</span><br><span class="line">    // url: &#123;query: &#123;…&#125;, pathname: &quot;/home&quot;, asPath: &quot;/home?name=test&quot;, back: ƒ, push: ƒ, …&#125;</span><br><span class="line">   console.log(props);</span><br><span class="line">   return (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">         &lt;p&gt;this is home index page &lt;/p&gt;</span><br><span class="line">         &#123;/* &lt;Link href=&quot;/about&quot;&gt;</span><br><span class="line">            &lt;a&gt; to about page&lt;/a&gt;</span><br><span class="line">         &lt;/Link&gt; */&#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">   );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default withRouter(Home);</span><br></pre></td></tr></table></figure>

<h3 id="3-5-使用-next-redux-wrapper-插件辅助实现-redux"><a href="#3-5-使用-next-redux-wrapper-插件辅助实现-redux" class="headerlink" title="3.5 使用 next-redux-wrapper 插件辅助实现 redux"></a>3.5 使用 <code>next-redux-wrapper</code> 插件辅助实现 <code>redux</code></h3><p><strong>1. 安装依赖</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yarn add next-redux-wrapper redux react-redux redux-devtools-extension redux-thunk</span><br></pre></td></tr></table></figure>

<p><strong>2. 创建 initializeStore.js 一个可以返回 store 实例的函数</strong></p>
<blockquote>
<p>在这个文件中会完成装载中间件、绑定<code>reducer</code>、链接浏览器的<code>redux</code>调试工具等操作</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createStore, applyMiddleware &#125; from &#x27;redux&#x27;;</span><br><span class="line">import &#123; composeWithDevTools &#125; from &#x27;redux-devtools-extension&#x27;; </span><br><span class="line">import thunk from &#x27;redux-thunk&#x27;;</span><br><span class="line">import reducer from &#x27;../modules/reducers&#x27;;</span><br><span class="line"></span><br><span class="line">const middleware = [thunk];</span><br><span class="line">const initializeStore = initialState =&gt; &#123;</span><br><span class="line">   return createStore(</span><br><span class="line">         reducer, </span><br><span class="line">         initialState, </span><br><span class="line">         composeWithDevTools(applyMiddleware(...middleware))</span><br><span class="line">      );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default initializeStore;</span><br></pre></td></tr></table></figure>

<p><strong>3. 创建 reducer , action</strong></p>
<blockquote>
<p>与普通 <code>react-redux</code> 项目创建 <code>reducer</code>, <code>action</code> 的方法一致，我把这部分代码都提取到一个名为 <code>modules</code>的文件夹中</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">// /modules/reducers.js</span><br><span class="line">import &#123; combineReducers &#125; from &#x27;redux&#x27;;</span><br><span class="line">import about from &#x27;./about/reducer&#x27;;</span><br><span class="line"></span><br><span class="line">// 合并到主reducer</span><br><span class="line">const reducers = &#123;</span><br><span class="line">   about</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// combineReducers() 函数用于将分离的 reducer 合并为一个 reducer </span><br><span class="line">export default combineReducers(reducers);</span><br><span class="line">// /modules/about/reudcer.js </span><br><span class="line">// /about 页面的 reducer</span><br><span class="line">import &#123;</span><br><span class="line">   CHANGE_COUNT</span><br><span class="line">&#125; from &#x27;../types-constant&#x27;;</span><br><span class="line"></span><br><span class="line">const initialState = &#123;</span><br><span class="line">   count: 0</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const typesCommands = &#123;</span><br><span class="line">   [CHANGE_COUNT](state, action) &#123;</span><br><span class="line">      return Object.assign(&#123;&#125;, state, &#123; count: action.msg &#125;);</span><br><span class="line">   &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default function home(state = initialState, action) &#123;</span><br><span class="line">   const actionResponse = typesCommands[action.type];</span><br><span class="line"></span><br><span class="line">   return actionResponse ? actionResponse(state, action) : state;</span><br><span class="line">&#125;</span><br><span class="line">// /modules/about/actions.js</span><br><span class="line">// /about 页面的 action</span><br><span class="line">import &#123;</span><br><span class="line">   CHANGE_COUNT</span><br><span class="line">&#125; from &#x27;../types-constant&#x27;;</span><br><span class="line"></span><br><span class="line">export function changeCount(newCount) &#123;</span><br><span class="line">   return &#123;</span><br><span class="line">      type: CHANGE_COUNT,</span><br><span class="line">      msg: newCount</span><br><span class="line">   &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>4. 页面中使用</strong></p>
<blockquote>
<p>需要用到 <code>next-redux-wrapper</code> 提供的 <code>withRedux</code> 高阶函数，以及 <code>react-redux</code> 提供的 <code>connect</code> 高阶函数</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; Component &#125; from &#x27;react&#x27;;</span><br><span class="line">import withRedux from &#x27;next-redux-wrapper&#x27;;</span><br><span class="line">import &#123; connect &#125; from &#x27;react-redux&#x27;;</span><br><span class="line">import &#123; bindActionCreators &#125; from &#x27;redux&#x27;;</span><br><span class="line">import AboutCom from &#x27;../components/About/index&#x27;;</span><br><span class="line">import initializeStore from &#x27;../store/initializeStore&#x27;;</span><br><span class="line">import &#123; changeCount &#125; from &#x27;../modules/about/actions&#x27;;</span><br><span class="line"></span><br><span class="line">class About extends Component &#123;</span><br><span class="line">   constructor(props) &#123;</span><br><span class="line">      super(props);</span><br><span class="line">   &#125;</span><br><span class="line">   render() &#123;</span><br><span class="line">      const &#123; about: &#123; count &#125;, changeCount &#125; = this.props;</span><br><span class="line">      return &lt;AboutCom count=&#123;count&#125; changeCount=&#123;changeCount&#125; /&gt;;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const connectedPage = connect(</span><br><span class="line">   state =&gt; (&#123; about: state.about &#125;),</span><br><span class="line">   dispatch =&gt; (&#123;</span><br><span class="line">      changeCount: bindActionCreators(changeCount, dispatch)</span><br><span class="line">   &#125;)</span><br><span class="line">)(About);</span><br><span class="line"></span><br><span class="line">export default withRedux(initializeStore)(connectedPage);</span><br></pre></td></tr></table></figure>

<h3 id="3-6-处理styled-components样式"><a href="#3-6-处理styled-components样式" class="headerlink" title="3.6 处理styled-components样式"></a>3.6 处理styled-components样式</h3><blockquote>
<p>在<code>pages/_document.js</code>中处理</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">import Document, &#123; Head, Main, NextScript &#125; from &#x27;next/document&#x27;</span><br><span class="line">import &#123; ServerStyleSheet &#125; from &#x27;styled-components&#x27;</span><br><span class="line"></span><br><span class="line">const pro = process.env.NODE_ENV === &#x27;production&#x27;</span><br><span class="line">const path = pro ? &#x27;https://cdn.yesdat.com&#x27; : &#x27;&#x27;</span><br><span class="line"></span><br><span class="line">export default class MyDocument extends Document &#123;</span><br><span class="line">  static getInitialProps(&#123; renderPage &#125;) &#123;</span><br><span class="line">    // 新建一个样式表</span><br><span class="line">    const sheet = new ServerStyleSheet() </span><br><span class="line">    </span><br><span class="line">    // 收集样式</span><br><span class="line">    const page = renderPage(App =&gt; props =&gt; sheet.collectStyles(&lt;App &#123;...props&#125; /&gt;))</span><br><span class="line">    const styleTags = sheet.getStyleElement()</span><br><span class="line"></span><br><span class="line">    const &#123;</span><br><span class="line">      html, head, errorHtml, chunks,</span><br><span class="line">    &#125; = renderPage()</span><br><span class="line"></span><br><span class="line">    return &#123;</span><br><span class="line">      html, head, errorHtml, chunks,...page, styleTags</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">        &lt;Head&gt;</span><br><span class="line">          &lt;meta charSet=&quot;utf-8&quot; /&gt;</span><br><span class="line">          &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no&quot; /&gt;</span><br><span class="line">          &lt;meta name=&quot;theme-color&quot; content=&quot;#000000&quot; /&gt;</span><br><span class="line">          &lt;meta name=&quot;apple-mobile-web-app-capable&quot; content=&quot;yes&quot; /&gt;</span><br><span class="line">          &lt;meta name=&quot;apple-touch-fullscreen&quot; content=&quot;yes&quot; /&gt;</span><br><span class="line">          &lt;link rel=&quot;stylesheet&quot; href=&#123;`$&#123;path&#125;/static/styles/antd_mobile_min.css`&#125; /&gt;</span><br><span class="line">          &lt;link rel=&quot;stylesheet&quot; href=&#123;`$&#123;path&#125;/static/styles/app_min.css?8`&#125; /&gt;</span><br><span class="line">          &lt;link rel=&quot;stylesheet&quot; href=&#123;`$&#123;path&#125;/static/styles/nprogress.css`&#125; /&gt;</span><br><span class="line">          &lt;link rel=&quot;stylesheet&quot; href=&#123;`$&#123;path&#125;/static/styles/index.css`&#125; /&gt;</span><br><span class="line">          &#123;/* styled-components样式*/&#125;</span><br><span class="line">          &lt;style&gt;&#123;this.props.styleTags&#125;&lt;/style&gt;</span><br><span class="line">        &lt;/Head&gt;</span><br><span class="line">        &lt;body&gt;</span><br><span class="line">          &#123;this.props.customValue&#125;</span><br><span class="line">          &lt;Main /&gt;</span><br><span class="line">          &lt;NextScript /&gt;</span><br><span class="line">        &lt;/body&gt;</span><br><span class="line">      &lt;/html&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/03/12/jQuery%E6%80%BB%E7%BB%93/">jQurty总结</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-03-12</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/javascript/">javascript</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/javascript/">javascript</a></span><div class="content"><h4 id="第一节-jQuery初步认知"><a href="#第一节-jQuery初步认知" class="headerlink" title="第一节 jQuery初步认知"></a>第一节 jQuery初步认知</h4><hr>
<h5 id="jQuery概述"><a href="#jQuery概述" class="headerlink" title="jQuery概述"></a>jQuery概述</h5><hr>
<ul>
<li><p><strong><code>JQuery</code>概念</strong></p>
<ul>
<li><p>```<br>javascript</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  概念</span><br><span class="line"></span><br><span class="line">  - 基于`Js`语言的`API`和语法组织逻辑，通过内置`window`和`document`对象，来操作内存中的`DOM`元素</span><br><span class="line"></span><br><span class="line">- ```</span><br><span class="line">  JQuery</span><br></pre></td></tr></table></figure>

<p>概念</p>
<ul>
<li>基于<code>javascript</code>的，同上，提高了代码的效率</li>
</ul>
</li>
</ul>
</li>
<li><p><strong><code>jQuery</code>是什么:</strong></p>
<ul>
<li>是一个<code>javascript</code>代码仓库，我们称之为<code>javascript</code>框架。</li>
<li>是一个快速的简洁的<code>javascript</code>框架，可以简化查询<code>DOM</code>对象、处理事件、制作动画、处理<code>Ajax</code>交互过程。</li>
<li>它可以帮我们做什么(有什么优势)<ul>
<li>轻量级、体积小，使用灵巧(只需引入一个<code>js</code>文件)</li>
<li>强大的选择器</li>
<li>出色的<code>DOM</code>操作的封装</li>
<li>出色的浏览器兼容性</li>
<li>可靠的事件处理机制</li>
<li>完善的<code>Ajax</code></li>
<li>链式操作、隐式迭代</li>
<li>方便的选择页面元素(模仿<code>CSS</code>选择器更精确、灵活)</li>
<li>动态更改页面样式/页面内容(操作<code>DOM</code>，动态添加、移除样式)</li>
<li>控制响应事件(动态添加响应事件)</li>
<li>提供基本网页特效(提供已封装的网页特效方法)</li>
<li>快速实现通信(<code>ajax</code>)</li>
<li>易扩展、插件丰富</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>如何引入<code>JQuery</code>包</strong></p>
<ul>
<li>引入本地的<code>JQuery</code></li>
<li>引入<code>Google</code>在线提供的库文件（稳定可靠高速）</li>
<li>使用<code>Google</code>提供的<code>API</code>导入 ``</li>
<li>写第一个<code>JQUery</code>案例<ul>
<li>解释:在<code>JQuery</code>库中，<code>$</code>是<code>JQuery</code>的别名，<code>$()</code>等效于就<code>jQuery()</code></li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=“text/javascript” src=“”&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type=“text/javascript”&gt;</span><br><span class="line">	$(function()&#123;</span><br><span class="line">		alert(“jQuery 你好!”);</span><br><span class="line">	&#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></li>
<li><p><strong>讲解<code>$(function()&#123;&#125;)</code>;</strong></p>
<ul>
<li><p><code>$</code>是<code>jQuery</code>别名。如<code>$()</code>也可<code>jQuery()</code>这样写,相当于页面初始化函数，当页面加载完毕，会执行<code>jQuery()</code>。</p>
</li>
<li><p>希望在做所有事情之前，<code>JQuery</code>操作<code>DOM</code>文档。必须确保在<code>DOM</code>载入完毕后开始执行，应该用<code>ready</code>事件做处理<code>HTML</code>文档的开始</p>
</li>
<li><p>```<br>$(document).ready(function(){})</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">    - 类似于`js`的`window.onload`事件函数，但是`ready`事件要先于`onload`事件执行</span><br><span class="line">    - `window.onload = function()&#123;&#125;`;</span><br><span class="line"></span><br><span class="line">  - 为方便开发，`jQuery`简化这样的方法，直接用`$()`表示</span><br><span class="line"></span><br><span class="line">  - `JQuery`的`ready`事件不等于`Js`的`load`：</span><br><span class="line"></span><br><span class="line">    - 执行时机不同：`load`需要等外部图片和视频等全部加载才执行。`ready`是`DOM`绘制完毕后执行，先与外部文件</span><br><span class="line">    - 用法不同：`load`只可写一次，`ready`可以多次</span><br><span class="line"></span><br><span class="line">- **`window.onload`与`$(document).ready()`对比**</span><br><span class="line"></span><br><span class="line">|          | window.onload                            | $(document).ready()                                          |</span><br><span class="line">| :------- | :--------------------------------------- | :----------------------------------------------------------- |</span><br><span class="line">| 执行时机 | 必须等网页中所有内容加载完后(图片)才执行 | 网页中的`DOM`结构绘制完后就执行,可能`DOM`元素相关的东西并没有加载完 |</span><br><span class="line">| 编写个数 | 不能同时执行多个                         | 能同时执行多个                                               |</span><br><span class="line">| 简化写法 | 无                                       | `$(document).ready(function()&#123; //.. &#125;);`  推荐写法：`$(function()&#123; &#125;);` |</span><br><span class="line"></span><br><span class="line">- **`jQuery`有哪些功能(`API`)**：</span><br><span class="line">  - 选择器</span><br><span class="line">  - 过滤器</span><br><span class="line">  - 事件</span><br><span class="line">  - 效果</span><br><span class="line">  - `ajax`</span><br><span class="line">- **简单的`JQuery`选择器**：</span><br><span class="line">  - `JQuery`基本选择器（`ID`选择器，标签选择器，类选择器，通配选择器和组选择器`5`种）</span><br><span class="line">  - `ID`选择器：`document.getElementById(id)`与`$(&quot;#id&quot;)`对比(改变文字大小)—`id`唯一，返回单个元素</span><br><span class="line">  - 标签选择器：`document.getElementsByTagName(tagName)`与`$(&quot;tagname&quot;)`对比—多个标签，返回数组</span><br><span class="line">  - 类选择器:`$(&quot;.className&quot;)`–多个`classname`（改变背景图片）</span><br><span class="line">  - 通配选择器：`document.getElementsByTagName(&quot;*&quot;)`与`$(&quot;*&quot;)`对比—指范围内的所有标签元素</span><br><span class="line">  - 组选择器：`$(&quot;seletor1,seletor2,seletor3&quot;)`—-无数量限制，用逗号分割</span><br><span class="line"></span><br><span class="line">##### 初步了解`JQuery`</span><br><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line">- `JQuery`是什么</span><br><span class="line"></span><br><span class="line">  - ```</span><br><span class="line">    javascript</span><br></pre></td></tr></table></figure>

<p>用来干什么的：</p>
<ul>
<li>操作<code>DOM</code>对象</li>
<li>动态操作样式<code>css</code></li>
<li>数据访问</li>
<li>控制响应事件等</li>
</ul>
</li>
<li><p><code>jQuery</code>作用一样，只是更加快速简洁</p>
</li>
</ul>
</li>
<li><p><strong>如何引用<code>JQuery</code></strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;&lt;/script&gt;</span><br><span class="line">写第一个JQUery案例</span><br><span class="line">&lt;script type=“text/javascript” src=“”&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type=“text/javascript”&gt;</span><br><span class="line">	$(function()&#123;</span><br><span class="line">		alert(“jQuery 你好!”);</span><br><span class="line">	&#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></li>
<li><p><strong><code>$()讲解</code></strong></p>
<ul>
<li><code>$</code>在<code>JQuery</code>库中，<code>$</code>是<code>JQuery</code>的别名，<code>$()</code>等效于就<code>jQuery()</code>.</li>
<li><code>$()</code>是<code>JQuery</code>方法,赞可看作是<code>JQuery</code>的选择器，与<code>css</code>选择器相似（可做对比）</li>
<li><code>var jQuery==$ =function()&#123;&#125;</code> <code>$()</code>本质就是一个函数也就是 <code>jQuery</code>的核心函数</li>
<li>只要是<code>jQuery</code>的对象都这样变量加上一个<code>符号$</code>方便识别：<code>var $div = $(&quot;#&quot;)</code></li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function　$(id)&#123;</span><br><span class="line">		return document.getElementById(id);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong><code>$()</code>和<code>document</code>是相等的吗</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=&quot;a&quot; class=&quot;aa&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;div id=&quot;b&quot; class=&quot;aa&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;div id=&quot;c&quot; class=&quot;aa&quot;&gt;&lt;/div&gt;</span><br><span class="line">alert(document.getElementById(&quot;id&quot;) == $(&quot;#aa&quot;));//返回结果为false</span><br><span class="line">alert(document.getElementById(&quot;id&quot;) == $(&quot;#aa&quot;).get(0));//返回true</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>代理对象<code>$()</code></strong></p>
<ul>
<li><p><code>jQuery</code>中返回的是代理对象本身</p>
</li>
<li><p><code>jQuery</code>的核心原理是通过选择器找到对应的代理对象</p>
</li>
<li><p><code>jQuery</code>全都是通过方法操作</p>
</li>
<li><p>样式选择器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(&quot;.className&quot;)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>$(&quot;.aa&quot;).css(&quot;color&quot;,&quot;green&quot;);</code></li>
</ul>
</li>
<li><p>id选择器(“”)</p>
<ul>
<li><code>$(&quot;#a&quot;).css(&quot;background-color&quot;,&quot;#ff0066&quot;);</code></li>
</ul>
</li>
<li><p>标签选择器</p>
<ul>
<li><code>$(&quot;p&quot;).css(&quot;color&quot;,&quot;#cc3366&quot;);</code></li>
</ul>
</li>
<li><p>组选择器</p>
<ul>
<li><code>$(&quot;#b ul li&quot;).size();</code></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>对象转换(<code>$(element)</code>)</strong></p>
<ul>
<li>原生<code>dom</code>对象和<code>jquery</code>代理对象的相互转换</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$(传入的原生对象);</span><br><span class="line">//原生对象转化成jQuery对象</span><br><span class="line">var nav = document.getElementById(&quot;nav&quot;);</span><br><span class="line">var $nav = $(nav);</span><br><span class="line">alert($nav.get(0) == nav);//true</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>检索范围的限制（<code>$(&#39;字符串&#39;,element)</code>）</strong></p>
<ul>
<li><strong>总结：三种写法对比：</strong><ul>
<li>方式一：不推荐 搜索速度最慢<ul>
<li><code>$(&quot;#nav&quot;).css();</code></li>
<li><code>$(&quot;#nav li&quot;).css();</code></li>
</ul>
</li>
<li>方式二：搜索速度最快 链式操作<ul>
<li><code>$(&quot;#nav&quot;).css().children().css();</code></li>
</ul>
</li>
<li>方式三：也常用 速度第二快<ul>
<li><code>var $nav = $(&quot;#nav&quot;).css()</code>;</li>
<li><code>$(&quot;li&quot;,$nav).css()</code>; <code>$nav</code>限制了搜索范围 速度快</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>总结： <code>$()</code> <code>jquery</code>核心方法的作用和使用场景</strong></p>
<ul>
<li>如果是一个字符串参数并且没有标签对（选择器）<code>$(ul.nav&quot;)</code></li>
<li>如果是一个字符串参数并且有标签对（创建<code>html</code>标签）<code>$(&quot;&quot;)</code> –最终加到<code>DOM</code>树中 <code>$xx.append(&quot;&quot;)</code>;</li>
<li>如果是传入一个<code>element dom</code>对象，直接包装为<code>proxy</code>对象返回 <code>$(DOM对象)</code></li>
<li>如果第一个参数是字符串，第二个是<code>element</code> <code>dom</code>对象的话，那么就是在<code>element</code>这个<code>dom</code>对象里面寻找选择器对应的元素并且代理 <code>$(&quot;li&quot;,$DOM对象)</code></li>
</ul>
</li>
<li><p><strong>代理模式以及代理内存结构</strong></p>
</li>
</ul>
<p><img src="http://7xq6al.com1.z0.glb.clouddn.com/jquery2.png" alt="代理内存结构1"></p>
<p><img src="http://7xq6al.com1.z0.glb.clouddn.com/jquery3.png" alt="代理内存结构2"></p>
<h4 id="第二节-选择器"><a href="#第二节-选择器" class="headerlink" title="第二节 选择器"></a>第二节 选择器</h4><hr>
<ul>
<li><strong>来回顾一下<code>CSS</code>常用的选择器</strong></li>
</ul>
<table>
<thead>
<tr>
<th align="left">选择器</th>
<th align="left">语法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">标签选择器</td>
<td align="left"><code>E&#123;css规则&#125;</code></td>
<td align="left">以文档元素作为选择符</td>
</tr>
<tr>
<td align="left"><code>ID</code>选择器</td>
<td align="left"><code>#ID&#123;css规则&#125;</code></td>
<td align="left"><code>ID</code>作为选择符</td>
</tr>
<tr>
<td align="left">类选择器</td>
<td align="left"><code>E.className&#123;css规则&#125;</code></td>
<td align="left"><code>class</code>作为选择符</td>
</tr>
<tr>
<td align="left">群组选择器</td>
<td align="left"><code>E1,E2,E3&#123;css规则&#125;</code></td>
<td align="left">多个选择符应用同样的样式</td>
</tr>
<tr>
<td align="left">后代选择器</td>
<td align="left"><code>E F&#123;css规则&#125;</code></td>
<td align="left">元素<code>E</code>的任意后代元素<code>F</code></td>
</tr>
</tbody></table>
<ul>
<li><p><strong>选择器引擎规则(<code>$(&#39;字符串&#39;)</code>)</strong></p>
<ul>
<li>```<br>css<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    选择器的规则</span><br><span class="line"></span><br><span class="line">    - 标签选择器</span><br><span class="line">    - `id`选择器</span><br><span class="line">    - 类选择器</span><br><span class="line">    - 混合选择器</span><br><span class="line"></span><br><span class="line">  - `css3`的选择器规则</span><br><span class="line"></span><br><span class="line">  - 状态和伪类（`:even` `:odd` `:first` `:last` `:eq(index)`）</span><br><span class="line"></span><br><span class="line">  - 属性（`[attr=value]`）</span><br><span class="line"></span><br><span class="line">- 层级选择器:通过`DOM`的嵌套关系匹配元素</span><br><span class="line">  - `jQuery`层级选择器—-包含选择器、子选择器、相邻选择器、兄弟选择器4种</span><br><span class="line">  - a.包含选择器：`$(&quot;a b&quot;)`在给定的祖先元素下匹配所有后代元素。(不受层级限制)</span><br><span class="line">  - b.子选择器：`$(&quot;parent &gt; child&quot;)`在给定的父元素下匹配所有子元素。</span><br><span class="line">  - c.相邻选择器：`$(&quot;prev + next&quot;)` 匹配所有紧接在`prev`元素后的`next`元素。</span><br><span class="line">  - d.兄弟选择器：`$(&quot;prev ~ siblings&quot;)` 匹配prev元素之后的所有`sibling`元素。</span><br><span class="line"></span><br><span class="line">##### 过滤选择器</span><br><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line">- **基本过滤选择**</span><br><span class="line"></span><br><span class="line">| 选择器       | 说明                           | 返回     |</span><br><span class="line">| :----------- | :----------------------------- | :------- |</span><br><span class="line">| `:first`     | 匹配找到的第1个元素            | 单个元素 |</span><br><span class="line">| `:last`      | 匹配找到的最后一个元素         | 单个元素 |</span><br><span class="line">| `:eq`        | 匹配一个给定索引值的元素       | 单个元素 |</span><br><span class="line">| `:even`      | 匹配所有索引值为偶数的元素     | 集合元素 |</span><br><span class="line">| `: odd`      | 匹配所有索引值为奇数的元素     | 集合元素 |</span><br><span class="line">| `:gt(index)` | 匹配所有大于给定索引值的元素   | 集合元素 |</span><br><span class="line">| `:lt(index)` | 匹配所有小于给定索引值的元素   | 集合元素 |</span><br><span class="line">| `:not`       | 去除所有与给定选择器匹配的元素 | 集合元素 |</span><br><span class="line">| `:animated`  | 选取当前正在执行动画的所有元素 | 集合元素 |</span><br><span class="line">| `focus`      | 选取当前正在获取焦点的元素     | 集合元素 |</span><br><span class="line"></span><br><span class="line">- **内容过滤选择器**</span><br><span class="line"></span><br><span class="line">| 选择器            | 描述                             | 返回     |</span><br><span class="line">| :---------------- | :------------------------------- | :------- |</span><br><span class="line">| `:contains(text)` | 选取含有文本内容为text的元素     | 集合元素 |</span><br><span class="line">| `:empty`          | 选取不包含子元素获取文本的空元素 | 集合元素 |</span><br><span class="line">| `:has(selector)`  | 选择含有选择器所匹配的元素的元素 | 集合元素 |</span><br><span class="line">| `:parent`         | 选取含有子元素或者文本的元素     | 集合元素 |</span><br><span class="line"></span><br><span class="line">- **可见过滤选择器**</span><br><span class="line"></span><br><span class="line">| 选择器     | 描述                 | 返回     |</span><br><span class="line">| :--------- | :------------------- | :------- |</span><br><span class="line">| `:hidden`  | 选择所有不可见的元素 | 集合元素 |</span><br><span class="line">| `:visible` | 选取所有可见的元素   | 集合元素 |</span><br><span class="line"></span><br><span class="line">- **属性过滤选择器**</span><br><span class="line"></span><br><span class="line">| 选择器              | 说明                            | 返回     |</span><br><span class="line">| :------------------ | :------------------------------ | :------- |</span><br><span class="line">| `[attribute]`       | 选取拥有此属性的元素            | 集合元素 |</span><br><span class="line">| `[attribute=value]` | 选取属性值为`value`值的元素     | 集合元素 |</span><br><span class="line">| `[attribue^=value]` | 选取属性的值以`value`开始的元素 | 集合元素 |</span><br><span class="line">| `[attribue$=value]` | 选取属性的值以`value`结束的元素 | 集合元素 |</span><br><span class="line"></span><br><span class="line">- **子元素过滤选择器**</span><br><span class="line"></span><br><span class="line">| 选择器                       | 说明                                                         | 返回     |</span><br><span class="line">| :--------------------------- | :----------------------------------------------------------- | :------- |</span><br><span class="line">| `:nth-child(index/even/odd)` | 选取每个父元素下的第index个子元素或者奇偶元素（`index`从`1`算起） | 集合元素 |</span><br><span class="line">| `:first-child`               | 选取每个元素的第一个子元素                                   | 集合元素 |</span><br><span class="line">| `:last-child`                | 选取每个元素的最后一个子元素                                 | 集合元素 |</span><br><span class="line"></span><br><span class="line">- `:nth-child()`选择器是很常用的子元素过滤选择器，如下</span><br><span class="line">  - `:nth-child(even)`选择每个父元素下的索引值是偶数的元素</span><br><span class="line">  - `:nth-child(odd)`选择每个父元素下的索引值是奇数的元素</span><br><span class="line">  - `:nth-child(2)`选择每个父元素下的索引值是`2`的元素</span><br><span class="line">  - `:nth-child(3n)`选择每个父元素下的索引值是3的倍数的元素 (`n`从`1`开始)</span><br><span class="line">- **表单对象属性过滤选择器**</span><br><span class="line"></span><br><span class="line">| 选择器      | 说明                                   | 返回     |</span><br><span class="line">| :---------- | :------------------------------------- | :------- |</span><br><span class="line">| `:enabled`  | 选取所有可用元素                       | 集合元素 |</span><br><span class="line">| `:disabled` | 选取所有不可用元素                     | 集合元素 |</span><br><span class="line">| `:checked`  | 选取所有被选中的元素（单选框、复选框） | 集合元素 |</span><br><span class="line">| `:selected` | 选取所有被选中的元素（下拉列表）       | 集合元素 |</span><br><span class="line"></span><br><span class="line">- **表单选择器**</span><br><span class="line"></span><br><span class="line">| 选择器      | 说明                                             |</span><br><span class="line">| :---------- | :----------------------------------------------- |</span><br><span class="line">| `:input`    | 选取所有`input` `textarea` `select` `button`元素 |</span><br><span class="line">| `:text`     | 选取所有单行文本框                               |</span><br><span class="line">| `:password` | 选取所有密码框                                   |</span><br><span class="line">| `:radio`    | 选取所有单选框                                   |</span><br><span class="line">| `:checkbox` | 选取所有多选框                                   |</span><br><span class="line">| `:submit`   | 选取所有的提交按钮                               |</span><br><span class="line">| `:image`    | 选取所有的图像按钮                               |</span><br><span class="line">| `:reset`    | 选取所有的重置按钮                               |</span><br><span class="line">| `:button`   | 选取所有的按钮                                   |</span><br><span class="line">| `:file`     | 选取所有的上传域                                 |</span><br><span class="line">| `:hidden`   | 选取所有的不可见元素                             |</span><br><span class="line"></span><br><span class="line">- **特定位置选择器**</span><br><span class="line">  - `:first`</span><br><span class="line">  - `:last`</span><br><span class="line">  - `:eq(index)`</span><br><span class="line">- **指定范围选择器**</span><br><span class="line">  - `:even`</span><br><span class="line">  - `:odd`</span><br><span class="line">  - `:gt(index)`</span><br><span class="line">  - `:lt(index)`</span><br><span class="line">- **排除选择器**</span><br><span class="line">  - `:not` 非</span><br><span class="line"></span><br><span class="line">#### 第三节 选择器优化</span><br><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line">- 使用合适的选择器表达式可以提高性能、增强语义并简化逻辑。常用的选择器中，`ID`选择器速度最快，其次是类型选择器。</span><br><span class="line">  - a. 多用`ID`选择器</span><br><span class="line">  - b. 少直接使用`class`选择器</span><br><span class="line">  - c. 多用父子关系，少用嵌套关系</span><br><span class="line">  - d. 缓存`jQuery`对象</span><br><span class="line">- **使用过滤器**</span><br><span class="line">  - `jQuery`提供了`2`种选择文档元素的方式：选择器和过滤器</span><br><span class="line">  - a. 类过虑器：根据元素的类属性来进行过滤操作。</span><br><span class="line">    - `hasClass(className)`：判断当前`jQuery`对象中的某个元素是否包含指定类名，包含返回`true`，不包含返回`false`</span><br><span class="line">  - b. 下标过滤器：精确选出指定下标元素</span><br><span class="line">    - `eq(index)`：获取第`N`个元素。`index`是整数值，下标从`0`开始</span><br><span class="line">  - c. 表达式过滤器</span><br><span class="line">    - `filter(expr)/(fn)`：筛选出与指定表达式/函数匹配的元素集合。</span><br><span class="line">    - 功能最强大的表达式过滤器，可接收函数参数，也可以是简单的选择器表达式</span><br><span class="line">  - d. 映射 `map(callback)`：将一组元素转换成其他数组</span><br><span class="line">  - e. 清洗 `not(expr)`：删除与指定表达式匹配的元素</span><br><span class="line">  - f. 截取 `slice(start,end)`：选取一个匹配的子集</span><br><span class="line">- **查找**</span><br><span class="line">  - 向下查找后代元素</span><br><span class="line">    - `children()`:取得所有元素的所有子元素集合（子元素）</span><br><span class="line">    - `find()`:搜索所有与指定表达式匹配的元素(所有后代元素中查找)</span><br><span class="line">  - 查找兄弟元素 `siblings()`查找当前元素的兄弟</span><br><span class="line"></span><br><span class="line">#### 第四节 代理对象属性和样式操作</span><br><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line">- **代理对象属性和样式操作**</span><br><span class="line">  - `attr`</span><br><span class="line">  - `prop`(一般属性值是`boolean`的值或者不用设置属性值，一般使用)</span><br><span class="line">  - `css`(最好不用，一般我用来做测试)</span><br><span class="line">  - `addClass` / `removeClass`</span><br><span class="line">- 操作原生`DOM`的时候用的方式：一次只能操作一个</span><br><span class="line">  - 操作属性：`setAttribute` / `getAttribute`</span><br><span class="line">  - 操作样式：`style.xx = value`</span><br><span class="line">  - 操作类样式：`className=&#x27;&#x27;`</span><br><span class="line">  - 获取`DOM`的子元素`children`属性</span><br><span class="line">  - `DOM`里面添加一个子元素`appendChild()`</span><br><span class="line">- 操作`jQuery`代理对象的时候：批量操作`DOM`对象(全都是通过方法操作)</span><br><span class="line">- 操作属性：`attr()`、`prop()`</span><br><span class="line">  - `attr`和`prop`区别：如果属性的值是布尔类型的值 用`prop`操作 反之`attr`</span><br><span class="line">- 操作样式：`css()`</span><br><span class="line">- 操作类样式：`addClass()` `removeClass()`</span><br><span class="line">- 操作`DOM`子元素：`children()`</span><br><span class="line">- 添加子元素：`append()`</span><br><span class="line"></span><br><span class="line">#### 第五节 jQuery中DOM操作</span><br><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line">- `DOM`是一种与浏览器、平台|语言无关的接口，使用该接口可以轻松的访问 页面中的所有的标准组件</span><br><span class="line"></span><br><span class="line">- **`DOM`操作的分类**</span><br><span class="line"></span><br><span class="line">  - **`DOM Core`**</span><br><span class="line"></span><br><span class="line">    - `DOM core`并不专属于`JavaScript`，任何支持`DOM`的程序都可以使用</span><br><span class="line">    - `JavaScript` 中的`getElementByID()` `getElementsByTagName()` `getAttribute()` `setAttribute()`等方法都是`DOM Core`的组成部分</span><br><span class="line"></span><br><span class="line">  - **`HTML-DOM`**</span><br><span class="line"></span><br><span class="line">    - `HTML -DOM`的出现比`DOM-Core`还要早，它提供一些更简明的标志来描述`HTML`元素的属性</span><br><span class="line"></span><br><span class="line">    - 比如：使用</span><br><span class="line"></span><br></pre></td></tr></table></figure>
  HTML-DOM  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">来获取某元素的</span><br><span class="line"></span><br></pre></td></tr></table></figure>
  src  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">      属性的方法</span><br><span class="line"></span><br><span class="line">      - `element.src`</span><br><span class="line"></span><br><span class="line">  - **`CSS-DOM`**</span><br><span class="line"></span><br><span class="line">    - 针对`CSS`的操作。在`JavaScript`中，主要用于获取和设置`style`对象的各种属性，通过改变`style`对象的属性，使网页呈现不同的效果</span><br><span class="line"></span><br><span class="line">- **查找节点**</span><br><span class="line"></span><br><span class="line">  - 查找属性节点 `attr()` 可以获取各属性的值</span><br><span class="line"></span><br><span class="line">- 创建节点</span><br><span class="line"></span><br><span class="line">  - `$(html)`：根据传递的标记字符串，创建`DOM`对象</span><br><span class="line"></span><br><span class="line">- **插入节点**</span><br><span class="line"></span><br><span class="line">| 方法             | 说明                             |</span><br><span class="line">| :--------------- | :------------------------------- |</span><br><span class="line">| `append()`       | 向每个匹配元素内部追加内容       |</span><br><span class="line">| `appendTo()`     | 颠倒`append()`的操作             |</span><br><span class="line">| `prepend()`      | 向每个匹配元素的内容内部前置内容 |</span><br><span class="line">| `prependTo()`    | 颠倒`prepend()`的操作            |</span><br><span class="line">| `after()`        | 向每个匹配元素之后插入内容       |</span><br><span class="line">| `insertAfter()`  | 颠倒`after()`的操作              |</span><br><span class="line">| `before()`       | 在每个匹配元素之前插入内容       |</span><br><span class="line">| `insertBefore()` | 颠倒`before()`的操作             |</span><br><span class="line"></span><br><span class="line">- **删除节点**</span><br><span class="line"></span><br><span class="line">  - jQuery提供了三种删除节点的方法 `remove()` `detach()` `empty()`</span><br><span class="line">  - `remove()方法`</span><br><span class="line">    - 当某个节点用此方法删除后，该节点所包含的所有后代节点将同时被删除，用`remove()`方法删除后，还是可以继续使用删除后的引用</span><br><span class="line">  - `detach()`</span><br><span class="line">    - 和`remove()`方法一样，也是从`DOM`中去掉所有匹配的元素，与`remove()`不同的是，所有绑定的事件、附加的数据等，都会被保留下来</span><br><span class="line">  - `empty()`</span><br><span class="line">    - `empty()`方法并不是删除节点，而是清空节点，它能清空元素中所有后代节点</span><br><span class="line"></span><br><span class="line">- **复制节点**</span><br><span class="line"></span><br><span class="line">  - 使用`clone()`方法来完成</span><br><span class="line">  - 在`clone()`方法中传递一个参数`true`，同时复制元素中所绑定的事件</span><br><span class="line"></span><br><span class="line">- **替换节点**</span><br><span class="line"></span><br><span class="line">  - `jQuery`提供相应的方法 `replaceWidth()`</span><br><span class="line"></span><br><span class="line">- **样式操作**</span><br><span class="line"></span><br><span class="line">  - 获取样式和设置样式 `attr()`</span><br><span class="line">  - 追加样式 `addClass()`</span><br><span class="line">  - 移除样式 `removeClass()`</span><br><span class="line">  - 切换样式</span><br><span class="line">    - `toggle()`方法只要是控制行为上的重复切换（如果元素是显示的，则隐藏；如果元素原来是隐藏的，则显示）</span><br><span class="line">    - `toggleClass()`方法控制样式上的重复切换（如何类名存在，则删除它，如果类名不存在，则添加它）</span><br><span class="line">  - 判断是否含有某个样式</span><br><span class="line">    - `hasClass()`可以用来判断元素是否含有某个`class`,如有返回`true` 该方法等价于`is()`</span><br><span class="line"></span><br><span class="line">- **设置和获取HTML、文本和值**</span><br><span class="line"></span><br><span class="line">  - `html()`</span><br><span class="line"></span><br><span class="line">    - 此方法类似`JavaScript`中`innerHTML`属性，可以用来读取和设置某个元素中的`HTML`内容</span><br><span class="line"></span><br><span class="line">  - `text()`</span><br><span class="line"></span><br><span class="line">    方法</span><br><span class="line"></span><br><span class="line">    - 此方法类型`JavaScript`中`innerHTML`，用来读取和设置某个元素中的文本内容</span><br><span class="line"></span><br><span class="line">  - `val()`</span><br><span class="line"></span><br><span class="line">    方法</span><br><span class="line"></span><br><span class="line">    - 此方法类似`JavaScript`中的`value`属性，用来设置获取元素的值。无论是文本框、下拉列表还是单选框，都可以返回元素的值，如果元素多选，返回一个包含所有选择的值的数组</span><br><span class="line"></span><br><span class="line">- **遍历节点**</span><br><span class="line"></span><br><span class="line">  - `children()`</span><br><span class="line"></span><br><span class="line">    方法</span><br><span class="line"></span><br><span class="line">    - 该方法用来取得匹配元素的子元素集合</span><br><span class="line">    - `childre()`方法只考虑子元素而不考虑其他后代元素</span><br><span class="line"></span><br><span class="line">  - `next()`</span><br><span class="line"></span><br><span class="line">    方法</span><br><span class="line"></span><br><span class="line">    - 该方法用于取得匹配元素后面紧邻的同辈元素</span><br><span class="line"></span><br><span class="line">  - `prev()`</span><br><span class="line"></span><br><span class="line">    方法</span><br><span class="line"></span><br><span class="line">    - 用于匹配元素前面紧邻的同辈元素</span><br><span class="line"></span><br><span class="line">  - `siblings()`</span><br><span class="line"></span><br><span class="line">    方法</span><br><span class="line"></span><br><span class="line">    - 用于匹配元素前后所有的同辈元素</span><br><span class="line"></span><br><span class="line">  - `parent()`</span><br><span class="line"></span><br><span class="line">    方法</span><br><span class="line"></span><br><span class="line">    - 获得集合中每个 元素的父级元素</span><br><span class="line"></span><br><span class="line">  - `parents()`</span><br><span class="line"></span><br><span class="line">    方法</span><br><span class="line"></span><br><span class="line">    - 获得集合中每个元素的祖先元素</span><br><span class="line"></span><br><span class="line">##### CSS DOM操作</span><br><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line">- `CSS DOM`技术简单的来说就是读取和设置`style`对象的各种属性</span><br><span class="line"></span><br><span class="line">- 用`css()`方法获取元素的样式属性，可以同时设置多个样式属性</span><br><span class="line"></span><br><span class="line">- `CSS DOM`中关于元素定位有几个常用的方法</span><br><span class="line"></span><br><span class="line">  - `offset()`</span><br><span class="line"></span><br><span class="line">    方法</span><br><span class="line"></span><br><span class="line">    - 它的作用是获取元素在当前视窗的相对偏移其中返回的对象包含两个属性，即`top`和`left`，他只对可见元素有效</span><br><span class="line"></span><br><span class="line">  - `position()`</span><br><span class="line"></span><br><span class="line">    方法</span><br><span class="line"></span><br><span class="line">    - 获取相对于最近的一个`position()`样式属性设置为`relative`或者`absolute`的祖父节点的相对偏移，与`offset()`一样，他返回的对象也包括两个属性，即`top`和`left`</span><br><span class="line"></span><br><span class="line">  - `scrollTop()`</span><br><span class="line"></span><br><span class="line">    方法和</span><br><span class="line"></span><br><span class="line">    `scrollLeft`</span><br><span class="line"></span><br><span class="line">    方法</span><br><span class="line"></span><br><span class="line">    - 这两个方法的作用分别是获取元素的滚动条距顶端的距离和距左侧的距离</span><br><span class="line"></span><br><span class="line">  - **一张图总结以上的位置关系(项目中很常用-必须要弄清楚)**</span><br><span class="line"></span><br><span class="line">![img](http://7xq6al.com1.z0.glb.clouddn.com/jquery4.jpg)</span><br><span class="line">![img](http://7xq6al.com1.z0.glb.clouddn.com/jquery5.jpg)</span><br><span class="line">![img](http://7xq6al.com1.z0.glb.clouddn.com/jquery6.jpg)</span><br><span class="line">![img](http://7xq6al.com1.z0.glb.clouddn.com/jquery7.jpg)</span><br><span class="line">![img](http://7xq6al.com1.z0.glb.clouddn.com/jquery7.jpg)</span><br><span class="line"></span><br><span class="line">#### 第六节 jQuery动画</span><br><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line">##### 回顾上节</span><br><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line">- 操作DOM</span><br><span class="line">  - a.什么是`DOM`：`Document Object Model`缩写，文档对象模型</span><br><span class="line">  - b.理解页面的树形结构</span><br><span class="line">  - c.什么是节点：是DOM结构中最小单元，包括元素、属性、文本、文档等。</span><br><span class="line"></span><br><span class="line">###### 一、创建节点</span><br><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line">- 1.创建元素</span><br><span class="line">  - 语法：`document.createElement(name)`;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
var div = document.createElement(“div”);<br>document.body.appendChild(div);<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- `$(html)`：根据传递的标记字符串，创建DOM对象</span><br><span class="line">- 2.创建文本</span><br><span class="line"></span><br></pre></td></tr></table></figure>
var div = document.createElement(“div”);<br>var txt = document.createTextNode(“DOM”);<br>div.appendChild(txt);<br>document.body.appendChild(div);</li>
</ul>
</li>
</ul>
<p>var $div = = $(“<div>DOM</div>“);<br>$(body).append($div);<br>​```        </p>
<ul>
<li>3.设置属性<ul>
<li>语法：<code>e.setAttrbute(name,value)</code></li>
</ul>
</li>
</ul>
<p>​```javascript<br>var div = document.createElement(“div”);<br>var txt = document.createTextNode(“DOM”);<br>div.appendChild(txt);<br>document.body.appendChild(div);<br>div.setAttribute(“title”,”盒子”);</p>
<p>var $div = = $(“<div title='盒子'>DOM</div>“);<br>$(body).append($div);</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">###### 二、插入内容</span><br><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line">- 内部插入</span><br><span class="line">  - 向元素最后面插入节点：</span><br><span class="line">    - `append()`:向每个匹配的元素内部追加内容</span><br><span class="line">    - `appendTo()`:把所有匹配的元素追加到指定元素集合中，`$(&quot;A&quot;).append(&quot;B&quot;)`等效 `$(&quot;B&quot;).appendTo(&quot;A&quot;)`</span><br><span class="line">  - 向元素最前面插入节点：</span><br><span class="line">    - `prepend（）`：把每个匹配的元素内部前置内容</span><br><span class="line">    - `prependTo（）`：把所有匹配的元素前置到另一个指定的元素集合中,`$(&quot;A&quot;).prepend(&quot;B&quot;)` 等效 `$(&quot;B&quot;).prependTo(&quot;A&quot;)`</span><br><span class="line">- 外部插入</span><br><span class="line">  - `after()`:在每个匹配的元素之后插入内容</span><br><span class="line">  - `before()`：在每个匹配想元素之前插入内容</span><br><span class="line">  - `insertAfter()`：将所有匹配的元素插入到另一个指定的元素集合后面，`$A.insert($B)` 等效`$B.insertAfter($A);`</span><br><span class="line">  - `insertBefore()`：将所有匹配的元素插入到另一个指定的元素集合前面 `$A.before($B)` 等效 `$B.insertBefore($A)`;</span><br><span class="line"></span><br><span class="line">###### 三、删除内容</span><br><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line">- 移除</span><br><span class="line">  - `remove()`:从`DOM`中删除所有匹配元素</span><br><span class="line">- 清空</span><br><span class="line">  - `empty()`:删除匹配的元素集合中所有子节点内容</span><br><span class="line"></span><br><span class="line">###### 四、克隆内容：创建指定节点副本</span><br><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line">- ```</span><br><span class="line">  clone()</span><br></pre></td></tr></table></figure>

<ul>
<li>注意：若<code>clone（true）</code>则是包括克隆元素的属性，事件等</li>
</ul>
<h6 id="五、替换内容"><a href="#五、替换内容" class="headerlink" title="五、替换内容"></a>五、替换内容</h6><hr>
<ul>
<li><p><code>replaceWith()</code>:将所有匹配的元素替换成指定的元素</p>
</li>
<li><p><code>replaceAll()</code>:用匹配的元素替换掉指定元素</p>
</li>
<li><p>注意：两者效果一致，只是语法不同 <code>$A.replaceAll($B)</code>等效于 <code>$B.replaceWhith($A)</code>;</p>
</li>
</ul>
<h5 id="本节新知识"><a href="#本节新知识" class="headerlink" title="本节新知识"></a>本节新知识</h5><hr>
<ul>
<li><code>JavaScrip</code>t语言本身不支持动画设计，必须通过改变<code>CSS</code>来实现动画效果</li>
</ul>
<p><strong>显隐动画</strong></p>
<ul>
<li><p><code>show()</code>:显示 <code>hide()</code>:隐藏</p>
<ul>
<li><p>原理：<code>hide()</code>通过改变元素的高度宽度和不透明度，直到这三个属性值到<code>0</code></p>
</li>
<li><p><code>show()</code>从上到下增加元素的高度，从左到右增加元素宽度，从<code>0</code>到<code>1</code>增加透明度，直至内容完全可见</p>
</li>
<li><p>参数：</p>
<ul>
<li>```<br>show(speed,callback)<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">      - `speed`: 字符串或数字，表示动画将运行多久（`slow=0.6`/`normal=0.4`/`fast=0.2`）</span><br><span class="line">      - `callback`: 动画完成时执行的方法</span><br><span class="line"></span><br><span class="line">- 显示和隐藏式一对密不可分的动画形式</span><br><span class="line"></span><br><span class="line">- **显隐切换**</span><br><span class="line"></span><br><span class="line">  - ```</span><br><span class="line">    toggle()</span><br></pre></td></tr></table></figure></li>
</ul>
<p>:切换元素的可见状态</p>
<ul>
<li><p>原理：匹配元素的宽度、高度以及不透明度，同时进行动画，隐藏动画后将<code>display</code>设置为<code>none</code></p>
</li>
<li><p>参数：</p>
<ul>
<li><p><code>toggle(speed)</code></p>
</li>
<li><p><code>toggle(speed,callback)</code></p>
</li>
<li><p>```<br>toggle(boolean)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">        - `speed`: 字符串或数字，表示动画将运行多久（`slow=0.6`/`normal=0.4`/`fast=0.2`）</span><br><span class="line">        - `easing`： 使用哪个缓冲函数来过渡的字符串(`linear`/`swing`)</span><br><span class="line">        - `callback`： 动画完成时执行的方法</span><br><span class="line">        - `boolean`:`true`为显示 `false`为隐藏</span><br><span class="line"></span><br><span class="line">**滑动**</span><br><span class="line"></span><br><span class="line">- **显隐滑动效果**</span><br><span class="line">  - `slideDown()`:滑动隐藏</span><br><span class="line">  - `slidUp()`:滑动显示</span><br><span class="line">  - 参数:</span><br><span class="line">    - `slideDown(speed,callback)`</span><br><span class="line">    - `slidUp(speed,callback)`</span><br><span class="line">- **显隐切换滑动**</span><br><span class="line">  - `slideToggle()`:显隐滑动切换</span><br><span class="line">  - 参数:</span><br><span class="line">    - `slidUp(speed,callback)`</span><br><span class="line"></span><br><span class="line">**渐变：通过改变不透明度**</span><br><span class="line"></span><br><span class="line">- **淡入淡出**</span><br><span class="line">  - `fadeIn()`</span><br><span class="line">  - `fadeOut()`</span><br><span class="line">  - 参数：</span><br><span class="line">    - `fadeIn(speed,callback)`</span><br><span class="line">    - `fadeOut(speed,callback)`</span><br><span class="line">- **设置淡出透明效果**</span><br><span class="line">  - `fadeTo()`⁭：以渐进的方式调整到指定透明度</span><br><span class="line">  - 参数：</span><br><span class="line">    - `fadeTo(speed,opacity,callback)`</span><br><span class="line">- **渐变切换:结合`fadeIn`和`fadeOut`**</span><br><span class="line">  - `fadeToggle()`</span><br><span class="line">  - 参数:</span><br><span class="line">    - `fadeOut(speed,callback)`</span><br><span class="line"></span><br><span class="line">- 自定义动画：`animate()`</span><br><span class="line"></span><br><span class="line">  - 注意：在使用`animate`方法之前，为了影响该元素的`top` `left` `bottom` `right`样式属性，必须先把元素的`position`样式设置为`relative`或者`absolute`</span><br><span class="line"></span><br><span class="line">  - 停止元素的动画</span><br><span class="line"></span><br><span class="line">    - 很多时候需要停止匹配正在进行的动画，需要使用stop()</span><br><span class="line"></span><br><span class="line">    - ```</span><br><span class="line">      stop()</span><br></pre></td></tr></table></figure></li>
</ul>
<p>语法结构：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stop([clearQueue],[gotoEnd]);</span><br></pre></td></tr></table></figure>

<ul>
<li>都是可选参数，为布尔值</li>
<li>如果直接使用<code>stop()</code>方法，会立即停止当前正在进行的动画</li>
</ul>
</li>
</ul>
</li>
<li><p>判断元素是否处于动画状态</p>
<ul>
<li>如果不处于动画状态，则为元素添加新的动画，否则不添加<br><code>if(!$(element).is(&quot;:animated&quot;))&#123; //判断元素是否处于动画状态&#125;</code></li>
<li>这个方法在<code>animate</code>动画中经常被用到，需要注意</li>
</ul>
</li>
<li><p>延迟动画</p>
<ul>
<li>在动画执行过程中，如果你想对动画进行延迟操作，那么使用<code>delay()</code></li>
</ul>
</li>
</ul>
</li>
<li><p>用<code>animate</code>模拟<code>show()</code>:</p>
<ul>
<li><code>show</code>: 表示由透明到不透明</li>
<li><code>toggle</code>: 切换</li>
<li><code>hide</code>:表示由显示到隐藏</li>
</ul>
</li>
<li><p><strong>动画方法总结</strong></p>
</li>
</ul>
<table>
<thead>
<tr>
<th align="left">方法名</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>hide()</code>和<code>show()</code></td>
<td align="left">同时修改多个样式属性即高度和宽度和不透明度</td>
</tr>
<tr>
<td align="left"><code>fadeIn()</code>和<code>fadeOut()</code></td>
<td align="left">只改变不透明度</td>
</tr>
<tr>
<td align="left"><code>slideUp()</code>和<code>slideDown()</code></td>
<td align="left">只改变高度</td>
</tr>
<tr>
<td align="left"><code>fadeTo()</code></td>
<td align="left">只改变不透明度</td>
</tr>
<tr>
<td align="left"><code>toggle()</code></td>
<td align="left">用来代替<code>show()</code>和<code>hide()</code>方法，所以会同时修改多个属性即高度、宽度和不透明度</td>
</tr>
<tr>
<td align="left"><code>slideToggle()</code></td>
<td align="left">用来代替<code>slideUp</code>和<code>slideDown()</code>方法，所以只能改变高度</td>
</tr>
<tr>
<td align="left"><code>fadeToggle()</code></td>
<td align="left">用来代替<code>fadeIn()</code>和<code>fadeOut</code>方法，只能改变不透明度</td>
</tr>
<tr>
<td align="left"><code>animate()</code></td>
<td align="left">属于自定义动画，以上各种动画方法都是调用了<code>animate</code>方法。此外，用<code>animate</code>方法还能自定义其他的样式属性，例如：<code>left``marginLeft ``scrollTop</code>等</td>
</tr>
</tbody></table>
<h4 id="第七节-jQuery中的事件"><a href="#第七节-jQuery中的事件" class="headerlink" title="第七节 jQuery中的事件"></a>第七节 jQuery中的事件</h4><hr>
<ul>
<li><p><strong>事件对象的属性</strong></p>
<ul>
<li><code>event.type</code>：获取事件的类型</li>
<li><code>event.target</code>:获取到触发事件的元素</li>
<li><code>event.preventDefault</code>方法 阻止默认事件行为</li>
<li><code>event.stopPropagation()</code>阻止事件的冒泡</li>
<li><code>keyCode</code>：只针对于<code>keypress</code>事件，获取键盘键数字 按下回车，<code>13</code></li>
<li><code>event.pageX / event.pageY</code> 获取到光标相对于页面的<code>x</code>坐标和<code>y</code>坐标<ul>
<li>如果没有<code>jQuery</code>，在IE浏览器中用<code>event.x</code> / <code>event.y</code>;在<code>Firefox</code>浏览器中用<code>event.pageX</code> / <code>event.pageY</code>。如果页面上有滚动条还要加上滚动条的宽度和高度</li>
</ul>
</li>
<li><code>event.clientX</code>：光标对于浏览器窗口的水平坐标 浏览器</li>
<li><code>event.clientY</code>：光标对于浏览器窗口的垂直坐标</li>
<li><code>event.screenX</code>：光标对于电脑屏幕的水平坐标 电脑屏幕</li>
<li><code>event.screenY</code>：光标对于电脑屏幕的水平坐标</li>
<li><code>event.which</code> 该方法的作用是在鼠标单击事件中获取到鼠标的左、中、右键，在键盘事件中的按键 <code>1</code>代表左键 <code>2</code>代表中键 <code>3</code>代表右键</li>
</ul>
</li>
<li><p><strong>事件冒泡</strong></p>
<ul>
<li>什么是冒泡<ul>
<li>在页面上可以有多个事件，也可以多个元素影响同一个元素</li>
<li>从里到外</li>
<li>嵌套关系</li>
<li>相同事件</li>
<li>其中的某一父类没有相同事件时,继续向上查找</li>
</ul>
</li>
<li>停止事件冒泡<ul>
<li>停止事件冒泡可以阻止事件中其他对象的事件处理函数被执行</li>
<li>在<code>jQuery</code>中提供了**<code>stopPropagation()</code>**方法</li>
</ul>
</li>
<li>阻止默认行为<ul>
<li>网页中元素有自己的默认行为，例如：单击超链接后会跳转、单击提交后表单会提交，有时需要阻止元素的默认行为</li>
<li>在<code>jQuery</code>中提供了<code>preventDefault()</code>方法来阻止元素的默认行为</li>
</ul>
</li>
<li>事件捕获<ul>
<li>事件捕获和冒泡是相反的过程，事件捕获是从最顶端往下开始触发</li>
<li>并非所有的浏览器都支持事件捕获，并且这个缺陷无法通过<code>JavaScript</code>来修复。<code>jQuery</code>不支持事件捕获，如需要用事件捕获，要用原生的<code>JavaScript</code></li>
</ul>
</li>
</ul>
</li>
<li><p><strong><code>bind()</code>;绑定</strong></p>
<ul>
<li>为匹配元素绑定处理方法</li>
<li>需要给一个元素添加多个事件 ，事件执行一样时候</li>
<li><code>one()</code>：只执行一次</li>
</ul>
</li>
<li><p><strong>绑定特定事件类型方法</strong>：</p>
</li>
</ul>
<table>
<thead>
<tr>
<th align="left">分类</th>
<th align="left">方法名称</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">页面载入</td>
<td align="left"><code>ready(fn)</code></td>
<td align="left">当<code>DOM</code>载入就绪可以绑定一个要执行的函数</td>
</tr>
<tr>
<td align="left">事件绑定</td>
<td align="left"><code>blind(type,[data],fn)</code></td>
<td align="left">为每个匹配元素的特定事件绑定一个事件处理函数</td>
</tr>
<tr>
<td align="left">事件绑定</td>
<td align="left"><code>unblind()</code></td>
<td align="left">解除绑定</td>
</tr>
<tr>
<td align="left">事件绑定</td>
<td align="left"><code>on(events,[,selector[,]data],handler)</code></td>
<td align="left">在选择元素上绑定一个或者多个事件处理函数</td>
</tr>
<tr>
<td align="left">事件绑定</td>
<td align="left"><code>off()</code></td>
<td align="left">移除<code>on</code>绑定的事件</td>
</tr>
<tr>
<td align="left">事件绑定</td>
<td align="left"><code>delegate(selector,eventType,handler)</code></td>
<td align="left">为所有选择匹配元素附加一个或多个事件处理函数</td>
</tr>
<tr>
<td align="left">事件绑定</td>
<td align="left"><code>undelegate()</code></td>
<td align="left">移除绑定</td>
</tr>
<tr>
<td align="left">事件动态</td>
<td align="left"><code>live(type,fn)</code></td>
<td align="left">对动态生成的元素进行事件绑定</td>
</tr>
<tr>
<td align="left">事件动态</td>
<td align="left"><code>die(type,fn)</code></td>
<td align="left">移除<code>live()</code>绑定的事件</td>
</tr>
<tr>
<td align="left">交互事件</td>
<td align="left"><code>hover()</code></td>
<td align="left">鼠标移入移出</td>
</tr>
<tr>
<td align="left">交互事件</td>
<td align="left"><code>toggle(fn1,fn2,[fn3],[fn4])</code></td>
<td align="left">每单击后依次调用函数</td>
</tr>
<tr>
<td align="left">交互事件</td>
<td align="left"><code>blur(fn)</code></td>
<td align="left">触发每一个匹配元素的<code>blur</code>事件</td>
</tr>
<tr>
<td align="left">交互事件</td>
<td align="left"><code>change()</code></td>
<td align="left">触发每一个匹配元素的<code>change</code>事件</td>
</tr>
<tr>
<td align="left">交互事件</td>
<td align="left"><code>click()</code></td>
<td align="left">触发每一个匹配元素的<code>click</code>事件</td>
</tr>
<tr>
<td align="left">交互事件</td>
<td align="left"><code>focus()</code></td>
<td align="left">触发每一个匹配元素的<code>focus</code>事件</td>
</tr>
<tr>
<td align="left">交互事件</td>
<td align="left"><code>submit()</code></td>
<td align="left">触发每一个匹配元素的<code>submit</code>事件</td>
</tr>
<tr>
<td align="left">键盘事件</td>
<td align="left"><code>keydown()</code></td>
<td align="left">触发每一个匹配元素的<code>keydown</code>事件</td>
</tr>
<tr>
<td align="left">键盘事件</td>
<td align="left"><code>keypress()</code></td>
<td align="left">触发每一个匹配元素的<code>keypress</code>事件</td>
</tr>
<tr>
<td align="left">键盘事件</td>
<td align="left"><code>keyup()</code></td>
<td align="left">触发每一个匹配元素的keyup事件</td>
</tr>
<tr>
<td align="left">鼠标事件</td>
<td align="left"><code>mousedown(fn)</code></td>
<td align="left">绑定一个处理函数</td>
</tr>
<tr>
<td align="left">鼠标事件</td>
<td align="left"><code>mouseenter(fn)</code></td>
<td align="left">绑定一个处理函数</td>
</tr>
<tr>
<td align="left">键盘事件</td>
<td align="left"><code>mouseleave(fn)</code></td>
<td align="left">绑定一个处理函数</td>
</tr>
<tr>
<td align="left">键盘事件</td>
<td align="left"><code>mouseout(fn)</code></td>
<td align="left">绑定一个处理函数</td>
</tr>
<tr>
<td align="left">键盘事件</td>
<td align="left"><code>mouseover(fn)</code></td>
<td align="left">绑定一个处理函数</td>
</tr>
<tr>
<td align="left">窗口操作</td>
<td align="left"><code>resize(fn)</code></td>
<td align="left">绑定一个处理函数</td>
</tr>
<tr>
<td align="left">窗口操作</td>
<td align="left"><code>scroll(fn)</code></td>
<td align="left">绑定一个处理函数</td>
</tr>
</tbody></table>
<h4 id="第八节-jQuery与Ajax"><a href="#第八节-jQuery与Ajax" class="headerlink" title="第八节 jQuery与Ajax"></a>第八节 jQuery与Ajax</h4><hr>
<ul>
<li><p>Ajax</p>
<p>简介 :</p>
<ul>
<li><code>Asynchronous Javascript And XML</code> （异步的<br><code>JavaScript</code>和<code>XML</code>）</li>
<li>它并不是一种单一的技术，而是有机利用一系列交互式网页应用相关的技术所形成的结合体</li>
</ul>
</li>
<li><p><code>Ajax</code>优势与不足</p>
<ul>
<li><p><code>Ajax</code>优势</p>
<ul>
<li><p>优秀的用户体验</p>
<ul>
<li>这是<code>Ajax</code>下最大的有点，能在不刷新整个页面前提下更新数据</li>
</ul>
</li>
<li><p>提高</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">web</span><br></pre></td></tr></table></figure>

<p>程序的性能</p>
<ul>
<li>与传统模式相比，<code>Ajax</code>模式在性能上最大的区别在于传输数据的方式，在传统模式中，数据的提交时通过表单来实现的。<code>Ajax</code>模式只是通过<code>XMLHttpRequest</code>对象向服务器提交希望提交的数据，即按需发送</li>
</ul>
</li>
<li><p>减轻服务器和带宽的负担</p>
<ul>
<li><code>Ajax</code>的工作原理相当于在用户和服务器之间加了一个中间层，似用户操作与服务器响应异步化。它在客户端创建<code>Ajax</code>引擎，把传统方式下的一些服务器负担的工作转移到客户端，便于客户端资源来处理，减轻服务器和带宽的负担</li>
</ul>
</li>
</ul>
</li>
<li><p>Ajax的不足</p>
<ul>
<li>浏览器对<code>XMLHttpRequest</code>对象的支持度不足</li>
<li>破坏浏览器前进、后退按钮的正常功能</li>
<li>对搜索引擎的支持的不足</li>
<li>开发和调试工具的缺乏</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="创建一个Ajax请求"><a href="#创建一个Ajax请求" class="headerlink" title="创建一个Ajax请求"></a>创建一个Ajax请求</h5><hr>
<ul>
<li><p><code>Ajax</code>的核心是<code>XMLHttpRequest</code>对象，它是<code>Ajax</code>实现的关键，发送异步请求、接受响应以及执行回调都是通过它来完成</p>
</li>
<li><p><strong>创建<code>ajax</code>对象 <code>var xhr = new XMLHttpRequest();</code></strong></p>
</li>
<li><p><strong>准备发送请求</strong></p>
<ul>
<li><p><strong><code>get</code> / <code>post</code></strong></p>
<ul>
<li><p><code>get</code></p>
<ul>
<li>传递的数据放在<code>URL</code>后面</li>
<li>中文编码 <code>encodeURI( &#39;&#39; )</code>;</li>
<li>缓存 在数据后面加上随机数或者日期对象或者……</li>
</ul>
</li>
<li><p><strong><code>post</code></strong></p>
<ul>
<li>传递的数据放在<code>send()</code>里面，并且一定要规定数据格式</li>
<li>没有缓存问题</li>
</ul>
</li>
<li><p><code>form</code>表单中:</p>
<ul>
<li>```<br>action<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">        :</span><br><span class="line"></span><br><span class="line">        - `method`: (默认是`get`)</span><br><span class="line">        - `get`: 会在`url`里面以 `name=value` , 两个数据之间用 `&amp;` 连接</span><br><span class="line"></span><br><span class="line">      - `post`:</span><br><span class="line"></span><br><span class="line">    - `enctype`: `&quot;application/x-www-form-urlencoded&quot;`</span><br><span class="line"></span><br><span class="line">  - `url`</span><br><span class="line"></span><br><span class="line">  - 是否异步</span><br><span class="line"></span><br><span class="line">    - 同步(`false`)：阻塞</span><br><span class="line">    - 异步(`true`)：非阻塞</span><br><span class="line"></span><br><span class="line">- **正式发送请求**</span><br><span class="line"></span><br><span class="line">- **`ajax`请求处理过程**</span><br><span class="line"></span><br></pre></td></tr></table></figure>
xhr.onreadystatechange = function(){<br>if (xhr.readyState == 4)<br>{<br>alert( xhr.responseText );<br>}<br>};<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- `onreadystatechange` ：当处理过程发生变化的时候执行下面的函数</span><br><span class="line">- `readyState` ：`ajax`处理过程</span><br><span class="line">  - 0：请求未初始化（还没有调用 `open()`）。</span><br><span class="line">  - 1：请求已经建立，但是还没有发送（还没有调用 `send()`）。</span><br><span class="line">  - 2：请求已发送，正在处理中（通常现在可以从响应中获取内容头）。</span><br><span class="line">  - 3：请求在处理中；通常响应中已有部分数据可用了，但是服务器还没有完成响应的生成。</span><br><span class="line">  - 4：响应已完成；您可以获取并使用服务器的响应了。</span><br><span class="line">- `responseText` ：请求服务器返回的数据存在该属性里面</span><br><span class="line">- `status` : `http`状态码</span><br><span class="line"></span><br><span class="line">![HTTP状态码](http://7xq6al.com1.z0.glb.clouddn.com/jquery9.png)</span><br><span class="line"></span><br><span class="line">- 案例：`ajax`封装案例</span><br><span class="line"></span><br></pre></td></tr></table></figure>
//ajax请求后台数据<br>var btn =  document.getElementsByTagName(“input”)[0];<br>btn.onclick = function(){</li>
</ul>
</li>
</ul>
<p>ajax({//json格式</p>
<pre><code>type:&quot;post&quot;,
url:&quot;post.php&quot;,
data:&quot;username=poetries&amp;pwd=123456&quot;,
asyn:true,
success:function(data)&#123;
    document.write(data);
&#125;
</code></pre>
<p>});<br>}<br>//封装ajax<br>function ajax(aJson){<br>var ajx = null;<br>var type = aJson.type || “get”;<br>var asyn = aJson.asyn || true;<br>var url = aJson.url;        // url 接收 传输位置<br>var success = aJson.success;// success 接收 传输完成后的回调函数<br>var data = aJson.data || ‘’;// data 接收需要附带传输的数据</p>
<p>if(window.XMLHttpRequest){//兼容处理</p>
<pre><code>ajx = new XMLHttpRequest();//一般浏览器
</code></pre>
<p>}else<br>{</p>
<pre><code>ajx = new ActiveXObject(&quot;Microsoft.XMLHTTP&quot;);//IE6+
</code></pre>
<p>}<br>if (type == “get” &amp;&amp; data)<br>{</p>
<pre><code>url +=&quot;/?&quot;+data+&quot;&amp;&quot;+Math.random();
</code></pre>
<p>}</p>
<p>//初始化ajax请求<br>ajx.open( type , url , asyn );<br>//规定传输数据的格式<br>ajx.setRequestHeader(‘content-type’,’application/x-www-form-urlencoded’);<br>//发送ajax请求（包括post数据的传输）<br>type == “get” ?ajx.send():ajx.send(aJson.data);</p>
<p>//处理请求<br>ajx.onreadystatechange = function(aJson){</p>
<p>if(ajx.readState == 4){</p>
<pre><code>if (ajx.status == 200 &amp;&amp; ajx.status&lt;300)//200是HTTP 请求成功的状态码
&#123;
    //请求成功处理数据
    success &amp;&amp; success(ajx.responseText);
&#125;else&#123;
    alert(&quot;请求出错&quot;+ajx.status);
    
&#125;
</code></pre>
<p>}</p>
<p>};</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">##### jQuery中的Ajax [补充部分–来自锋利的jQuery]</span><br><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line">`jquery`对`Ajax`操作进行了封装，在`jquery`中的`$.ajax()`方法属于最底层的方法，第`2`层是`load()`、`$.get()`、`$.post();`第`3`层是`$.getScript()`、`$.getJSON()`，第`2`层使用频率很高</span><br><span class="line"></span><br><span class="line">###### `load()`方法</span><br><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line">- ```</span><br><span class="line">  load()</span><br></pre></td></tr></table></figure></li>
</ul>
<p>方法是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jquery</span><br></pre></td></tr></table></figure>

<p>中最简单和常用的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ajax</span><br></pre></td></tr></table></figure>

<p>方法，能载入远程</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HTML</span><br></pre></td></tr></table></figure>

<p>代码并插入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DOM</span><br></pre></td></tr></table></figure>

<p>中 结构为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">load(url,[data],[callback])</span><br></pre></td></tr></table></figure>

<ul>
<li>使用<code>url</code>参数指定选择符可以加载页面内的某些元素 <code>load</code>方法中<code>url</code>语法：<code>url selector</code> 注意：<code>url</code>和选择器之间有一个空格</li>
</ul>
</li>
<li><p>传递方式</p>
<ul>
<li><code>load()</code>方法的传递方式根据参数<code>data</code>来自动指定，如果没有参数传递，则采用<code>GET</code>方式传递，反之，采用<code>POST</code></li>
</ul>
</li>
<li><p>回调参数</p>
<ul>
<li>必须在加载完成后才执行的操作，该函数有三个参数 分别代表请求返回的内容、请求状态、<code>XMLHttpRequest</code>对象</li>
<li>只要请求完成，回调函数就会被触发</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$(&quot;#testTest&quot;).load(&quot;test.html&quot;,function(responseText,textStatus,XMLHttpRequest)&#123;</span><br><span class="line">    //respnoseText 请求返回的内容</span><br><span class="line">    //textStatus 请求状态 ：sucess、error、notmodified、timeout</span><br><span class="line">    //XMLHttpRequest </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>load方法参数</strong></li>
</ul>
<table>
<thead>
<tr>
<th align="left">参数名称</th>
<th align="left">类型</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>url</code></td>
<td align="left"><code>String</code></td>
<td align="left">请求<code>HTML</code>页面的<code>URL</code>地址</td>
</tr>
<tr>
<td align="left"><code>data(可选)</code></td>
<td align="left"><code>Object</code></td>
<td align="left">发送至服务器的<code>key</code> / <code>value</code>数据</td>
</tr>
<tr>
<td align="left"><code>callback(可选)</code></td>
<td align="left"><code>Function</code></td>
<td align="left">请求完成时的回调函数，无论是请求成功还是失败</td>
</tr>
</tbody></table>
<h6 id="get-和-post-方法"><a href="#get-和-post-方法" class="headerlink" title="$.get()和$.post()方法"></a>$.get()和$.post()方法</h6><hr>
<p><code>load()</code>方法通常用来从web服务器上获取静态的数据文件。在项目中需要传递一些参数给服务器中的页面，那么可以使用<code>$.get()</code>和<code>$.post()</code>或<code>$.ajax()</code>方法</p>
<ul>
<li><p>注意：<code>$.get()</code>和<code>$.post()</code>方法是<code>jquery</code>中的全局函数</p>
</li>
<li><p><strong>$.get()方法</strong></p>
<ul>
<li><p><code>$.get()</code>方法使用<code>GET</code>方式来进行异步请求</p>
</li>
<li><p>结构为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.get(url,[data],callback,type)</span><br></pre></td></tr></table></figure>

<ul>
<li>如果服务器返回的内容格式是<code>xml</code>文档，需要在服务器端设置<code>Content-Type</code>类型 代码如下：<code>header(&quot;Content-Type:text/xml:charset=utf-8&quot;)</code> //<code>php</code></li>
</ul>
</li>
</ul>
</li>
<li><p><strong><code>$.get()</code>方法参数解析</strong></p>
</li>
</ul>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">类型</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>url</code></td>
<td align="left"><code>String</code></td>
<td align="left">请求<code>HTML</code>页的地址</td>
</tr>
<tr>
<td align="left"><code>data(可选)</code></td>
<td align="left"><code>Object</code></td>
<td align="left">发送至服务器的<code>key</code>/ <code>value</code> 数据会作为<code>QueryString</code>附加到请求URL中</td>
</tr>
<tr>
<td align="left"><code>callback(可选)</code></td>
<td align="left"><code>Function</code></td>
<td align="left">载入成功的回调函数（只有当<code>Response</code>的返回状态是success才调用该方法）</td>
</tr>
<tr>
<td align="left"><code>type(可选)</code></td>
<td align="left"><code>String</code></td>
<td align="left">服务器返回内容的格式，包括<code>xml</code>、<code>html</code>、<code>script</code>、<code>json</code>、<code>text</code>和<code>_default</code></td>
</tr>
</tbody></table>
<ul>
<li><p><strong>$.post()方法</strong></p>
<ul>
<li><p>它与</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.get()</span><br></pre></td></tr></table></figure>

<p>方法的结构和使用方式相同，有如下区别</p>
<ul>
<li><p>```<br>GET</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">请求会将参数跟张乃URL后进行传递，而</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>POST</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">请求则是作为</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Http</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">消息的实体内容发送给web服务器，在</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ajax</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">      请求中，这种区别对用户不可见</span><br><span class="line"></span><br><span class="line">      - `GET`方式对传输数据有大小限制（通常不能大于`2KB`），而使用`POST`方式传递的数据量要比`GET`方式大得多（理论不受限制）</span><br><span class="line">      - `GET`方式请求的数据会被浏览器缓存起来，因此其他人可以从浏览器的历史纪录中读取这些数据，如：账号、密码。在某种情况下，`GET`方式会带来严重的安全问题，而`POST`相对来说可以避免这些问题</span><br><span class="line">      - `GET`和`POST`方式传递的数据在服务端的获取也不相同。在`PHP`中，`GET`方式用`$_GET[]`获取；`POST`方式用`$_POST[]`获取;两种方式都可用`$_REQUEST[]`来获取</span><br><span class="line"></span><br><span class="line">- **总结**</span><br><span class="line"></span><br><span class="line">  - 使用`load()`、`$.get()`和`$.post()`方法完成了一些常规的`Ajax`程序，如果还需要复杂的`Ajax`程序，就需要用到`$.ajax()`方式</span><br><span class="line"></span><br><span class="line">###### $.ajax()方法</span><br><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line">- `$.ajax()`方法是`jquery`最底层的`Ajax`实现，它的结构为`$.ajax(options)`</span><br><span class="line">- 该方法只有一个参数，但在这个对象里包含了`$.ajax()`方式所需要的请求设置以及回调函等信息，参数以`key` / `value`存在，所有参数都是可选的</span><br><span class="line">- **$.ajax()方式常用参数解析**</span><br><span class="line"></span><br><span class="line">| 参数         | 类型       | 说明                                                         |</span><br><span class="line">| :----------- | :--------- | :----------------------------------------------------------- |</span><br><span class="line">| `url`        | `String`   | (默认为当前页地址)发送请求的地址                             |</span><br><span class="line">| `type`       | `String`   | 请求方式（`POST`或`GET`）默认为`GET`                         |</span><br><span class="line">| `timeout`    | `Number`   | 设置请求超时时间（毫秒）                                     |</span><br><span class="line">| `dataType`   | `String`   | 预期服务器返回的类型。可用的类型如下  **xml**:返回`XML`文档，可用`jquery`处理 **html**:返回纯文本的`HTML`信息，包含的`script`标签也会在插入`DOM`时执行 **script**：返回纯文本的`javascript`代码。不会自动缓存结果，除非设置`cache`参数。注意：在远程请求时，所有的`POST`请求都将转为`GET`请求 **json**:返回`JSON`数据 **jsonp**:`JSONP`格式，使用`jsonp`形式调用函数时，例如：`myurl?call back=?,jquery`将自动替换后一个`？`为正确的函数名，以执行回调函数 **text**:返回纯文本字符串 |</span><br><span class="line">| `beforeSend` | `Function` | 发送请求前可以修改`XMLHttpRequest`对象的函数，例如添加自定义`HTTP`头。在`beforeSend`中如果返回`false`可以取消本次`Ajax`请求。`XMLHttpRequest`对象是唯一的参数 function(XMLHttpRequest)&#123;      `this`;//调用本次`Ajax`请求时传递的`options`参数 &#125; |</span><br><span class="line">| `complete`   | `Function` | 请求完成后的回调函数（请求成功或失败时都调用） 参数：`XMLHttpRequest`对象和一个描述成功请求类型的字符串 function(XMLHttpRequest,textStatus)&#123;      `this`;//调用本次Ajax请求时传递的`options`参数 &#125; |</span><br><span class="line">| `success`    | `Function` | 请求成功后调用的回调函数，有两个参数 (1)由服务器返回，并根据`dataTyppe`参数进行处理后的数据 (2)描述状态的字符串 `function`(data,textStatus)&#123;      //`data`可能是`xmlDoc、``jsonObj`、`html`、`text`等      `this`;//调用本次`Ajax`请求时传递的`options`参数 &#125; |</span><br><span class="line">| `error`      | `Function` | 请求失败时被调用的函数                                       |</span><br><span class="line">| `global`     | `Boolean`  | 默认为`true`。表示是否触发全局`Ajax`事件，设置为`false`将不会触发。`AjaxStart`或`AjaxStop`可用于控制各种`Ajax`事件 |</span><br><span class="line"></span><br><span class="line">#### 第九节 插件</span><br><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line">- **什么是插件**</span><br><span class="line">  - 插件(`Plugin`)也称为`jQuery`的扩展。以`jQuery`核心代码为基础编写的符合一定规范的应用程序。通过`js`文件的方式引用。</span><br><span class="line">- **插件分为哪几类**</span><br><span class="line">  - `UI`类、表单及验证类、输入类、特效类、`Ajax`类、滑动类、图形图像类、导航类、综合工具类、动画类等等</span><br><span class="line"></span><br><span class="line">- 引入插件的步骤</span><br><span class="line">  - 引入`jquery.js`文件，而且在所以插件之前引入</span><br><span class="line">  - 引入插件</span><br><span class="line">  - 引入插件相关文件，比如皮肤、中文包</span><br><span class="line"></span><br><span class="line">- **如何自定义插件**：</span><br><span class="line">  - 插件形式分为3类：</span><br><span class="line">    - 封装对象方法插件</span><br><span class="line">    - 封装全局函数插件</span><br><span class="line">    - 选择器插件(类似于.`find()`)</span><br><span class="line">- **自定义插件的规范**（解决各种插件的冲突和错误，增加成功率）</span><br><span class="line">  - 命名：`jquery.插件名.js`</span><br><span class="line">  - 所有的新方法附加在`jquery.fn`对象上面，所有新功能附加在`jquery`上</span><br><span class="line">  - 所有的方法或插件必须用分号结尾，避免出问题</span><br><span class="line">  - 插件必须返回jQuery对象，便于链式连缀</span><br><span class="line">  - 避免插件内部使用`$`，如果要使用，请传递`jQuery`(`$`并不是总等于`jQuery`，另外其他`js`框架也可能使用`$`)</span><br><span class="line">  - 插件中的`this`应该指向`jQuery`对象</span><br><span class="line">  - 使用`this.each()`迭代元素</span><br><span class="line">- **自定义插件案例**</span><br><span class="line">  - 为了方便用户创建插件，`jQuery`提供了 `jQuery.extend()` 和 `jQuery.fn.extend()`</span><br><span class="line">  - `jQuery.extend()`：创建工具函数或者是选择器</span><br><span class="line">  - `jQuery.fn.extend()`：创建`jQuery`对象命令 （`fn`相当于`prototype`的别名）</span><br><span class="line">- **`jQuery`官方提供的插件开发模板**</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>;(function($){<br>$.fn.plugin=function(options){<br>  var defaults = {</p>
<pre><code>  //各种参数 各种属性
</code></pre>
<p>  }<br>  var options = $.extend(defaults,options);</p>
<p>  this.each(function(){</p>
<pre><code>  //实现功能的代码
</code></pre>
<p>  });</p>
<p>  return this;<br>}<br>})(jQuery);</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**自定义`jQuery`函数**：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>(function($){<br>$.extend({<br>  test: function(){</p>
<pre><code>  alert(&quot;hello plugin&quot;);
</code></pre>
<p>  }<br>})<br>})(jQuery);</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**自定义`jQuery`命令**：</span><br><span class="line"></span><br><span class="line">- 形式1：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>(function($){<br>$.fn.extend({<br>  say : function(){<br>   alert(“hello plugin”);<br>}<br>})<br>})(jQuery);</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 形式2：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>(function($){<br>$.fn.say = function(){<br>  alert(“hello plugin”);<br>};</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>})(jQuery);</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 附录一 jQuery各个版本新增的一些常用的方法</span><br><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line">- `jQuery1.3`新增常用的方法</span><br><span class="line"></span><br><span class="line">| 方法         | 说明                                                         |</span><br><span class="line">| :----------- | :----------------------------------------------------------- |</span><br><span class="line">| `.closest()` | 从元素本身开始，逐级向上级元素匹配，并返回最先匹配的祖先元素 |</span><br><span class="line">| `die()`      | 从元素中删除先前用`live()`方法绑定的所有的事件               |</span><br><span class="line">| `live()`     | 附加一个事件处理器到符合目前选择器的所有元素匹配             |</span><br><span class="line"></span><br><span class="line">- `jQuery1.4`新增常用的方法</span><br><span class="line"></span><br><span class="line">| 方法            | 说明                                                         |</span><br><span class="line">| :-------------- | :----------------------------------------------------------- |</span><br><span class="line">| `.first()`      | 获取集合中第一个元素                                         |</span><br><span class="line">| `last()`        | 获取集合中最后一个元素                                       |</span><br><span class="line">| `has(selector)` | 保留包含特定后代的元素，去掉那些不含有指定后代的元素         |</span><br><span class="line">| `detach()`      | 从`DOM`中去掉所有匹配的元素。`detach()`和`remov()`一样，除了`detach()`保存了所有`jquery`数据和被移走的元素相关联。当需要移走一个元素，不久又将该元素插入`DOM`时，这种方法很有用 |</span><br><span class="line">| `delegate()`    | 为所有选择器匹配的元素附加一个处理一个或多个事件             |</span><br><span class="line">| `undelegate()`  | 为所有选择器匹配的元素删除一个处理一个或多个事件             |</span><br><span class="line"></span><br><span class="line">- `jQuery1.6`新增常用的方法</span><br><span class="line"></span><br><span class="line">| 方法                           | 说明                                     |</span><br><span class="line">| :----------------------------- | :--------------------------------------- |</span><br><span class="line">| `prop(proptyName)`             | 获取在匹配元素集合中的第一个元素的属性值 |</span><br><span class="line">| `removeProp(proptyName,value)` | 为匹配的元素删除设置的属性               |</span><br><span class="line">| `:focus`                       | 选择当前获取焦点的元素                   |</span><br><span class="line"></span><br><span class="line">#### 附录二 jQuery性能优化</span><br><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line">- **性能优化**</span><br><span class="line"></span><br><span class="line">  - 使用最新版的jQuery类库</span><br><span class="line"></span><br><span class="line">  - 使用合适的选择器</span><br><span class="line"></span><br><span class="line">    - ```</span><br><span class="line">      $(#id)</span><br></pre></td></tr></table></figure>

<pre><code>  - 使用`id`来定位`DOM`元素是最佳的方式，为了提高性能，建议从最近的`ID`元素开始往下搜索

- ```
  $(&quot;p&quot;)
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">,</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br></pre></td></tr></table></figure>
  $(&quot;div&quot;)
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">,</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br></pre></td></tr></table></figure>
  $(&quot;input&quot;)
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  - 标签选择器性能也不错，它是性能优化的第二选择。因为`jQuery`将直接调用本地方法`document.getElementsByTagName()`来定位`DOM`元素</span><br><span class="line"></span><br><span class="line">- ```</span><br><span class="line">  $(&quot;.class&quot;)</span><br></pre></td></tr></table></figure>

  - 建议有选择性的使用

- ```
  $(&quot;[attribute=value]&quot;)
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  - 对这个利用属性定位`DOM`元素，本地`JavaScript`并没有直接实现。这种方式性能并不是很理想。建议避免使用。</span><br><span class="line"></span><br><span class="line">- ```</span><br><span class="line">  $(&quot;:hidden&quot;)</span><br></pre></td></tr></table></figure>

  - 和上面利用属性定位`DOM`方式类似，建议尽量不要使用

- 注意的地方

  - 尽量使用`ID`选择器
  - 尽量给选择器指定上下文
</code></pre>
<ul>
<li><p>缓存对象</p>
<ul>
<li>如果你需要在其他函数中使用<code>jQuery</code>对象，你可以把他们缓存在全局环境中</li>
</ul>
</li>
<li><p>数组方式使用<code>jQuery</code>对象</p>
<ul>
<li>使用<code>jQuery</code>选择器获取的结果是一个<code>jQuery</code>对象。在性能方面，建议使用<code>for</code>或<code>while</code>循环来处理，而不是<code>$.each()</code></li>
</ul>
</li>
<li><p>事件代理</p>
<ul>
<li><p>每一个</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JavaScript</span><br></pre></td></tr></table></figure>

<p>事件（如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">click</span><br></pre></td></tr></table></figure>

<p>、</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mouseove</span><br></pre></td></tr></table></figure>

<p>r）都会冒泡到父级节点。当我们需要给多个元素调用同个函数时这点很有用。比如，我们要为一个表单绑定这样的行为：点击td后，把背景颜色设置为红色</p>
<ul>
<li><p><code>$(&quot;#myTable td&quot;).click(function()&#123;$(this).css(&quot;background&quot;,&quot;red&quot;);&#125;);</code></p>
</li>
<li><p>假设有<code>100</code>个<code>td</code>元素，在使用以上的方式时，绑定了<code>100</code>个事件，将带来性能影响</p>
</li>
<li><p>代替这种多元素的事件监听方法是，你只需向他们的父节点绑定一次事件，然后通过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">event.target</span><br></pre></td></tr></table></figure>

<p>获取到点击的当前元素</p>
<ul>
<li><code>$(&quot;#myTable td&quot;).click(function(&#123;$(e.target).css(&quot;background&quot;,&quot;red&quot;)&#125;);</code></li>
<li><code>e.target</code>捕捉到触发的目标</li>
</ul>
</li>
<li><p>在</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jQuery1.7</span><br></pre></td></tr></table></figure>

<p>中提供了一个新的方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">on()</span><br></pre></td></tr></table></figure>

<p>，来帮助你将整个事件监听封装到一个便利的方法中</p>
<ul>
<li><code>$(&quot;#myTable td&quot;).on(&quot;click&quot;,&#39;td&#39;,function()&#123;$(this).css(&quot;background&quot;,&quot;red&quot;);&#125;);</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>将你的代码转化成jQuery插件</p>
<ul>
<li>它能够使你的代码有更好的重用性，并且能够有效的帮助你组织代码</li>
</ul>
</li>
<li><p><strong>使用join()方法来拼接字符串</strong></p>
<ul>
<li>也许你之前使用<code>+</code>来拼接字符串，现在可以改了。它确实有助于性能优化，尤其是长字符串处理的时候</li>
</ul>
</li>
<li><p><strong>合理使用HTML5和Data属性</strong></p>
<ul>
<li>```<br>HTML5<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">的</span><br><span class="line"></span><br></pre></td></tr></table></figure>
data<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">属性可以帮助我们插入数据，特别是后端的数据交换。</span><br><span class="line"></span><br></pre></td></tr></table></figure>
jQuery<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">的</span><br><span class="line"></span><br></pre></td></tr></table></figure>
Data()<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">方法有效利用</span><br><span class="line"></span><br></pre></td></tr></table></figure>
HTML5<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">      的属性</span><br><span class="line"></span><br><span class="line">      - 例如：``</span><br><span class="line">      - 为了读取数据，你需要使用如下代码</span><br><span class="line">        - `$(&quot;#dl&#x27;).data(&quot;role&#x27;;//page)`</span><br><span class="line">        - `$(&quot;#dl&#x27;).data(&quot;lastValue&#x27;;//43)`</span><br><span class="line">        - `$(&quot;#dl&#x27;).data(&quot;options&#x27;;//john)`</span><br><span class="line"></span><br><span class="line">  - **尽量使用原生的JavaScript方法**</span><br><span class="line"></span><br><span class="line">  - 压缩JavaScript代码</span><br><span class="line"></span><br><span class="line">    - 一方面使用`Gzip`；另一方面去除`JavaScript`文件里面的注释、空白</span><br><span class="line"></span><br><span class="line">#### 附录三 常用的jQuery代码片段</span><br><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line">- 禁用页面的右键菜单</span><br><span class="line"></span><br></pre></td></tr></table></figure>
$(document).ready(functuion(){<br>$(document).bind(“contextmenu”,function(e){<br>  return false;<br>});<br>});<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 新窗口打开页面</span><br><span class="line"></span><br></pre></td></tr></table></figure>
$(document).ready(function(){<br>//例子1：href=”http://“的链接将会在新窗口打开链接<br>$(‘a[href=^=”http://“]’).attr(“target”,”_blank”);</li>
</ul>
</li>
</ul>
<p>  //例子2：rel=”external”的超链接将会在新窗口打开链接<br>    $(“a[rel$=’external’]”).click(function(){<br>      this.target = “_blank”;<br>    });<br>});<br>//use<br><a target="_blank" href="http://baidu.com" rel="external noopener">open</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 判断浏览器类型</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>$(document).reday(function(){<br>    //Firefox2 and above<br>    if( $.browser.mozilla &amp;&amp; $.browser.version&gt;=”1.8”){<br>      //do something<br>  }</p>
<p>  // Safari<br>  if($.browser.safari){<br>     //do something<br>  }</p>
<p>  // Chrome<br>  if($.browser.chrome){<br>     //do something<br>  }</p>
<p>  // Opera<br>  if($.browser.opera){<br>     //do something<br>  }</p>
<p>})</p>
<p>  // IE6 and blow<br>  if($.browser.msie &amp;&amp; $.browser.version&lt;=6){<br>     //do something<br>  }</p>
<p>  // anything above IE6<br>  if($.browser.msie &amp;&amp; $.browser.version &gt; 6){<br>     //do something<br>  }</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 输入框文字获取和失去焦点</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>$(document).ready(function(){<br>    $(“input.text1”).val(“Enter you search text here”);<br>    textFill($(‘input.text1’));<br>});</p>
<p>function textFill(input){//input focus text function<br>    var originvalue = input.val();<br>    input.focus(funtion(){<br>        if($.trim(input.val())== originvalue){<br>            input.val(‘ ‘);<br>        }<br>  }).blur(function(){<br>      if($.trim(input.val()) == ‘ ‘){<br>          input.val(originalvalue);<br>      }<br>  })<br>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 获取鼠标位置</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>$(document).ready(function(){<br>  $(document).mousemove(function(e){<br>      $(“#XY”).html(“X:” + e.pageX+ “| Y” + e.pageY);<br>  });<br>});</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 判断元素是否存在</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>$(document).ready(function(){<br>    if($(“#id”).length){<br>      // do some thing<br>  }<br>})</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 点击div也可以跳转</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>$(“div”).click(function(){<br>    window.location  = $(this).find(“a”).attr(“href”);<br>})</p>
<p>//use</p>
<div><a href="index.html">home</a></div>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 设置div在屏幕中央</span><br><span class="line"></span><br></pre></td></tr></table></figure>
$(document).ready(function(){
    jQuery.fn.center = function(){
        this.css("position","absolute");
        this.css("top",($(window).height() - this.lenght()) / 2 +$(window).scrollTop() + "px"); 
        this.css("left",($(window).height() - this.lenght()) / 2 +$(window).scrollLeft() + "px"); 
      return this;
  }
//use 

<p> $(“#XY”).center();<br>});</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 关闭所有动画效果</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>$(document).ready(function(){<br>    jQuery.fx.off = true;<br>});</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 检测鼠标的右键和左键</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>$(document).ready(function(){<br>    $(“#xy”).mousedown(function(e){<br>        alert(e.which);//1 = 鼠标左键  2= 鼠标中间 3 = 鼠标右键<br>  });<br>});</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 回车提交表单</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>$(document).ready(function(){<br>    $(“input”).keyup(function(e){<br>        if(e.which == “13”){<br>            alert(“回车提交”);<br>      }<br>  })<br>});</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 设置全局的Ajax参数</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>$(“#load”).ajaxStart(function(){<br>    showLoading();//显示loading<br>    disableButtons() //禁用按钮<br>})<br> $(“#load”).ajaxComplete(function(){<br>    hideLoading();//隐藏loading<br>    enableButtons();//启用按钮<br>})</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 获取选中的下拉框</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>$(“#someElement”).find(‘option:selected’);<br>$(“#someElement option:selected”);</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 切换复选框</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>var tog = false;<br>$(“button”).click(function(){<br>    $(“input[type=checkbox]’).attr(“checked”,!tog);<br>    tog = !tog;<br>});</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 个性化链接</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>$(document).ready(function(){<br>     $(“a[href$=’pdf’]”).addClass(“pdf”);<br>     $(“a[href$=’zip’]”).addClass(“zip”);<br>     $(“a[href$=’psd’]”).addClass(“psd”);<br>});</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 在一段时间后自动隐藏或关闭元素</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>setTimeOut(function(){<br>        $(“div”).fadeIn(400);<br>  },3000);</p>
<p>//而在1.4之后的版本可以用delay()来实现<br>$(“div”).slideUp(300).delay(3000).fadeIn(400);</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 使用事件代理绑定元素</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p> //为table里面的td元素绑定click事件，不管td是一直存在还是动态创建的<br> //jQuery 1.4.2之前使用这种方式<br> $(“table”).each(function(){<br>    $(“td”,this).live(“click”,function(){<br>       $(this).toggleClass(“hover”);<br>    });<br>});</p>
<p>//jquery 1.4.2使用的方式</p>
<p>$(“table”).delegate(“td”,”click”,function(){<br>    $(this).toggleClass(“hover”);<br>});</p>
<p>//jQuery1.7.1使用的方式<br>$(“table”).on(“click”,”td”,function(){<br>    $(this).toggleClass(“hover”);<br> })</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 预加载图片</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>(function($) {<br>  var cache = [];<br>  // Arguments are image paths relative to the current page.<br>  $.preLoadImages = function() {<br>    var args_len = arguments.length;<br>    for (var i = args_len; i–;) {<br>      var cacheImage = document.createElement(‘img’);<br>      cacheImage.src = arguments[i];<br>      cache.push(cacheImage);<br>    }<br>  }<br>jQuery.preLoadImages(“image1.gif”, “/path/to/image2.png”);</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 让页面中的每个元素都适合在移动设备上展示</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>var scr = document.createElement(‘script’);<br>scr.setAttribute(‘src’, ‘<a target="_blank" rel="noopener" href="https://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js&#39;">https://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js&#39;</a>);<br>document.body.appendChild(scr);<br>scr.onload = function(){<br>    $(‘div’).attr(‘class’, ‘’).attr(‘id’, ‘’).css({<br>        ‘margin’ : 0,<br>        ‘padding’ : 0,<br>        ‘width’: ‘100%’,<br>        ‘clear’:’both’<br>    });<br>};</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 图像等比例缩放</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>$(window).bind(“load”, function() {<br>    // IMAGE RESIZE<br>    $(‘#product_cat_list img’).each(function() {<br>        var maxWidth = 120;<br>        var maxHeight = 120;<br>        var ratio = 0;<br>        var width = $(this).width();<br>        var height = $(this).height();<br>        if(width &gt; maxWidth){<br>            ratio = maxWidth / width;<br>            $(this).css(“width”, maxWidth);<br>            $(this).css(“height”, height * ratio);<br>            height = height * ratio;<br>        }<br>        var width = $(this).width();<br>        var height = $(this).height();<br>        if(height &gt; maxHeight){<br>            ratio = maxHeight / height;<br>            $(this).css(“height”, maxHeight);<br>            $(this).css(“width”, width * ratio);<br>            width = width * ratio;<br>        }<br>    });<br>    //$(“#contentpage img”).show();<br>    // IMAGE RESIZE<br>});</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 返回页面顶部</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>// Back To Top<br>$(document).ready(function(){<br>  $(‘.top’).click(function() {<br>     $(document).scrollTo(0,500);<br>  });<br>});<br>//Create a link defined with the class .top<br><a href="#" class="top">Back To Top</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 使用jQuery打造手风琴式的折叠效果</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>var accordion = {<br>     init: function(){<br>           var $container = $(‘#accordion’);<br>           $container.find(‘li:not(:first) .details’).hide();<br>           $container.find(‘li:first’).addClass(‘active’);<br>           $container.on(‘click’,’li a’,function(e){<br>                  e.preventDefault();<br>                  var $this = $(this).parents(‘li’);<br>                  if($this.hasClass(‘active’)){<br>                         if($(‘.details’).is(‘:visible’)) {<br>                                $this.find(‘.details’).slideUp();<br>                         } else {<br>                                $this.find(‘.details’).slideDown();<br>                         }<br>                  } else {<br>                         $container.find(‘li.active .details’).slideUp();<br>                         $container.find(‘li’).removeClass(‘active’);<br>                         $this.addClass(‘active’);<br>                         $this.find(‘.details’).slideDown();<br>                  }<br>           });<br>     }<br>};</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 使用jQuery和Ajax自动填充选择框</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>$(function(){<br>$(“select#ctlJob”).change(function(){<br>$.getJSON(“/select.php”,{id: $(this).val(), ajax: ‘true’}, function(j){<br>var options = ‘’;<br>for (var i = 0; i &lt; j.length; i++) {<br>options += ‘<br>‘ + j[i].optionDisplay + ‘<br>‘;<br>}<br>$(“select#ctlPerson”).html(options);<br>})<br>})<br>})</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 自动替换丢失的图片</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>// Safe Snippet<br>$(“img”).error(function () {<br>    $(this).unbind(“error”).attr(“src”, “missing_image.gif”);<br>});<br>// Persistent Snipper<br>$(“img”).error(function () {<br>    $(this).attr(“src”, “missing_image.gif”);<br>});</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 预防对表单进行多次提交</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>$(document).ready(function() {<br>  $(‘form’).submit(function() {<br>    if(typeof jQuery.data(this, “disabledOnSubmit”) == ‘undefined’) {<br>      jQuery.data(this, “disabledOnSubmit”, { submited: true });<br>      $(‘input[type=submit], input[type=button]’, this).each(function() {<br>        $(this).attr(“disabled”, “disabled”);<br>      });<br>      return true;<br>    }<br>    else<br>    {<br>      return false;<br>    }<br>  });<br>});</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 动态添加表单元素</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>//change event on password1 field to prompt new input<br>$(‘#password1’).change(function() {<br>        //dynamically create new input and insert after password1<br>        $(“#password1”).append(“”);<br>});</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 在窗口滚动时自动加载内容</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>var loading = false;<br>$(window).scroll(function(){<br>    if((($(window).scrollTop()+$(window).height())+250)&gt;=$(document).height()){<br>        if(loading == false){<br>            loading = true;<br>            $(‘#loadingbar’).css(“display”,”block”);<br>            $.get(“load.php?start=”+$(‘#loaded_max’).val(), function(loaded){<br>                $(‘body’).append(loaded);<br>                $(‘#loaded_max’).val(parseInt($(‘#loaded_max’).val())+50);<br>                $(‘#loadingbar’).css(“display”,”none”);<br>                loading = false;<br>            });<br>        }<br>    }<br>});<br>$(document).ready(function() {<br>    $(‘#loaded_max’).val(50);<br>});</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 导航菜单背景切换效果</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul id='nav'> 
    <li>导航一</li> 
    <li>导航二</li> 
    <li>导航三</li>
</ul>

<p>//注意：代码需要修饰完善</p>
<p>$(‘#nav’).click(function(e) {<br> // 要知道siblings的使用          </p>
<p>$(e.target).addClass(‘tclass’).siblings(‘.tclass’).removeClass(‘tclass’);;</p>
<p> });</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 解决`jQuery`, `prototype`共存，`$`全局变量冲突问题</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<script src="prototype.js"></script>
<script src="http://blogbeta.blueidea.com/jquery.js"></script>
<script type="text/javascript"> jQuery.noConflict();</script> 

<p>注意：一定要先引入prototype.js 再引入jquery.js，先后顺序不可错</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- jQuery 判断元素上是否绑定了事件</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>//jQuery event封装支持判断元素上是否绑定了事件，此方法只适用于jQuery绑定的事件<br>var $events = $(“#foo”).data(“events”);<br>if( $events &amp;&amp; $events[“click”] ){　　<br>    //your code<br>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 如何正确地使用`toggleClass`</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>//切换（toggle）类允许你根据某个类的//是否存在来添加或是删除该类。<br>//这种情况下有些开发者使用：<br>a.hasClass(‘blueButton’) ? a.removeClass(‘blueButton’) : a.addClass(‘blueButton’);<br>//toggleClass允许你使用下面的语句来很容易地做到这一点<br>a.toggleClass(‘blueButton’);</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 如何设置IE特有的功能</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>if ($.browser.msie) {<br>    // Internet Explorer就是个虐待狂<br>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 如何验证某个元素是否为空</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>// 方法一<br>if (! $(‘#keks’).html()) {<br>    //什么都没有找到;<br>}<br>// 方法二<br>if ($(‘#keks’).is(“:empty”)) {<br>    //什么都没有找到;<br>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 访问IFrame里的元素</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>var iFrameDOM = $(“iframe#someID”).contents();<br>//然后，就可以通过find方法来遍历获取iFrame中的元素了<br>iFrameDOM.find(“.message”).slideUp();</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 管理搜索框的值</span><br><span class="line">  - 现在各大网站都有搜索框，而搜索框通常都有默认值，当输入框获取焦点时，默认值消失。而一旦输入框失去焦点，而输入框里又没有输入新的值，输入框里的值又会恢复成默认值，如果往输入框里输入了新值，则输入框的值为新输入的值。这种特效用`JQuery`</span><br><span class="line">    很容易实现</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>$(“#searchbox”) .focus(function(){<br>      $(this).val(‘’)<br>}) .blur(function(){<br>     var $this = $(this);<br>    // ‘请搜索…’为搜索框默认值<br>    ($this.val() === ‘’)? $this.val(‘请搜索…’) : null;<br>});</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 部分页面加载更新</span><br><span class="line">  - 为了提高`web`性能，有更新时我们通常不会加载整个页面，而只是仅仅更新部分页面内容，如图片的延迟加载等。页面部分刷新的特效在`JQuery`中也很容易实现</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>setInterval(function() {<br>//每隔5秒钟刷新页面内容 //获取的内容将增加到 id为content的元素后 </p>
<p>$(“#content”).load(url); }, 5000);</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 采配置JQuery与其它库的兼容性</span><br><span class="line">  - 如果在项目中使用`JQuery`，`$` 是最常用的变量名，但`JQuery`并不是唯一一个使用`$`作为变量名的库，为了避免命名冲突，你可以按照下面方式来组织你的代码</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>//方法一： 为JQuery重新命名为<br> $jvar $j = jQuery.noConflict();$j(‘#id’)…. //</p>
<p>方法二： 推荐使用的方式</p>
<p>(function($){ $(document).ready(function(){<br>     //这儿，你可以正常的使用JQuery语法 });<br>})(jQuery);</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 测试密码的强度</span><br><span class="line">  - 在某些网站注册时常常会要求设置密码，网站也会根据输入密码的字符特点给出相应的提示，如密码过短、强度差、强度中等、强度强等。这又是怎么实现的呢？看下面代码：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><input type="password" name="pass" id="pass" /> <span id="passstrength"></span><br>//下面的正则表达式建议各位收藏哦，项目上有可能会用得着<br>$(‘#pass’).keyup(function(e) { </p>
<p>//密码为八位及以上并且字母数字特殊字符三项都包括<br>var strongRegex = new RegExp(“^(?=.{8,})(?=.<em>[A-Z])(?=.</em>[a-z])(?=.*[0-9])(?=.<em>\W).</em>$”, “g”); </p>
<p>//密码为七位及以上并且字母、数字、特殊字符三项中有两项，强度是中等<br> var mediumRegex = new RegExp(“^(?=.{7,})(((?=.<em>[A-Z])(?=.</em>[a-z]))|((?=.<em>[A-Z])(?=.</em>[0-9]))|((?=.<em>[a-z])(?=.</em>[0-9]))).<em>$”, “g”);<br>var enoughRegex = new RegExp(“(?=.{6,}).</em>“, “g”); </p>
<p>if (false == enoughRegex.test($(this).val())) { </p>
<p>$(‘#passstrength’).html(‘More Characters’); }<br> else if (strongRegex.test($(this).val())) {<br>     $(‘#passstrength’).className = ‘ok’;<br>     $(‘#passstrength’).html(‘Strong!’); }<br>else if (mediumRegex.test($(this).val())) {<br>    $(‘#passstrength’).className = ‘alert’;<br>    $(‘#passstrength’).html(‘Medium!’); }<br> else {<br>    $(‘#passstrength’).className = ‘error’;<br>    $(‘#passstrength’).html(‘Weak!’);<br>}<br>return true;</p>
<p>});</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 附录四 常见CND加速服务</span><br><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line">- [Bootstrap中文网开源项目免费 CDN 服务](http://www.bootcdn.cn/)</span><br><span class="line">- [百度静态资源公共库](http://cdn.code.baidu.com/)</span><br><span class="line">- [360网站卫士常用前端公共库CDN服务–已停止服务](http://libs.useso.com/)</span><br><span class="line">- [开放静态文件 CDN](http://staticfile.org/)</span><br><span class="line">- [微软CDN服务](http://www.asp.net/ajax/cdn)</span><br><span class="line">- [阿里云](https://bbs.aliyun.com/read/139395.html)</span><br><span class="line">- [百度开放云平台](http://developer.baidu.com/wiki/index.php?title=docs/cplat/libs)</span><br><span class="line">- [jQuery CDN](http://code.jquery.com/)</span><br><span class="line">- [jQuery cdn加速](http://www.jq22.com/cdn/)</span><br><span class="line">- [新浪CDN](http://lib.sinaapp.com/)</span><br><span class="line"></span><br><span class="line">#### 附录五 jQuery的一些资源</span><br><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line">- 速查手册</span><br><span class="line"></span><br><span class="line">  - [jQuery API 中文文档–css88](http://www.css88.com/jqapi-1.9/)</span><br><span class="line">  - [jQuery-overapi](http://overapi.com/jquery)</span><br><span class="line">  - [在线桌面版API](http://www.sxt.cn/searchsxt/sxtapipro/index.html)</span><br><span class="line">  - [更多详情—一份实用的API参考手册集合](https://github.com/poetries/mywiki/blob/master/bookmark/实用参考手册API.md)</span><br><span class="line"></span><br><span class="line">- ```</span><br><span class="line">  jQuery</span><br></pre></td></tr></table></figure>

<p>  插件</p>
<ul>
<li>基础常用<ul>
<li><a target="_blank" rel="noopener" href="http://caibaojian.com/scrollfix">滚动固定在某个位置</a></li>
<li><a target="_blank" rel="noopener" href="http://caibaojian.com/power-slider">jQuery图片滚动插件全能版</a></li>
<li><a target="_blank" rel="noopener" href="http://code.ciaoca.com/jquery/wookmark/?utm_source=caibaojian.com">jQuery Wookmark Load 瀑布流布局</a></li>
<li><a target="_blank" rel="noopener" href="http://code.ciaoca.com/jquery/jcrop/?utm_source=caibaojian.com">jQuery Jcrop 图像裁剪</a></li>
<li><a target="_blank" rel="noopener" href="http://code.ciaoca.com/jquery/kxbdmarquee/?utm_source=caibaojian.com">jQuery kxbdMarquee 无缝滚动</a></li>
<li><a target="_blank" rel="noopener" href="http://code.ciaoca.com/jquery/lightbox/?utm_source=caibaojian.com">jQuery lightBox 灯箱效果</a></li>
<li><a target="_blank" rel="noopener" href="http://www.appelsiini.net/projects/lazyload?utm_source=caibaojian.com">Lazy Load Plugin for jQuery</a></li>
</ul>
</li>
<li>更多插件-动效库整理<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/poetries/mywiki/blob/master/bookmark/%E6%8F%92%E4%BB%B6%E5%BA%93.md">插件动效库</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/poetries/mywiki/blob/master/bookmark/%E5%B8%B8%E7%94%A8%E7%BB%84%E4%BB%B6.md">常用组件</a></li>
</ul>
</li>
</ul>
<h4 id="扩展阅读"><a href="#扩展阅读" class="headerlink" title="扩展阅读"></a>扩展阅读</h4><hr>
<ul>
<li><a target="_blank" rel="noopener" href="http://www.cnblogs.com/aaronjs/p/3279314.html">jQuery源码分析系列</a></li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/03/06/React-setstate%E5%8E%9F%E7%90%86/">React-setState原理</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-03-06</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E5%8E%9F%E7%90%86/">原理</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E5%8E%9F%E7%90%86/React/">React</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/React/">React</a></span><div class="content"><h2 id="一、setState异步更新"><a href="#一、setState异步更新" class="headerlink" title="一、setState异步更新"></a>一、setState异步更新</h2><ul>
<li><p>我们都知道，<code>React</code>通过<code>this.state</code>来访问<code>state</code>，通过<code>this.setState()</code>方法来更新<code>state</code>。当<code>this.setState()</code>方法被调用的时候，<code>React</code>会重新调用<code>render</code>方法来重新渲染<code>UI</code></p>
</li>
<li><p>首先如果直接在<code>setState</code>后面获取<code>state</code>的值是获取不到的。在<code>React</code>内部机制能检测到的地方， <code>setState</code>就是异步的；<code>在React</code>检测不到的地方，例如<code>setInterval</code>,<code>setTimeout</code>，<code>setState</code>就是同步更新的</p>
</li>
<li><p>其实 React 中<code>setState</code>本身执行的过程和代码是同步的，只是因为 React <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E6%A1%86%E6%9E%B6&spm=1001.2101.3001.7020">框架</a>本身的性能优化机制而导致的。React 中<strong>合成事件</strong>和<strong>生命周期函数</strong>的调用顺序在更新之前，导致在<strong>合成事件</strong>和<strong>生命周期函数</strong>中无法立刻得到更新后的值，形成了<strong>异步</strong>的形式。</p>
</li>
<li><p>假如在一个合成事件中，循环调用了setState方法n次，如果 React 没有优化，当前组件就要被渲染n次，这对性能来说是很大的浪费。所以，React 为了性能原因，对调用多次setState方法合并为一个来执行。当执行setState的时候，state中的数据并不会马上更新。</p>
</li>
<li><p>前面已经说到，在 React 的合成事件和生命周期函数中直接调用setState，会表现出异步的形式。</p>
</li>
<li><p>除此之外，如果越过 React 的性能优化机制，在原生事件、setTimeout中使用setState，就会表现出同步的形式。</p>
</li>
</ul>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/431.png" alt="img"></p>
<blockquote>
<p>因为<code>setState</code>是可以接受两个参数的，一个<code>state</code>，一个回调函数。因此我们可以在回调函数里面获取值</p>
</blockquote>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/432.png" alt="img"></p>
<ul>
<li><p><code>setState</code>方法通过一个队列机制实现<code>state</code>更新，当执行<code>setState</code>的时候，会将需要更新的<code>state</code>合并之后放入状态队列，而不会立即更新<code>this.state</code></p>
</li>
<li><p>如果我们不使用<code>setState</code>而是使用<code>this.state.key</code>来修改，将不会触发组件的<code>re-render</code>。</p>
</li>
<li><p>如果将<code>this.state</code>赋值给一个新的对象引用，那么其他不在对象上的<code>state</code>将不会被放入状态队列中，当下次调用<code>setState</code>并对状态队列进行合并时，直接造成了<code>state</code>丢失</p>
</li>
</ul>
<h3 id="异步：react合成事件-声明周期函数"><a href="#异步：react合成事件-声明周期函数" class="headerlink" title="异步：react合成事件 声明周期函数"></a>异步：react合成事件 声明周期函数</h3><p>在 React 中直接使用的事件，如<code>onChange</code>、<code>onClick</code>等，都是由 React 封装后的事件，是合成事件，由 React 管理。那么由于性能优化的机制，在合成事件中直接调用<code>setState</code>，将表现出<strong>异步</strong>的形式。</p>
<p>生命周期函数也是由 React 所管理，在生命周期函数中直接调用<code>setState</code>，也会表现出<strong>异步</strong>的形式。</p>
<h3 id="同步：原生事件setTimeout"><a href="#同步：原生事件setTimeout" class="headerlink" title="同步：原生事件setTimeout"></a>同步：原生事件setTimeout</h3><p><code>setState</code>本身执行的过程是同步的，使用原生事件，绕过 React 的管理，将表现出<strong>同步</strong>的形式。</p>
<p>在生命周期componentDidMount函数中写了一个定时器setTimeout，在setTimeout内部将state中的count加1，并在此之后打印count的值，结果会打印最新的count值1。</p>
<p>setState虽然也是写在生命周期componentDidMount函数中的，但并不是直接写在componentDidMount里，而是套了一层setTimeout。这样，setState就表现出同步的形式。</p>
<h3 id="1-1-setState批量更新的过程"><a href="#1-1-setState批量更新的过程" class="headerlink" title="1.1 setState批量更新的过程"></a>1.1 setState批量更新的过程</h3><blockquote>
<p>在<code>react</code>生命周期和合成事件执行前后都有相应的钩子，分别是<code>pre</code>钩子和<code>post</code>钩子，<code>pre</code>钩子会调用<code>batchedUpdate</code>方法将<code>isBatchingUpdates</code>变量置为<code>true</code>，开启批量更新，而<code>post</code>钩子会将<code>isBatchingUpdates</code>置为<code>false</code></p>
</blockquote>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/433.png" alt="img"></p>
<ul>
<li><code>isBatchingUpdates</code>变量置为<code>true</code>，则会走批量更新分支，<code>setState</code>的更新会被存入队列中，待同步代码执行完后，再执行队列中的<code>state</code>更新。 <code>isBatchingUpdates</code>为 <code>true</code>，则把当前组件（即调用了 <code>setState</code>的组件）放入 <code>dirtyComponents</code> 数组中；否则 <code>batchUpdate</code> 所有队列中的更新</li>
<li>而在原生事件和异步操作中，不会执行<code>pre</code>钩子，或者生命周期的中的异步操作之前执行了<code>pre</code>钩子，但是<code>pos</code>钩子也在异步操作之前执行完了，<code>isBatchingUpdates</code>必定为<code>false</code>，也就不会进行批量更新</li>
</ul>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/434.png" alt="img"></p>
<blockquote>
<p><code>enqueueUpdate</code>包含了<code>React</code>避免重复<code>render</code>的逻辑。<code>mountComponent</code>和<code>updateComponent</code>方法在执行的最开始，会调用到<code>batchedUpdates</code>进行批处理更新，此时会将<code>isBatchingUpdates</code>设置为<code>true</code>，也就是将状态标记为现在正处于更新阶段了。 <code>isBatchingUpdates</code>为 <code>true</code>，则把当前组件（即调用了 <code>setState</code> 的组件）放入<code>dirtyComponents</code>数组中；否则 <code>batchUpdate</code> 所有队列中的更新</p>
</blockquote>
<h3 id="1-2-为什么直接修改this-state无效"><a href="#1-2-为什么直接修改this-state无效" class="headerlink" title="1.2 为什么直接修改this.state无效"></a>1.2 为什么直接修改this.state无效</h3><ul>
<li>要知道<code>setState</code>本质是通过一个队列机制实现<code>state</code>更新的。 执行<code>setState</code>时，会将需要更新的state合并后放入状态队列，而不会立刻更新<code>state</code>，队列机制可以批量更新<code>state</code>。</li>
<li>如果不通过<code>setState</code>而直接修改<code>this.state</code>，那么这个<code>state</code>不会放入状态队列中，下次调用<code>setState</code>时对状态队列进行合并时，会忽略之前直接被修改的<code>state</code>，这样我们就无法合并了，而且实际也没有把你想要的<code>state</code>更新上去</li>
</ul>
<h3 id="1-3-什么是批量更新-Batch-Update"><a href="#1-3-什么是批量更新-Batch-Update" class="headerlink" title="1.3 什么是批量更新 Batch Update"></a>1.3 什么是批量更新 Batch Update</h3><blockquote>
<p>在一些<code>mv*</code>框架中，，就是将一段时间内对<code>model</code>的修改批量更新到<code>view</code>的机制。比如那前端比较火的<code>React</code>、<code>vue</code>（<code>nextTick</code>机制,视图的更新以及实现）</p>
</blockquote>
<h3 id="1-4-setState之后发生的事情"><a href="#1-4-setState之后发生的事情" class="headerlink" title="1.4 setState之后发生的事情"></a>1.4 setState之后发生的事情</h3><ul>
<li><code>setState</code>操作并不保证是同步的，也可以认为是异步的</li>
<li><code>React</code>在<code>setState</code>之后，会经对<code>state</code>进行<code>diff</code>，判断是否有改变，然后去<code>diff dom</code>决定是否要更新<code>UI</code>。如果这一系列过程立刻发生在每一个<code>setState</code>之后，就可能会有性能问题</li>
<li>在短时间内频繁<code>setState</code>。<code>React</code>会将<code>state</code>的改变压入栈中，在合适的时机，批量更新<code>state</code>和视图，达到提高性能的效果</li>
</ul>
<h3 id="1-5-如何知道state已经被更新"><a href="#1-5-如何知道state已经被更新" class="headerlink" title="1.5 如何知道state已经被更新"></a>1.5 如何知道state已经被更新</h3><blockquote>
<p>传入回调函数</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">setState(&#123;</span><br><span class="line">    index: 1</span><br><span class="line">&#125;&#125;, function()&#123;</span><br><span class="line">    console.log(this.state.index);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在钩子函数中体现</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">componentDidUpdate()&#123;</span><br><span class="line">    console.log(this.state.index);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-6-如何知道state已经被更新"><a href="#1-6-如何知道state已经被更新" class="headerlink" title="1.6 如何知道state已经被更新"></a>1.6 如何知道state已经被更新</h3><h2 id="二、setState循环调用风险"><a href="#二、setState循环调用风险" class="headerlink" title="二、setState循环调用风险"></a>二、setState循环调用风险</h2><ul>
<li>当调用<code>setState</code>时，实际上会执行<code>enqueueSetState</code>方法，并对<code>partialState</code>以及<code>_pending-StateQueue</code>更新队列进行合并操作，最终通过<code>enqueueUpdate</code>执行<code>state</code>更新</li>
<li>而<code>performUpdateIfNecessary</code>方法会获<code>取_pendingElement</code>,<code>_pendingStateQueue</code>，<code>_pending-ForceUpdate</code>，并调用<code>receiveComponent</code>和<code>updateComponent</code>方法进行组件更新</li>
<li>如果在<code>shouldComponentUpdate</code>或者<code>componentWillUpdate</code>方法中调用<code>setState</code>，此时<code>this._pending-StateQueue != null</code>，就会造成循环调用，使得浏览器内存占满后崩溃</li>
</ul>
<h2 id="三、事务"><a href="#三、事务" class="headerlink" title="三、事务"></a>三、事务</h2><ul>
<li>事务就是将需要执行的方法使用<code>wrapper</code>封装起来，再通过事务提供的<code>perform</code>方法执行，先执行<code>wrapper</code>中的<code>initialize</code>方法，执行完<code>perform</code>之后，在执行所有的<code>close</code>方法，一组<code>initialize</code>及<code>close</code>方法称为一个<code>wrapper</code>。</li>
<li>那么事务和<code>setState</code>方法的不同表现有什么关系，首先我们把<code>4</code>次<code>setStat</code>e简单归类，前两次属于一类，因为它们在同一调用栈中执行，<code>setTimeout</code>中的两次<code>setState</code>属于另一类</li>
<li>在<code>setState</code>调用之前，已经处在<code>batchedUpdates</code>执行的事务中了。那么这次<code>batchedUpdates</code>方法是谁调用的呢，原来是<code>ReactMount.js</code>中的<code>_renderNewRootComponent</code>方法。也就是说，整个将<code>React</code>组件渲染到<code>DOM</code>中的过程就是处于一个大的事务中。而在<code>componentDidMount</code>中调用<code>setState</code>时，<code>batchingStrategy</code>的<code>isBatchingUpdates</code>已经被设为了<code>true</code>，所以两次<code>setState</code>的结果没有立即生效</li>
<li>再反观<code>setTimeout</code>中的两次<code>setState</code>，因为没有前置的<code>batchedUpdates</code>调用，所以导致了新的<code>state</code>马上生效</li>
</ul>
<h2 id="四、总结"><a href="#四、总结" class="headerlink" title="四、总结"></a>四、总结</h2><ul>
<li>通过<code>setState</code>去更新<code>this.state</code>，不要直接操作<code>this.state</code>，请把它当成不可变的</li>
<li>调用<code>setState</code>更新<code>this.state</code>不是马上生效的，它是异步的，所以不要天真以为执行完<code>setState</code>后<code>this.state</code>就是最新的值了</li>
<li>多个顺序执行的<code>setState</code>不是同步地一个一个执行滴，会一个一个加入队列，然后最后一起执行，即批处理</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/02/26/React-render%E7%9A%84%E5%8E%9F%E7%90%86/">React-render</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-02-26</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E6%A1%86%E6%9E%B6/">框架</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/React/">React</a></span><div class="content"><h2 id="一、原理"><a href="#一、原理" class="headerlink" title="一、原理"></a>一、原理</h2><p>首先，<code>render</code>函数在<code>react</code>中有两种形式：</p>
<p>在类组件中，指的是<code>render</code>方法：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span> Foo <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在函数组件中，指的是函数组件本身：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span> Foo <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在<code>render</code>中，我们会编写<code>jsx</code>，<code>jsx</code>通过<code>babel</code>编译后就会转化成我们熟悉的<code>js</code>格式，如下：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;cn&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Header</span>&gt;</span> hello <span class="tag">&lt;/<span class="name">Header</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span>&gt;</span> start <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    Right Reserve</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><code>babel</code>编译后：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> (</span><br><span class="line">  <span class="title class_">React</span>.<span class="title function_">createElement</span>(</span><br><span class="line">    <span class="string">&#x27;div&#x27;</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      className : <span class="string">&#x27;cn&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title class_">React</span>.<span class="title function_">createElement</span>(</span><br><span class="line">      <span class="title class_">Header</span>,</span><br><span class="line">      <span class="literal">null</span>,</span><br><span class="line">      <span class="string">&#x27;hello&#x27;</span></span><br><span class="line">    ),</span><br><span class="line">    <span class="title class_">React</span>.<span class="title function_">createElement</span>(</span><br><span class="line">      <span class="string">&#x27;div&#x27;</span>,</span><br><span class="line">      <span class="literal">null</span>,</span><br><span class="line">      <span class="string">&#x27;start&#x27;</span></span><br><span class="line">    ),</span><br><span class="line">    <span class="string">&#x27;Right Reserve&#x27;</span></span><br><span class="line">  )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>从名字上来看，<code>createElement</code>方法用来元素的</p>
<p>在<code>react</code>中，这个元素就是虚拟<code>DOM</code>树的节点，接收三个参数：</p>
<ul>
<li>type：标签</li>
<li>attributes：标签属性，若无则为null</li>
<li>children：标签的子节点</li>
</ul>
<p>这些虚拟<code>DOM</code>树最终会渲染成真实<code>DOM</code></p>
<p>在<code>render</code>过程中，<code>React</code> 将新调用的 <code>render</code>函数返回的树与旧版本的树进行比较，这一步是决定如何更新 <code>DOM</code> 的必要步骤，然后进行 <code>diff</code> 比较，更新 <code>DOM</code>树</p>
<h2 id="二、触发时机"><a href="#二、触发时机" class="headerlink" title="二、触发时机"></a>二、触发时机</h2><p><code>render</code>的执行时机主要分成了两部分：</p>
<ul>
<li>类组件调用 setState 修改状态</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  state = &#123; <span class="attr">count</span>: <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line">  increment = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; count &#125; = <span class="variable language_">this</span>.<span class="property">state</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> newCount = count &lt; <span class="number">10</span> ? count + <span class="number">1</span> : count;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; <span class="attr">count</span>: newCount &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; count &#125; = <span class="variable language_">this</span>.<span class="property">state</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Foo render&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span> &#123;count&#125; <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.increment&#125;</span>&gt;</span>Increment<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>点击按钮，则调用<code>setState</code>方法，无论<code>count</code>发生变化辩护，控制台都会输出<code>Foo render</code>，证明<code>render</code>执行了</p>
<ul>
<li>函数组件通过<code>useState hook</code>修改状态</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">increment</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> newCount = count &lt; <span class="number">10</span> ? count + <span class="number">1</span> : count;</span><br><span class="line">    <span class="title function_">setCount</span>(newCount);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Foo render&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span> &#123;count&#125; <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;increment&#125;</span>&gt;</span>Increment<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>函数组件通过<code>useState</code>这种形式更新数据，当数组的值不发生改变了，就不会触发<code>render</code></p>
<ul>
<li>类组件重新渲染</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  state = &#123; <span class="attr">name</span>: <span class="string">&quot;App&quot;</span> &#125;;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;App&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Foo</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> this.setState(&#123; name: &quot;App&quot; &#125;)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">          Change name</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Foo render&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span> Foo <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>只要点击了 <code>App</code> 组件内的 <code>Change name</code> 按钮，不管 <code>Foo</code> 具体实现是什么，都会被重新<code>render</code>渲染</p>
<ul>
<li>函数组件重新渲染</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> [name,setName] = <span class="title function_">useState</span>(<span class="string">&#x27;App&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;App&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Foo</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setName(&quot;aaa&quot;)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">                &#123; name &#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Foo render&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span> Foo <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以发现，使用<code>useState</code>来更新状态的时候，只有首次会触发<code>Foo render</code>，后面并不会导致<code>Foo render</code></p>
<h2 id="三、总结"><a href="#三、总结" class="headerlink" title="三、总结"></a>三、总结</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">render`函数里面可以编写`JSX`，转化成`createElement`这种形式，用于生成虚拟`DOM`，最终转化成真实`DOM</span><br></pre></td></tr></table></figure>

<p>在<code>React</code> 中，类组件只要执行了 <code>setState</code> 方法，就一定会触发 <code>render</code> 函数执行，函数组件使用<code>useState</code>更改状态不一定导致重新<code>render</code></p>
<p>组件的<code>props</code> 改变了，不一定触发 <code>render</code> 函数的执行，但是如果 <code>props</code> 的值来自于父组件或者祖先组件的 <code>state</code></p>
<p>在这种情况下，父组件或者祖先组件的 <code>state</code> 发生了改变，就会导致子组件的重新渲染</p>
<p>所以，一旦执行了<code>setState</code>就会执行<code>render</code>方法，<code>useState</code> 会判断当前值有无发生改变确定是否执行<code>render</code>方法，一旦父组件发生渲染，子组件也会渲染</p>
<p><img src="https://static.vue-js.com/229784b0-ecf5-11eb-ab90-d9ae814b240d.png" alt="img"></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/02/14/React-Redux-%E9%85%8D%E7%BD%AETs/">React-Redux总结-配置Ts</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-02-14</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E6%A1%86%E6%9E%B6/">框架</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/React/">React</a></span><div class="content"><h1 id="第二部分-结合React实践"><a href="#第二部分-结合React实践" class="headerlink" title="第二部分 结合React实践"></a>第二部分 结合React实践</h1><h2 id="一、环境配置"><a href="#一、环境配置" class="headerlink" title="一、环境配置"></a>一、环境配置</h2><h3 id="1-1-初始化项目"><a href="#1-1-初始化项目" class="headerlink" title="1.1 初始化项目"></a>1.1 初始化项目</h3><ul>
<li>生成一个目录<code>ts_react_demo</code>，输入<code>npm init -y</code>初始化项目</li>
<li>然后在项目里我们需要一个<code>.gitignore</code>来忽略指定目录不传到<code>git</code>上</li>
<li>进入<code>.gitignore</code>输入我们需要忽略的目录，一般是<code>node_modules</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// .gitignore</span><br><span class="line">node_modules</span><br></pre></td></tr></table></figure>

<h3 id="1-2-安装依赖"><a href="#1-2-安装依赖" class="headerlink" title="1.2 安装依赖"></a>1.2 安装依赖</h3><blockquote>
<p>接下来我们准备下载相应的依赖包，这里需要了解一个概念，就是类型定义文件</p>
</blockquote>
<h4 id="1-2-1-类型定义文件"><a href="#1-2-1-类型定义文件" class="headerlink" title="1.2.1 类型定义文件"></a>1.2.1 类型定义文件</h4><blockquote>
<p>因为目前主流的第三方库都是以<code>javascript</code>编写的，如果用<code>typescript</code>开发，会导致在编译的时候会出现很多找不到类型的提示，那么如果让这些库也能在<code>ts</code>中使用呢？</p>
</blockquote>
<ul>
<li>类型定义文件(<code>*.d.ts</code>)就是能够让编辑器或者插件来检测到第三方库中<code>js</code>的静态类型，这个文件是以<code>.d.ts</code>结尾- 比如说<code>react</code>的类型定义文件：<a target="_blank" rel="noopener" href="https://github.com/DefinitelyTyped/DefinitelyTyped/tree/master/types/react">https://github.com/DefinitelyTyped/DefinitelyTyped/tree/master/types/react</a></li>
<li>在<code>typescript2.0</code>中，是使用<code>@type</code>来进行类型定义，当我们使用<code>@type</code>进行类型定义，<code>typescript</code>会默认查看<code>./node_modules/@types</code>文件夹，可以通过这样来安装这个库的定义库<code>npm install @types/react --save</code></li>
</ul>
<h4 id="1-2-2-相关依赖包"><a href="#1-2-2-相关依赖包" class="headerlink" title="1.2.2 相关依赖包"></a>1.2.2 相关依赖包</h4><p><strong>React相关</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">- react // react的核心文件</span><br><span class="line">- @types/react // 声明文件</span><br><span class="line">- react-dom // react dom的操作包</span><br><span class="line">- @types/react-dom </span><br><span class="line">- react-router-dom // react路由包</span><br><span class="line">- @types/react-router-dom</span><br><span class="line">- react-redux</span><br><span class="line">- @types/react-redux</span><br><span class="line">- redux-thunk  // 中间件</span><br><span class="line">- @types/redux-logger</span><br><span class="line">- redux-logger // 中间件</span><br><span class="line">- connected-react-router</span><br><span class="line">## 执行安装依赖包</span><br><span class="line"></span><br><span class="line">npm i react react-dom @types/react @types/react-dom react-router-dom @types/react-router-dom react-redux @types/react-redux redux-thunk redux-logger @types/redux-logger connected-react-router -S</span><br></pre></td></tr></table></figure>

<p><strong>webpack相关</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- webpack // webpack的核心包</span><br><span class="line">- webpack-cli // webapck的工具包</span><br><span class="line">- webpack-dev-server // webpack的开发服务</span><br><span class="line">- html-webpack-plugin // webpack的插件，可以生成index.html文件</span><br><span class="line">npm i webpack webpack-cli webpack-dev-server html-webpack-plugin -D</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里的<code>-D</code>相当于<code>--save-dev</code>的缩写，下载开发环境的依赖包</p>
</blockquote>
<p><strong>typescript相关</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- typescript // ts的核心包</span><br><span class="line">- ts-loader // 把ts编译成指定语法比如es5 es6等的工具，有了它，基本不需要babel了，因为它会把我们的代码编译成es5</span><br><span class="line">- source-map-loader // 用于开发环境中调试ts代码</span><br><span class="line">npm i typescript ts-loader source-map-loader -D</span><br></pre></td></tr></table></figure>

<ul>
<li>从上面可以看出，基本都是模块和声明文件都是一对对出现的，有一些不是一对对出现，就是因为都集成到一起去了</li>
<li>声明文件可以在<code>node_modules/@types/xx/xx</code>中找到</li>
</ul>
<h3 id="1-3-Typescript-config配置"><a href="#1-3-Typescript-config配置" class="headerlink" title="1.3 Typescript config配置"></a>1.3 Typescript config配置</h3><blockquote>
<p>首先我们要生成一个<code>tsconfig.json</code>来告诉<code>ts-loader</code>怎样去编译这个<code>ts</code>代码</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tsc --init</span><br></pre></td></tr></table></figure>

<blockquote>
<p>会在项目中生成了一个<code>tsconfig.json</code>文件，接下来进入这个文件，来修改相关配置</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// tsconfig.json</span><br><span class="line">&#123;</span><br><span class="line">  // 编译选项</span><br><span class="line">  &quot;compilerOptions&quot;: &#123;</span><br><span class="line">    &quot;target&quot;: &quot;es5&quot;, // 编译成es5语法</span><br><span class="line">    &quot;module&quot;: &quot;commonjs&quot;, // 模块的类型</span><br><span class="line">    &quot;outDir&quot;: &quot;./dist&quot;, // 编译后的文件目录</span><br><span class="line">    &quot;sourceMap&quot;: true, // 生成sourceMap方便我们在开发过程中调试</span><br><span class="line">    &quot;noImplicitAny&quot;: true, // 每个变量都要标明类型</span><br><span class="line">    &quot;jsx&quot;: &quot;react&quot;, // jsx的版本,使用这个就不需要额外使用babel了，会编译成React.createElement</span><br><span class="line">  &#125;,</span><br><span class="line">  // 为了加快整个编译过程，我们指定相应的路径</span><br><span class="line">  &quot;include&quot;: [</span><br><span class="line">    &quot;./src/**/*&quot;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-4-webpack配置"><a href="#1-4-webpack配置" class="headerlink" title="1.4 webpack配置"></a>1.4 webpack配置</h3><blockquote>
<p>在<code>./src/</code>下创建一个<code>index.html</code>文件，并且添加``标签</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">  &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;</span><br><span class="line">  &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;div id=&#x27;app&#x27;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在<code>./</code>下创建一个<code>webpack</code>配置文件<code>webpack.config.js</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">// ./webpack.config.js</span><br><span class="line">// 引入webpack</span><br><span class="line">const webpack = require(&quot;webpack&quot;);</span><br><span class="line">// 引入webpack插件 生成index.html文件</span><br><span class="line">const HtmlWebpackPlugin = require(&quot;html-webpack-plugin&quot;);</span><br><span class="line">const path = require(&quot;path&quot;)</span><br><span class="line"></span><br><span class="line">// 把模块导出</span><br><span class="line">module.exports = &#123;</span><br><span class="line">  // 以前是jsx，因为我们用typescript写，所以这里后缀是tsx</span><br><span class="line">  entry:&quot;./src/index.tsx&quot;,</span><br><span class="line">  // 指定模式为开发模式</span><br><span class="line">  mode:&quot;development&quot;,</span><br><span class="line">  // 输出配置</span><br><span class="line">  output:&#123;</span><br><span class="line">    // 输出目录为当前目录下的dist目录</span><br><span class="line">    path:path.resolve(__dirname,&#x27;dist&#x27;),</span><br><span class="line">    // 输出文件名</span><br><span class="line">    filename:&quot;index.js&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  // 为了方便调试，还要配置一下调试工具</span><br><span class="line">  devtool:&quot;source-map&quot;,</span><br><span class="line">  // 解析路径，查找模块的时候使用</span><br><span class="line">  resolve:&#123;</span><br><span class="line">    // 一般写模块不会写后缀，在这里配置好相应的后缀，那么当我们不写后缀时，会按照这个后缀优先查找</span><br><span class="line">    extensions:[&quot;.ts&quot;,&#x27;.tsx&#x27;,&#x27;.js&#x27;,&#x27;.json&#x27;]</span><br><span class="line">  &#125;,</span><br><span class="line">  // 解析处理模块的转化</span><br><span class="line">  module:&#123;</span><br><span class="line">    // 遵循的规则</span><br><span class="line">    rules:[</span><br><span class="line">      &#123;</span><br><span class="line">        // 如果这个模块是.ts或者.tsx，则会使用ts-loader把代码转成es5</span><br><span class="line">        test:/\.tsx?$/,</span><br><span class="line">        loader:&quot;ts-loader&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        // 使用sourcemap调试</span><br><span class="line">        // enforce:pre表示这个loader要在别的loader执行前执行</span><br><span class="line">        enforce:&quot;pre&quot;,</span><br><span class="line">        test:/\.js$/,</span><br><span class="line">        loader:&quot;source-map-loader&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  // 插件的配置</span><br><span class="line">  plugins:[</span><br><span class="line">    // 这个插件是生成index.html</span><br><span class="line">    new HtmlWebpackPlugin(&#123;</span><br><span class="line">      // 以哪个文件为模板，模板路径</span><br><span class="line">      template:&quot;./src/index.html&quot;,</span><br><span class="line">      // 编译后的文件名</span><br><span class="line">      filename:&quot;index.html&quot;</span><br><span class="line">    &#125;),</span><br><span class="line">    new webpack.HotModuleReplacementPlugin()</span><br><span class="line">  ],</span><br><span class="line">  // 开发环境服务配置</span><br><span class="line">  devServer:&#123;</span><br><span class="line">    // 启动热更新,当模块、组件有变化，不会刷新整个页面，而是局部刷新</span><br><span class="line">    // 需要和插件webpack.HotModuleReplacementPlugin配合使用</span><br><span class="line">    hot:true, </span><br><span class="line">    // 静态资源目录</span><br><span class="line">    contentBase:path.resolve(__dirname,&#x27;dist&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>那么我们怎么运行这个<code>webpack.config.js</code>呢？这就需要我们在<code>package.json</code>配置一下脚本</p>
</blockquote>
<ul>
<li>在<code>package.json</code>里的<code>script</code>，添加<code>build</code>和<code>dev</code>的配置</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;ts_react_demo&quot;,</span><br><span class="line">  &quot;version&quot;: &quot;1.0.0&quot;,</span><br><span class="line">  &quot;description&quot;: &quot;&quot;,</span><br><span class="line">  &quot;main&quot;: &quot;index.js&quot;,</span><br><span class="line">  &quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;build&quot;: &quot;webpack&quot;,</span><br><span class="line">    &quot;dev&quot;:&quot;webpack-dev-server&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;keywords&quot;: [],</span><br><span class="line">  &quot;author&quot;: &quot;&quot;,</span><br><span class="line">  &quot;license&quot;: &quot;ISC&quot;,</span><br><span class="line">  &quot;dependencies&quot;: &#123;</span><br><span class="line">    &quot;@types/react&quot;: &quot;^16.7.13&quot;,</span><br><span class="line">    &quot;@types/react-dom&quot;: &quot;^16.0.11&quot;,</span><br><span class="line">    &quot;@types/react-redux&quot;: &quot;^6.0.10&quot;,</span><br><span class="line">    &quot;@types/react-router-dom&quot;: &quot;^4.3.1&quot;,</span><br><span class="line">    &quot;connected-react-router&quot;: &quot;^5.0.1&quot;,</span><br><span class="line">    &quot;react&quot;: &quot;^16.6.3&quot;,</span><br><span class="line">    &quot;react-dom&quot;: &quot;^16.6.3&quot;,</span><br><span class="line">    &quot;react-redux&quot;: &quot;^6.0.0&quot;,</span><br><span class="line">    &quot;react-router-dom&quot;: &quot;^4.3.1&quot;,</span><br><span class="line">    &quot;redux-logger&quot;: &quot;^3.0.6&quot;,</span><br><span class="line">    &quot;redux-thunk&quot;: &quot;^2.3.0&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;devDependencies&quot;: &#123;</span><br><span class="line">    &quot;html-webpack-plugin&quot;: &quot;^3.2.0&quot;,</span><br><span class="line">    &quot;source-map-loader&quot;: &quot;^0.2.4&quot;,</span><br><span class="line">    &quot;ts-loader&quot;: &quot;^5.3.1&quot;,</span><br><span class="line">    &quot;typescript&quot;: &quot;^3.2.1&quot;,</span><br><span class="line">    &quot;webpack&quot;: &quot;^4.27.1&quot;,</span><br><span class="line">    &quot;webpack-cli&quot;: &quot;^3.1.2&quot;,</span><br><span class="line">    &quot;webpack-dev-server&quot;: &quot;^3.1.10&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>因为入口文件是<code>index.tsx</code>，那么我们在<code>./src/</code>下创建一个<code>index.tsx</code>，并且在里面写入一段代码，看看<code>webpack</code>是否能够正常编译</li>
<li>因为我们在<code>webpack.config.js</code>中<code>entry</code>设置的入口文件是<code>index.tsx</code>，并且在<code>module</code>中的<code>rules</code>会识别到<code>.tsx</code>格式的文件，然后执行相应的<code>ts-loader</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// ./src/index.tsx</span><br><span class="line">console.log(&quot;hello poetries&quot;)</span><br></pre></td></tr></table></figure>

<ul>
<li>接下来我们<code>npm run build</code>一下，看看能不能正常编译</li>
<li>编译成功，我们可以看看<code>./dist/</code>下生成了<code>index.html index.js index.js.map</code>三个文件</li>
<li>那么我们在开发过程中，不会每次都<code>npm run build</code>来看修改的结果，那么我们平时开发过程中可以使用<code>npm run dev</code>。这样就启动成功了一个<code>http://localhost:8080/</code>的服务了。</li>
<li>接下来我们看看热更新是否配置正常，在<code>./src/index.tsx</code>中新增一个<code>console.log(&#39;hello poetries&#39;)</code>，我们发现浏览器的控制台会自动打印出这一个输出，说明配置正常了</li>
</ul>
<h2 id="二、React组件"><a href="#二、React组件" class="headerlink" title="二、React组件"></a>二、React组件</h2><h3 id="2-1-写一个计数器组件"><a href="#2-1-写一个计数器组件" class="headerlink" title="2.1 写一个计数器组件"></a>2.1 写一个计数器组件</h3><blockquote>
<p>首先我们在<code>./src/</code>下创建一个文件夹<code>components</code>，然后在<code>./src/components/</code>下创建文件<code>Counter.tsx</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">// ./src/components/Counter.tsx</span><br><span class="line">// import React from &quot;react&quot;; // 之前的写法</span><br><span class="line">// 在ts中引入的写法</span><br><span class="line">import * as React from &quot;react&quot;;</span><br><span class="line"></span><br><span class="line">export default class CounterComponent extends React.Component&#123;</span><br><span class="line">  // 状态state</span><br><span class="line">  state = &#123;</span><br><span class="line">    number:0</span><br><span class="line">  &#125;</span><br><span class="line">  render()&#123;</span><br><span class="line">    return(</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;p&gt;&#123;this.state.number&#125;&lt;/p&gt;</span><br><span class="line">        &lt;button onClick=&#123;()=&gt;this.setState(&#123;number:this.state.number + 1&#125;)&#125;&gt;+&lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>我们发现，其实除了引入<code>import * as React from &quot;react&quot;</code>以外，其余的和之前的写法没什么不同。</p>
</blockquote>
<ul>
<li>接下来我们到<code>./src/index.tsx</code>中把这个组件导进来</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// ./src/index.tsx</span><br><span class="line">import * as React from &quot;react&quot;;</span><br><span class="line">import * as ReactDom from &quot;react-dom&quot;;</span><br><span class="line">import CounterComponent from &quot;./components/Counter&quot;;</span><br><span class="line">// 把我们的CounterComponent组件渲染到id为app的标签内</span><br><span class="line">ReactDom.render(&lt;CounterComponent /&gt;,document.getElementById(&quot;app&quot;))</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这样我们就把这个组件引进来了，接下来我们看下是否能够成功跑起来</p>
</blockquote>
<p><img src="https://upload-images.jianshu.io/upload_images/1480597-86ad083c5149a72e.png" alt="image.png"></p>
<blockquote>
<p>到目前为止，感觉用<code>ts</code>写<code>react</code>还是跟以前差不多，没什么区别，要记住，<code>ts</code>最大的特点就是类型检查，可以检验属性的状态类型</p>
</blockquote>
<p>假设我们需要在<code>./src/index.tsx</code>中给``传一个属性<code>name</code>，而<code>CounterComponent</code>组件需要对这个传入的<code>name</code>进行类型校验，比如说只允许传字符串</p>
<ul>
<li><code>./src/index.tsx</code>中修改一下</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ReactDom.render(&lt;CounterComponent name=&quot;poetries&quot; /&gt;,document.getElementById(&quot;app&quot;))</span><br></pre></td></tr></table></figure>

<blockquote>
<p>然后需要在<code>./src/components/Counter.tsx</code>中写一个接口来对这个<code>name</code>进行类型校验</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">// import React from &quot;react&quot;; // 之前的写法</span><br><span class="line">// 在ts中引入的写法</span><br><span class="line">import * as React from &quot;react&quot;;</span><br><span class="line"></span><br><span class="line">// 写一个接口对name进行类型校验</span><br><span class="line">// 如果我们不写校验的话，在外部传name进来会报错的</span><br><span class="line">interface IProps&#123;</span><br><span class="line">    name:string,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 我们还可以用接口约束state的状态</span><br><span class="line">interface IState&#123;</span><br><span class="line">    number: number</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 把接口约束的规则写在这里</span><br><span class="line">// 如果传入的name不符合类型会报错</span><br><span class="line">// 如果state的number属性不符合类型也会报错</span><br><span class="line">export default class CounterComponent extends React.Component&lt;IProps,IState&gt;&#123;</span><br><span class="line">  // 状态state</span><br><span class="line">  state = &#123;</span><br><span class="line">    number:0</span><br><span class="line">  &#125;</span><br><span class="line">  render()&#123;</span><br><span class="line">    return(</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">        &lt;p&gt;&#123;this.state.number&#125;&lt;/p&gt;</span><br><span class="line">        &lt;p&gt;&#123;this.props.name&#125;&lt;/p&gt;</span><br><span class="line">        &lt;button onClick=&#123;()=&gt;this.setState(&#123;number:this.state.number + 1&#125;)&#125;&gt;+&lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-结合Redux使用"><a href="#2-2-结合Redux使用" class="headerlink" title="2.2 结合Redux使用"></a>2.2 结合Redux使用</h3><h4 id="2-2-1-基础使用"><a href="#2-2-1-基础使用" class="headerlink" title="2.2.1 基础使用"></a>2.2.1 基础使用</h4><ul>
<li>上面<code>state</code>中的<code>number</code>就不放在组件里了，我们放到<code>redux</code>中，接下来我们使用<code>redux</code></li>
<li>首先在<code>./src/</code>创建<code>store</code>目录，然后在<code>./src/store/</code>创建一个文件<code>index.tsx</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// .src/store/index.tsx</span><br><span class="line">import &#123; createStore &#125; from &quot;redux&quot;;</span><br><span class="line"></span><br><span class="line">// 引入reducers</span><br><span class="line">import reducers from &quot;./reducers&quot;;</span><br><span class="line"></span><br><span class="line">// 接着创建仓库</span><br><span class="line">let store = createStore(reducers);</span><br><span class="line"></span><br><span class="line">// 导出store仓库</span><br><span class="line">export default store;</span><br></pre></td></tr></table></figure>

<ul>
<li>然后我们需要创建一个<code>reducers</code>，在<code>./src/store/</code>创建一个目录<code>reducers</code>，该目录下再创建一个文件<code>index.tsx</code>。</li>
<li>但是我们还需要对<code>reducers</code>中的函数参数进行类型校验，而且这个类型校验很多地方需要复用，那么我们需要把这个类型校验单独抽离出一个文件。</li>
<li>那么我们需要在<code>./src/</code>下创建一个<code>types</code>目录，该目录下创建一个文件<code>index.tsx</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// ./src/types/index.tsx</span><br><span class="line">// 导出一个接口</span><br><span class="line">export interface Store&#123;</span><br><span class="line">  // 我们需要约束的属性和类型</span><br><span class="line">  number:number</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>回到<code>./src/store/reducers/index.tsx</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// 导入类型校验的接口</span><br><span class="line">// 用来约束state的</span><br><span class="line">import &#123; Store &#125; from &quot;../../types/index&quot;</span><br><span class="line">// 我们需要给number赋予默认值</span><br><span class="line">let initState:Store = &#123; number:0 &#125;</span><br><span class="line">// 把接口写在state:Store</span><br><span class="line">export default function (state:Store=initState,action) &#123;</span><br><span class="line">  // 拿到老的状态state和新的状态action</span><br><span class="line">  // action是一个动作行为，而这个动作行为，在计数器中是具备 加 或 减 两个功能</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>上面这段代码暂时先这样，因为需要用到<code>action</code>，我们现在去配置一下<code>action</code>相关的，首先我们在<code>./src/store</code>下创建一个<code>actions</code>目录，并且在该目录下创建文件<code>counter.tsx</code></li>
<li>因为配置<code>./src/store/actions/counter.tsx</code>会用到动作类型，而这个动作类型是属于常量，为了更加规范我们的代码，我们在<code>./src/store/</code>下创建一个<code>action-types.tsx</code>，里面写相应常量</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// ./src/store/action-types.tsx</span><br><span class="line">export const ADD = &quot;ADD&quot;;</span><br><span class="line">export const SUBTRACT = &quot;SUBTRACT&quot;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>回到<code>./src/store/actions/counter.tsx</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// ./src/store/actions/counter.tsx</span><br><span class="line">import * as types from &quot;../action-types&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">  add()&#123;</span><br><span class="line">    // 需要返回一个action对象</span><br><span class="line">    // type为动作的类型</span><br><span class="line">    return &#123; type: types.ADD&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  subtract()&#123;</span><br><span class="line">    // 需要返回一个action对象</span><br><span class="line">    // type为动作的类型</span><br><span class="line">    return &#123; type: types.SUBTRACT&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>我们可以想一下，上面<code>return &#123; type:types.ADD &#125;</code>实际上是返回一个<code>action</code>对象，将来使用的时候，是会传到<code>./src/store/reducers/index.tsx</code>的<code>action</code>中，那么我们怎么定义这个<code>action</code>的结构呢？</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">// ./src/store/actions/counter.tsx</span><br><span class="line">import * as types from &quot;../action-types&quot;;</span><br><span class="line"></span><br><span class="line">// 定义两个接口，分别约束add和subtract的type类型</span><br><span class="line">export interface Add&#123;</span><br><span class="line">  type:typeof types.ADD</span><br><span class="line">&#125;</span><br><span class="line">export interface Subtract&#123;</span><br><span class="line">  type:typeof types.SUBTRACT</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 再导出一个type</span><br><span class="line">// type是用来给类型起别名的</span><br><span class="line">// 这个actions里是一个对象，会有很多函数，每个函数都会返回一个action</span><br><span class="line">// 而 ./store/reducers/index.tsx中的action会是下面某一个函数的返回值</span><br><span class="line"></span><br><span class="line">export type Action = Add | Subtract</span><br><span class="line"></span><br><span class="line">// 把上面定义好的接口作用于下面</span><br><span class="line">// 约束返回值的类型</span><br><span class="line">export default &#123;</span><br><span class="line">  add():Add&#123;</span><br><span class="line">    // 需要返回一个action对象</span><br><span class="line">    // type为动作的类型</span><br><span class="line">    return &#123; type: types.ADD&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  subtract():Subtract&#123;</span><br><span class="line">    // 需要返回一个action对象</span><br><span class="line">    // type为动作的类型</span><br><span class="line">    return &#123; type: types.SUBTRACT&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>接着我们回到<code>./store/reducers/index.tsx</code></p>
</blockquote>
<p>经过上面一系列的配置，我们可以给<code>action</code>使用相应的接口约束了并且根据不同的<code>action</code>动作行为来进行不同的处理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">// ./store/reducers/index.tsx</span><br><span class="line">// 导入类型校验的接口</span><br><span class="line">// 用来约束state的</span><br><span class="line">import &#123; Store &#125; from &quot;../../types/index&quot;</span><br><span class="line"></span><br><span class="line">// 导入约束action的接口</span><br><span class="line">import &#123; Action &#125; from &quot;../actions/counter&quot;</span><br><span class="line"></span><br><span class="line">// 引入action动作行为的常量</span><br><span class="line">import * as types from &quot;../action-types&quot;</span><br><span class="line"></span><br><span class="line">// 我们需要给number赋予默认值</span><br><span class="line">let initState:Store = &#123; number:0 &#125;</span><br><span class="line"></span><br><span class="line">// 把接口写在state:Store</span><br><span class="line">export default function (state:Store=initState,action:Action) &#123;</span><br><span class="line">  // 拿到老的状态state和新的状态action</span><br><span class="line">  // action是一个动作行为，而这个动作行为，在计数器中是具备 加 或 减 两个功能</span><br><span class="line">  // 判断action的行为类型</span><br><span class="line">  switch (action.type) &#123;</span><br><span class="line">    case types.ADD:</span><br><span class="line">        // 当action动作行为是ADD的时候，给number加1</span><br><span class="line">        return &#123; number:state.number + 1 &#125;</span><br><span class="line">      break;</span><br><span class="line">    case types.SUBTRACT:</span><br><span class="line">        // 当action动作行为是SUBTRACT的时候，给number减1</span><br><span class="line">        return &#123; number:state.number - 1 &#125;</span><br><span class="line">      break;</span><br><span class="line">    default:</span><br><span class="line">        // 当没有匹配到则返回原本的state</span><br><span class="line">        return state</span><br><span class="line">      break;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>接下来，我们怎么样把组件和仓库建立起关系呢</p>
</blockquote>
<p>首先进入<code>./src/index.tsx</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">// ./src/index.tsx</span><br><span class="line">import * as React from &quot;react&quot;;</span><br><span class="line">import * as ReactDom from &quot;react-dom&quot;;</span><br><span class="line"></span><br><span class="line">// 引入redux这个库的Provider组件</span><br><span class="line">import &#123; Provider &#125; from &quot;react-redux&quot;;</span><br><span class="line"></span><br><span class="line">// 引入仓库</span><br><span class="line">import store from &#x27;./store&#x27;</span><br><span class="line"></span><br><span class="line">import CounterComponent from &quot;./components/Counter&quot;;</span><br><span class="line"></span><br><span class="line">// 用Provider包裹CounterComponent组件</span><br><span class="line">// 并且把store传给Provider</span><br><span class="line">// 这样Provider可以向它的子组件提供store</span><br><span class="line">ReactDom.render((</span><br><span class="line">  &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">    &lt;CounterComponent name=&quot;poetries&quot;/&gt;</span><br><span class="line">  &lt;/Provider&gt;</span><br><span class="line">),document.getElementById(&quot;app&quot;))</span><br></pre></td></tr></table></figure>

<blockquote>
<p>我们到组件内部建立连接，<code>./src/components/Counter.tsx</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">// import React from &quot;react&quot;; // 之前的写法</span><br><span class="line">// 在ts中引入的写法</span><br><span class="line">import * as React from &quot;react&quot;;</span><br><span class="line"></span><br><span class="line">// 引入connect，让组件和仓库建立连接</span><br><span class="line">import &#123; connect &#125; from &quot;react-redux&quot;;</span><br><span class="line"></span><br><span class="line">// 引入actions，用于传给connect</span><br><span class="line">import actions from &quot;../store/actions/counter&quot;;</span><br><span class="line"></span><br><span class="line">// 引入接口约束</span><br><span class="line">import &#123; Store &#125; from &quot;../types&quot;;</span><br><span class="line"></span><br><span class="line">// 接口约束</span><br><span class="line">interface IProps&#123;</span><br><span class="line">  number:number,</span><br><span class="line"></span><br><span class="line">  name:string, //如果我们不写校验的话，在外部传name进来会报错的</span><br><span class="line"></span><br><span class="line">  // add是一个函数</span><br><span class="line">  add:any,</span><br><span class="line"></span><br><span class="line">  // subtract是一个函数</span><br><span class="line">  subtract:any</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 我们还可以用接口约束state的状态</span><br><span class="line">interface IState&#123;</span><br><span class="line">    number: number</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 把接口约束的规则写在这里</span><br><span class="line">// 如果传入的name不符合类型会报错</span><br><span class="line">// 如果state的number属性不符合类型也会报错</span><br><span class="line">class CounterComponent extends React.Component&lt;IProps,IState&gt;&#123;</span><br><span class="line">  // 状态state</span><br><span class="line">  state = &#123;</span><br><span class="line">    number:0</span><br><span class="line">  &#125;</span><br><span class="line">  render()&#123;</span><br><span class="line">    // 利用解构赋值取出</span><br><span class="line">    // 这里比如和IProps保持一致，不对应则会报错，因为接口约束了必须这样</span><br><span class="line">    let &#123; number,add,subtract &#125; = this.props</span><br><span class="line"></span><br><span class="line">    return(</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;h1&gt;&#123;this.props.name&#125;&lt;/h1&gt;</span><br><span class="line">            &lt;button onClick=&#123;add&#125;&gt;+&lt;/button&gt;&lt;br /&gt;</span><br><span class="line">            &lt;button onClick=&#123;subtract&#125;&gt;-&lt;/button&gt;  </span><br><span class="line">            &lt;p&gt;&#123;number&#125;&lt;/p&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 这个connect需要执行两次，第二次需要我们把这个组件CounterComponent传进去</span><br><span class="line">// connect第一次执行，需要两个参数，</span><br><span class="line"></span><br><span class="line">// 需要传给connect的函数</span><br><span class="line">let mapStateToProps = function (state:Store) &#123;</span><br><span class="line">    return state</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">export default connect(</span><br><span class="line">    mapStateToProps,</span><br><span class="line">    actions</span><br><span class="line">)(CounterComponent);</span><br></pre></td></tr></table></figure>

<p>这时候看到成功执行了</p>
<p><img src="https://upload-images.jianshu.io/upload_images/1480597-32fc82d43dadb063.png" alt="image.png"></p>
<ul>
<li>其实搞来搞去，跟原来的写法差不多，主要就是<code>ts</code>会进行类型检查。</li>
<li>如果对<code>number</code>进行异步修改，该怎么处理？这就需要我们用到<code>redux-thunk</code></li>
</ul>
<blockquote>
<p>接着我们回到<code>./src/store/index.tsx</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// 需要使用到thunk，所以引入中间件applyMiddleware</span><br><span class="line">import &#123; createStore, applyMiddleware &#125; from &quot;redux&quot;;</span><br><span class="line"></span><br><span class="line">// 引入reducers</span><br><span class="line">import reducers from &quot;./reducers&quot;;</span><br><span class="line"></span><br><span class="line">// 引入redux-thunk，处理异步</span><br><span class="line">// 现在主流处理异步的是saga和thunk</span><br><span class="line">import thunk from &quot;redux-thunk&quot;;</span><br><span class="line"></span><br><span class="line">// 引入日志</span><br><span class="line">import logger from &quot;redux-logger&quot;;</span><br><span class="line"></span><br><span class="line">// 接着创建仓库和中间件</span><br><span class="line">let store = createStore(reducers, applyMiddleware(thunk,logger));</span><br><span class="line"></span><br><span class="line">// 导出store仓库</span><br><span class="line">export default store;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>接着我们回来<code>./src/store/actions</code>，新增一个异步的动作行为</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">// ./src/store/actions/counter.tsx</span><br><span class="line">import * as types from &quot;../action-types&quot;;</span><br><span class="line"></span><br><span class="line">// 定义两个接口，分别约束add和subtract的type类型</span><br><span class="line">export interface Add&#123;</span><br><span class="line">  type:typeof types.ADD</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export interface Subtract&#123;</span><br><span class="line">  type:typeof types.SUBTRACT</span><br><span class="line">&#125;</span><br><span class="line">// 再导出一个type</span><br><span class="line">// type是用来给类型起别名的</span><br><span class="line">// 这个actions里是一个对象，会有很多函数，每个函数都会返回一个action</span><br><span class="line">// 而 ./store/reducers/index.tsx中的action会是下面某一个函数的返回值</span><br><span class="line"></span><br><span class="line">export type Action = Add | Subtract</span><br><span class="line"></span><br><span class="line">// 把上面定义好的接口作用于下面</span><br><span class="line">// 约束返回值的类型</span><br><span class="line">export default &#123;</span><br><span class="line">  add():Add&#123;</span><br><span class="line">    // 需要返回一个action对象</span><br><span class="line">    // type为动作的类型</span><br><span class="line">    return &#123; type: types.ADD&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  subtract():Subtract&#123;</span><br><span class="line">    // 需要返回一个action对象</span><br><span class="line">    // type为动作的类型</span><br><span class="line">    return &#123; type: types.SUBTRACT&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  // 一秒后才执行这个行为</span><br><span class="line">  // ++</span><br><span class="line">  addAsync():any&#123;</span><br><span class="line">    return function (dispatch:any,getState:any) &#123;</span><br><span class="line">      setTimeout(function()&#123;</span><br><span class="line">        // 当1秒过后，会执行dispatch，派发出去，然后改变仓库的状态</span><br><span class="line">        dispatch(&#123;type:types.ADD&#125;)</span><br><span class="line">      &#125;, 1000);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>到<code>./src/components/Counter.tsx</code>组件内，使用这个异步</p>
</blockquote>
<h4 id="2-2-2-合并reducers"><a href="#2-2-2-合并reducers" class="headerlink" title="2.2.2 合并reducers"></a>2.2.2 合并reducers</h4><blockquote>
<p>假如我们的项目里面，有两个计数器，而且它俩是完全没有关系的，状态也是完全独立的，这个时候就需要用到合并<code>reducers</code>了</p>
</blockquote>
<ul>
<li>首先我们新增<code>action</code>的动作行为类型，在<code>./src/store/action-types.tsx</code></li>
<li>然后修改接口文件，<code>./src/types/index.tsx</code></li>
<li>然后把<code>./src/store/actions/counter.tsx</code>文件拷贝在当前目录并且修改名称为<code>counter2.tsx</code></li>
<li>然后把<code>./src/store/reduces/index.tsx</code>拷贝并且改名为<code>counter.tsx</code>和<code>counter2.tsx</code></li>
</ul>
<blockquote>
<p>我们多个<code>reducer</code>是通过<code>combineReducers</code>方法，进行合并的，因为我们一个项目当中肯定是存在非常多个<code>reducer</code>，所以统一在这里处理。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// ./src/store/reducers/index.tsc</span><br><span class="line"></span><br><span class="line">// 引入合并方法</span><br><span class="line">import &#123; combineReducers &#125; from &quot;redux&quot;;</span><br><span class="line"></span><br><span class="line">// 引入需要合并的reducer</span><br><span class="line">import counter from &quot;./counter&quot;;</span><br><span class="line"></span><br><span class="line">// 引入需要合并的reducer</span><br><span class="line">import counter2 from &quot;./counter2&quot;;</span><br><span class="line"></span><br><span class="line">// 合并</span><br><span class="line">let reducers = combineReducers(&#123;</span><br><span class="line">  counter,</span><br><span class="line">  counter2,</span><br><span class="line">&#125;);</span><br><span class="line">export default reducers;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>最后修改组件，进入<code>./src/components/</code>,其中</p>
</blockquote>
<p>到目前为止，我们完成了<code>reducers</code>的合并了，那么我们看看效果如何，首先我们给<code>./src/index.tsc</code>添加<code>Counter2</code>组件，这样的目的是与<code>Counter</code>组件完全独立，互不影响，但是又能够最终合并到<code>readucers</code></p>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/548.png" alt="img"></p>
<h3 id="2-3-路由"><a href="#2-3-路由" class="headerlink" title="2.3 路由"></a>2.3 路由</h3><h4 id="2-3-1-基本用法"><a href="#2-3-1-基本用法" class="headerlink" title="2.3.1 基本用法"></a>2.3.1 基本用法</h4><blockquote>
<p>首先进入<code>./src/index.tsx</code>导入我们的路由所需要的依赖包</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">// ./src/index.tsx</span><br><span class="line">import * as React from &quot;react&quot;;</span><br><span class="line">import * as ReactDom from &quot;react-dom&quot;;</span><br><span class="line"></span><br><span class="line">// 引入redux这个库的Provider组件</span><br><span class="line">import &#123; Provider &#125; from &quot;react-redux&quot;;</span><br><span class="line"></span><br><span class="line">// 引入路由</span><br><span class="line">// 路由的容器:HashRouter as Router</span><br><span class="line">// 路由的规格:Route</span><br><span class="line">// Link组件</span><br><span class="line">import &#123; BrowserRouter as Router,Route,Link &#125; from &quot;react-router-dom&quot;</span><br><span class="line"></span><br><span class="line">// 引入仓库</span><br><span class="line">import store from &#x27;./store&#x27;</span><br><span class="line"></span><br><span class="line">import CounterComponent from &quot;./components/Counter&quot;;</span><br><span class="line">import CounterComponent2 from &quot;./components/Counter2&quot;;</span><br><span class="line">import Counter from &quot;./components/Counter&quot;;</span><br><span class="line"></span><br><span class="line">function Home() &#123;</span><br><span class="line">    return &lt;div&gt;home&lt;/div&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 用Provider包裹CounterComponent组件</span><br><span class="line">// 并且把store传给Provider</span><br><span class="line">// 这样Provider可以向它的子组件提供store</span><br><span class="line">ReactDom.render((</span><br><span class="line">  &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">    &#123;/* 路由组件 */&#125;</span><br><span class="line">    &lt;Router&gt;</span><br><span class="line">      &#123;/*  放两个路由规则需要在外层套个React.Fragment */&#125;</span><br><span class="line">        &lt;React.Fragment&gt;</span><br><span class="line">            &#123;/* 增加导航 */&#125;</span><br><span class="line">            &lt;ul&gt;</span><br><span class="line">            &lt;li&gt;&lt;Link to=&quot;/&quot;&gt;Home&lt;/Link&gt;&lt;/li&gt;</span><br><span class="line">            &lt;li&gt;&lt;Link to=&quot;/counter&quot;&gt;Counter&lt;/Link&gt;&lt;/li&gt;</span><br><span class="line">            &lt;li&gt;&lt;Link to=&quot;/counter2&quot;&gt;Counter2&lt;/Link&gt;&lt;/li&gt;</span><br><span class="line">            &lt;/ul&gt;</span><br><span class="line">            &#123;/* 当路径为 / 时是home组件 */&#125;</span><br><span class="line">            &#123;/* 为了避免home组件一直渲染，我们可以添加属性exact */&#125;</span><br><span class="line">            &lt;Route exact path=&quot;/&quot; component=&#123;Home&#125;/&gt;</span><br><span class="line">            &lt;Route path=&quot;/counter&quot; component=&#123;CounterComponent&#125;/&gt;</span><br><span class="line">            &lt;Route path=&quot;/counter2&quot; component=&#123;CounterComponent2&#125; /&gt;</span><br><span class="line">        &lt;/React.Fragment&gt;</span><br><span class="line">        &lt;/Router&gt;</span><br><span class="line">  &lt;/Provider&gt;</span><br><span class="line">),document.getElementById(&quot;app&quot;))</span><br></pre></td></tr></table></figure>

<p><img src="https://poetries1.gitee.io/img-repo/2019/10/549.png" alt="img"></p>
<blockquote>
<p>但是有个很大的问题，就是我们直接访问<code>http://localhost:8080/counter</code>会找不到路由</p>
</blockquote>
<ul>
<li>因为我们的是单页面应用，不管路由怎么变更，实际上都是访问<code>index.html</code>这个文件，所以当我们访问根路径的时候，能够正常访问，因为<code>index.html</code>文件就放在这个目录下，但是当我们通过非根路径的路由访问，则出错了，是因为我们在相应的路径没有这个文件，所以出错了</li>
<li>从这一点也可以衍生出一个实战经验，我们平时项目部署上线的时候，会出现这个问题，一般我们都是用<code>nginx</code>来把访问的路径都是指向<code>index.html</code>文件，这样就能够正常访问了。</li>
<li>那么针对目前我们这个情况，我们可以通过修改<code>webpack</code>配置，让路由不管怎么访问，都是指向我们制定的<code>index.html</code>文件。</li>
</ul>
<blockquote>
<p>进入<code>./webpack.config.js</code>，在<code>devServer</code>的配置对象下新增一些配置</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// ./webpack.config.js</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">  // 开发环境服务配置</span><br><span class="line">  devServer:&#123;</span><br><span class="line">    // 启动热更新,当模块、组件有变化，不会刷新整个页面，而是局部刷新</span><br><span class="line">    // 需要和插件webpack.HotModuleReplacementPlugin配合使用</span><br><span class="line">    hot:true, </span><br><span class="line">    // 静态资源目录</span><br><span class="line">    contentBase:path.resolve(__dirname,&#x27;dist&#x27;),</span><br><span class="line">    // 不管访问什么路径，都重定向到index.html</span><br><span class="line">    historyApiFallback:&#123;</span><br><span class="line">      index:&quot;./index.html&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<blockquote>
<p>修改<code>webpack</code>配置需要重启服务，然后重启服务，看看浏览器能否正常访问<code>http://localhost:8080/counter</code></p>
</blockquote>
<h4 id="2-3-2-同步路由到redux"><a href="#2-3-2-同步路由到redux" class="headerlink" title="2.3.2 同步路由到redux"></a>2.3.2 同步路由到redux</h4><blockquote>
<p>路由的路径，如何同步到仓库当中。以前是用一个叫<code>react-router-redux</code>的库，把路由和<code>redux</code>结合到一起的，<code>react-router-redux</code>挺好用的，但是这个库不再维护了，被废弃了，所以现在推荐使用<code>connected-react-router</code>这个库，可以把路由状态映射到仓库当中</p>
</blockquote>
<blockquote>
<p>首先我们在<code>./src</code>下创建文件<code>history.tsx</code></p>
</blockquote>
<p>假设我有一个需求，就是我不通过<code>Link</code>跳转页面，而是通过编程式导航，触发一个动作，然后这个动作会派发出去，而且把路由信息放到<code>redux</code>中，供我以后查看。</p>
<blockquote>
<p>我们进入<code>./src/store/reducers/index.tsx</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">// 引入合并方法</span><br><span class="line">import &#123; combineReducers &#125; from &quot;redux&quot;;</span><br><span class="line"></span><br><span class="line">// 引入需要合并的reducer</span><br><span class="line">import counter from &quot;./counter&quot;;</span><br><span class="line"></span><br><span class="line">// 引入需要合并的reducer</span><br><span class="line">import counter2 from &quot;./counter2&quot;;</span><br><span class="line"></span><br><span class="line">// 引入connectRouter</span><br><span class="line">import &#123; connectRouter &#125; from &quot;connected-react-router&quot;;</span><br><span class="line">import history from &quot;../../history&quot;;</span><br><span class="line"></span><br><span class="line">// 合并</span><br><span class="line">let reducers = combineReducers(&#123;</span><br><span class="line">  counter,</span><br><span class="line">  counter2,</span><br><span class="line">  // 把history传到connectRouter函数中</span><br><span class="line">  router: connectRouter(history)</span><br><span class="line">&#125;);</span><br><span class="line">export default reducers;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>我们进入<code>./src/store/index.tsx</code>来添加中间件</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">// 需要使用到thunk，所以引入中间件applyMiddleware</span><br><span class="line">import &#123; createStore, applyMiddleware &#125; from &quot;redux&quot;;</span><br><span class="line"></span><br><span class="line">// 引入reducers</span><br><span class="line">import reducers from &quot;./reducers&quot;;</span><br><span class="line"></span><br><span class="line">// 引入redux-thunk，处理异步</span><br><span class="line">// 现在主流处理异步的是saga和thunk</span><br><span class="line">import thunk from &quot;redux-thunk&quot;;</span><br><span class="line"></span><br><span class="line">// 引入日志</span><br><span class="line">import logger from &quot;redux-logger&quot;;</span><br><span class="line"></span><br><span class="line">// 引入中间件</span><br><span class="line">import &#123; routerMiddleware &#125; from &quot;connected-react-router&quot;;</span><br><span class="line">import history from &quot;../history&quot;;</span><br><span class="line"></span><br><span class="line">// 接着创建仓库和中间件</span><br><span class="line">let store = createStore(reducers, applyMiddleware(routerMiddleware(history),thunk,logger));</span><br><span class="line"></span><br><span class="line">// 导出store仓库</span><br><span class="line">export default store;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>我们进入<code>./src/store/actions/counter.tsx</code>加个<code>goto</code>方法用来跳转</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">// ./src/store/actions/counter.tsx</span><br><span class="line">import * as types from &quot;../action-types&quot;;</span><br><span class="line"></span><br><span class="line">// 引入push方法</span><br><span class="line">import &#123; push &#125; from &quot;connected-react-router&quot;;</span><br><span class="line"></span><br><span class="line">// 定义两个接口，分别约束add和subtract的type类型</span><br><span class="line">export interface Add&#123;</span><br><span class="line">  type:typeof types.ADD</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export interface Subtract&#123;</span><br><span class="line">  type:typeof types.SUBTRACT</span><br><span class="line">&#125;</span><br><span class="line">// 再导出一个type</span><br><span class="line">// type是用来给类型起别名的</span><br><span class="line">// 这个actions里是一个对象，会有很多函数，每个函数都会返回一个action</span><br><span class="line">// 而 ./store/reducers/index.tsx中的action会是下面某一个函数的返回值</span><br><span class="line"></span><br><span class="line">export type Action = Add | Subtract</span><br><span class="line"></span><br><span class="line">// 把上面定义好的接口作用于下面</span><br><span class="line">// 约束返回值的类型</span><br><span class="line">export default &#123;</span><br><span class="line">  add():Add&#123;</span><br><span class="line">    // 需要返回一个action对象</span><br><span class="line">    // type为动作的类型</span><br><span class="line">    return &#123; type: types.ADD&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  subtract():Subtract&#123;</span><br><span class="line">    // 需要返回一个action对象</span><br><span class="line">    // type为动作的类型</span><br><span class="line">    return &#123; type: types.SUBTRACT&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  // 一秒后才执行这个行为</span><br><span class="line">  addAsync():any&#123;</span><br><span class="line">    return function (dispatch:any,getState:any) &#123;</span><br><span class="line">      setTimeout(function()&#123;</span><br><span class="line">        // 当1秒过后，会执行dispatch，派发出去，然后改变仓库的状态</span><br><span class="line">        dispatch(&#123;type:types.ADD&#125;)</span><br><span class="line">      &#125;, 1000);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  goto(path:string)&#123;</span><br><span class="line">    // 派发一个动作</span><br><span class="line">    // 这个push是connected-react-router里的一个方法</span><br><span class="line">    // 返回一个跳转路径的action</span><br><span class="line">    return push(path)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>我们进入<code>./src/components/Counter.tsx</code>中加个按钮，当我点击按钮的时候，会向仓库派发<code>action</code>，仓库的<code>action</code>里有中间件，会把我们这个请求拦截到，然后跳转</p>
</blockquote>
</div><hr></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/"><i class="fa fa-chevron-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fpic1.win4000.com%2Fwallpaper%2F6%2F53cca8e7873e6.jpg&amp;refer=http%3A%2F%2Fpic1.win4000.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1664449271&amp;t=4f4642aaba02226ad62910f50b366e4b)"><div class="layout" id="footer"><div class="copyright">&copy;2018 - 2022 By ChengWei</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">hitokoto</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/lib/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.1"></script><script src="/js/fancybox.js?version=1.9.1"></script><script src="/js/sidebar.js?version=1.9.1"></script><script src="/js/copy.js?version=1.9.1"></script><script src="/js/fireworks.js?version=1.9.1"></script><script src="/js/transition.js?version=1.9.1"></script><script src="/js/scroll.js?version=1.9.1"></script><script src="/js/head.js?version=1.9.1"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>